(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2888],{74661:function(e,t,i){"use strict";var r=i(97582);function a(e){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var n={interpolationRegex:/{([\w]+)}/g,values:{}};function o(e,t){return e.replace(t.interpolationRegex,function(e,i){return""+(t.values[i]||"")})}e.exports=function(e,t,i){if("string"!=typeof e)throw Error("Language should be a string.");if("object"!==a(t))throw Error("Locales should be of object");var s=r.__assign({},n,i),u=t[e];return function(e,t){var i=r.__assign({},s,t);if(e&&u){var n=u[e];return"string"==typeof n?o(n,i):"object"===a(n)?function(e){return o(e(n,i),i)}:o(e,i)}return""}}},72378:function(e,t,i){e=i.nmd(e);var r,a,n,o,s,u,l,d,c,h,f,g="__lodash_hash_undefined__",p="[object Arguments]",v="[object Function]",m="[object Object]",y=/^\[object .+?Constructor\]$/,C=/^(?:0|[1-9]\d*)$/,b={};b["[object Float32Array]"]=b["[object Float64Array]"]=b["[object Int8Array]"]=b["[object Int16Array]"]=b["[object Int32Array]"]=b["[object Uint8Array]"]=b["[object Uint8ClampedArray]"]=b["[object Uint16Array]"]=b["[object Uint32Array]"]=!0,b[p]=b["[object Array]"]=b["[object ArrayBuffer]"]=b["[object Boolean]"]=b["[object DataView]"]=b["[object Date]"]=b["[object Error]"]=b[v]=b["[object Map]"]=b["[object Number]"]=b[m]=b["[object RegExp]"]=b["[object Set]"]=b["[object String]"]=b["[object WeakMap]"]=!1;var w="object"==typeof i.g&&i.g&&i.g.Object===Object&&i.g,E="object"==typeof self&&self&&self.Object===Object&&self,k=w||E||Function("return this")(),D=t&&!t.nodeType&&t,S=D&&e&&!e.nodeType&&e,I=S&&S.exports===D,T=I&&w.process,R=function(){try{var e=S&&S.require&&S.require("util").types;if(e)return e;return T&&T.binding&&T.binding("util")}catch(e){}}(),V=R&&R.isTypedArray,O=Array.prototype,A=Function.prototype,_=Object.prototype,x=k["__core-js_shared__"],M=A.toString,N=_.hasOwnProperty,F=(l=/[^.]+$/.exec(x&&x.keys&&x.keys.IE_PROTO||""))?"Symbol(src)_1."+l:"",$=_.toString,P=M.call(Object),L=RegExp("^"+M.call(N).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),U=I?k.Buffer:void 0,j=k.Symbol,K=k.Uint8Array,G=U?U.allocUnsafe:void 0,z=(d=Object.getPrototypeOf,c=Object,function(e){return d(c(e))}),B=Object.create,q=_.propertyIsEnumerable,H=O.splice,W=j?j.toStringTag:void 0,Y=function(){try{var e=ef(Object,"defineProperty");return e({},"",{}),e}catch(e){}}(),J=U?U.isBuffer:void 0,X=Math.max,Q=Date.now,Z=ef(k,"Map"),ee=ef(Object,"create"),et=function(){function e(){}return function(t){if(!eS(t))return{};if(B)return B(t);e.prototype=t;var i=new e;return e.prototype=void 0,i}}();function ei(e){var t=-1,i=null==e?0:e.length;for(this.clear();++t<i;){var r=e[t];this.set(r[0],r[1])}}function er(e){var t=-1,i=null==e?0:e.length;for(this.clear();++t<i;){var r=e[t];this.set(r[0],r[1])}}function ea(e){var t=-1,i=null==e?0:e.length;for(this.clear();++t<i;){var r=e[t];this.set(r[0],r[1])}}function en(e){var t=this.__data__=new er(e);this.size=t.size}function eo(e,t,i){(void 0===i||ey(e[t],i))&&(void 0!==i||t in e)||eu(e,t,i)}function es(e,t){for(var i=e.length;i--;)if(ey(e[i][0],t))return i;return -1}function eu(e,t,i){"__proto__"==t&&Y?Y(e,t,{configurable:!0,enumerable:!0,value:i,writable:!0}):e[t]=i}ei.prototype.clear=function(){this.__data__=ee?ee(null):{},this.size=0},ei.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},ei.prototype.get=function(e){var t=this.__data__;if(ee){var i=t[e];return i===g?void 0:i}return N.call(t,e)?t[e]:void 0},ei.prototype.has=function(e){var t=this.__data__;return ee?void 0!==t[e]:N.call(t,e)},ei.prototype.set=function(e,t){var i=this.__data__;return this.size+=this.has(e)?0:1,i[e]=ee&&void 0===t?g:t,this},er.prototype.clear=function(){this.__data__=[],this.size=0},er.prototype.delete=function(e){var t=this.__data__,i=es(t,e);return!(i<0)&&(i==t.length-1?t.pop():H.call(t,i,1),--this.size,!0)},er.prototype.get=function(e){var t=this.__data__,i=es(t,e);return i<0?void 0:t[i][1]},er.prototype.has=function(e){return es(this.__data__,e)>-1},er.prototype.set=function(e,t){var i=this.__data__,r=es(i,e);return r<0?(++this.size,i.push([e,t])):i[r][1]=t,this},ea.prototype.clear=function(){this.size=0,this.__data__={hash:new ei,map:new(Z||er),string:new ei}},ea.prototype.delete=function(e){var t=eh(this,e).delete(e);return this.size-=t?1:0,t},ea.prototype.get=function(e){return eh(this,e).get(e)},ea.prototype.has=function(e){return eh(this,e).has(e)},ea.prototype.set=function(e,t){var i=eh(this,e),r=i.size;return i.set(e,t),this.size+=i.size==r?0:1,this},en.prototype.clear=function(){this.__data__=new er,this.size=0},en.prototype.delete=function(e){var t=this.__data__,i=t.delete(e);return this.size=t.size,i},en.prototype.get=function(e){return this.__data__.get(e)},en.prototype.has=function(e){return this.__data__.has(e)},en.prototype.set=function(e,t){var i=this.__data__;if(i instanceof er){var r=i.__data__;if(!Z||r.length<199)return r.push([e,t]),this.size=++i.size,this;i=this.__data__=new ea(r)}return i.set(e,t),this.size=i.size,this};var el=function(e,t,i){for(var r=-1,a=Object(e),n=i(e),o=n.length;o--;){var s=n[++r];if(!1===t(a[s],s,a))break}return e};function ed(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":W&&W in Object(e)?function(e){var t=N.call(e,W),i=e[W];try{e[W]=void 0;var r=!0}catch(e){}var a=$.call(e);return r&&(t?e[W]=i:delete e[W]),a}(e):$.call(e)}function ec(e){return eI(e)&&ed(e)==p}function eh(e,t){var i,r=e.__data__;return("string"==(i=typeof t)||"number"==i||"symbol"==i||"boolean"==i?"__proto__"!==t:null===t)?r["string"==typeof t?"string":"hash"]:r.map}function ef(e,t){var i=null==e?void 0:e[t];return!(!eS(i)||F&&F in i)&&(ek(i)?L:y).test(function(e){if(null!=e){try{return M.call(e)}catch(e){}try{return e+""}catch(e){}}return""}(i))?i:void 0}function eg(e,t){var i=typeof e;return!!(t=null==t?9007199254740991:t)&&("number"==i||"symbol"!=i&&C.test(e))&&e>-1&&e%1==0&&e<t}function ep(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||_)}function ev(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]}var em=(r=Y?function(e,t){return Y(e,"toString",{configurable:!0,enumerable:!1,value:function(){return t},writable:!0})}:eO,a=0,n=0,function(){var e=Q(),t=16-(e-n);if(n=e,t>0){if(++a>=800)return arguments[0]}else a=0;return r.apply(void 0,arguments)});function ey(e,t){return e===t||e!=e&&t!=t}var eC=ec(function(){return arguments}())?ec:function(e){return eI(e)&&N.call(e,"callee")&&!q.call(e,"callee")},eb=Array.isArray;function ew(e){return null!=e&&eD(e.length)&&!ek(e)}var eE=J||function(){return!1};function ek(e){if(!eS(e))return!1;var t=ed(e);return t==v||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}function eD(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}function eS(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function eI(e){return null!=e&&"object"==typeof e}var eT=V?function(e){return V(e)}:function(e){return eI(e)&&eD(e.length)&&!!b[ed(e)]};function eR(e){return ew(e)?function(e,t){var i=eb(e),r=!i&&eC(e),a=!i&&!r&&eE(e),n=!i&&!r&&!a&&eT(e),o=i||r||a||n,s=o?function(e,t){for(var i=-1,r=Array(e);++i<e;)r[i]=t(i);return r}(e.length,String):[],u=s.length;for(var l in e)(t||N.call(e,l))&&!(o&&("length"==l||a&&("offset"==l||"parent"==l)||n&&("buffer"==l||"byteLength"==l||"byteOffset"==l)||eg(l,u)))&&s.push(l);return s}(e,!0):function(e){if(!eS(e))return function(e){var t=[];if(null!=e)for(var i in Object(e))t.push(i);return t}(e);var t=ep(e),i=[];for(var r in e)"constructor"==r&&(t||!N.call(e,r))||i.push(r);return i}(e)}var eV=(h=function(e,t,i){!function e(t,i,r,a,n){t!==i&&el(i,function(o,s){if(n||(n=new en),eS(o))(function(e,t,i,r,a,n,o){var s=ev(e,i),u=ev(t,i),l=o.get(u);if(l){eo(e,i,l);return}var d=n?n(s,u,i+"",e,t,o):void 0,c=void 0===d;if(c){var h,f,g,p=eb(u),v=!p&&eE(u),y=!p&&!v&&eT(u);d=u,p||v||y?eb(s)?d=s:eI(s)&&ew(s)?d=function(e,t){var i=-1,r=e.length;for(t||(t=Array(r));++i<r;)t[i]=e[i];return t}(s):v?(c=!1,d=function(e,t){if(t)return e.slice();var i=e.length,r=G?G(i):new e.constructor(i);return e.copy(r),r}(u,!0)):y?(c=!1,new K(f=new(h=u.buffer).constructor(h.byteLength)).set(new K(h)),g=f,d=new u.constructor(g,u.byteOffset,u.length)):d=[]:function(e){if(!eI(e)||ed(e)!=m)return!1;var t=z(e);if(null===t)return!0;var i=N.call(t,"constructor")&&t.constructor;return"function"==typeof i&&i instanceof i&&M.call(i)==P}(u)||eC(u)?(d=s,eC(s)?d=function(e,t,i,r){var a=!i;i||(i={});for(var n=-1,o=t.length;++n<o;){var s=t[n],u=void 0;void 0===u&&(u=e[s]),a?eu(i,s,u):function(e,t,i){var r=e[t];N.call(e,t)&&ey(r,i)&&(void 0!==i||t in e)||eu(e,t,i)}(i,s,u)}return i}(s,eR(s)):(!eS(s)||ek(s))&&(d="function"!=typeof u.constructor||ep(u)?{}:et(z(u)))):c=!1}c&&(o.set(u,d),a(d,u,r,n,o),o.delete(u)),eo(e,i,d)})(t,i,s,r,e,a,n);else{var u=a?a(ev(t,s),o,s+"",t,i,n):void 0;void 0===u&&(u=o),eo(t,s,u)}},eR)}(e,t,i)},em((o=f=function(e,t){var i=-1,r=t.length,a=r>1?t[r-1]:void 0,n=r>2?t[2]:void 0;for(a=h.length>3&&"function"==typeof a?(r--,a):void 0,n&&function(e,t,i){if(!eS(i))return!1;var r=typeof t;return("number"==r?!!(ew(i)&&eg(t,i.length)):"string"==r&&(t in i))&&ey(i[t],e)}(t[0],t[1],n)&&(a=r<3?void 0:a,r=1),e=Object(e);++i<r;){var o=t[i];o&&h(e,o,i,a)}return e},s=void 0,u=eO,s=X(void 0===s?o.length-1:s,0),function(){for(var e=arguments,t=-1,i=X(e.length-s,0),r=Array(i);++t<i;)r[t]=e[s+t];t=-1;for(var a=Array(s+1);++t<s;)a[t]=e[t];return a[s]=u(r),function(e,t,i){switch(i.length){case 0:return e.call(t);case 1:return e.call(t,i[0]);case 2:return e.call(t,i[0],i[1]);case 3:return e.call(t,i[0],i[1],i[2])}return e.apply(t,i)}(o,this,a)}),f+""));function eO(e){return e}e.exports=eV},6840:function(e,t,i){(window.__NEXT_P=window.__NEXT_P||[]).push(["/_app",function(){return i(76608)}])},2592:function(e,t,i){"use strict";i.d(t,{As:function(){return c},Qe:function(){return d}});var r=i(85893),a=i(67294),n=i(39332),o=i(60023),s=i(11163);let u=e=>({referrerTitle:null==e?void 0:e.split("|").shift(),referrerPath:(null==e?void 0:e.includes("|"))?null==e?void 0:e.split("|").pop():"/"}),l=(0,a.createContext)({activeStep:0,currentQuestionChoice:!1,setActiveStep:()=>{},setChoices:()=>[],getChoices:()=>[],getNumberOfQuestions:()=>0,getQuestions:()=>[],setQuestions:()=>[],getWizardName:()=>"wizard",setWizardName:()=>{},getReferrer:()=>void 0});function d(){let{activeStep:e,currentQuestionChoice:t,setActiveStep:i,setChoices:r,getChoices:n,getNumberOfQuestions:o,getQuestions:s,setQuestions:u,getWizardName:d,setWizardName:c,getReferrer:h}=(0,a.useContext)(l);return{activeStep:e,currentQuestionChoice:t,setActiveStep:i,setChoices:r,getWizardName:d,getNumberOfQuestions:o,getQuestions:s,setQuestions:u,getChoices:n,setWizardName:c,getReferrer:h}}function c(e){let{children:t}=e,i=(0,n.usePathname)(),d=(0,s.useRouter)(),[c,h]=(0,a.useState)(0),[f,g]=(0,a.useState)(!1),[p,v]=(0,a.useState)([]),[m,y]=(0,a.useState)(),[C,b]=(0,a.useState)([]),[w,E]=(0,a.useState)(),k=(0,a.useCallback)(()=>p,[p]),D=(0,a.useCallback)(()=>(0,o.Uh)(C)?C:[],[C]),S=(0,a.useCallback)(()=>(0,o.Uh)(C)?C.length:0,[C]),I=(0,a.useCallback)(()=>null!=w?w:"wizard",[w]),T=(0,a.useCallback)(()=>{if((0,o.Uh)(m))return m},[m]);(0,a.useEffect)(()=>{let e=new URLSearchParams(new URL(window.location.href).search),t=e.get("step"),i=e.get("referrer"),r=e.get("choices"),a=(0,o.Uh)(t)?Number(t):0,n=null==r?void 0:r.split("|"),{referrerTitle:s,referrerPath:l}=u(null!=i?i:"");(0,o.Uh)(s)&&(0,o.Uh)(l)&&y({title:s,path:l}),(0,o.Uh)(a)&&(h(e=>e!==a?a:e),(0,o.Uh)(n)&&(v(n),(0,o.Uh)(C)&&c>0&&c<C.length&&g((0,o.YO)(C[c-1].choices).map(e=>e.id).filter(e=>n.includes(e.toString())).length>0)))},[]),(0,a.useEffect)(()=>{(0,o.Uh)(C)&&0!==C.length&&(d.replace({pathname:i,query:{referrer:(0,o.Uh)(null==m?void 0:m.title)?"".concat(null==m?void 0:m.title,"|").concat(null==m?void 0:m.path):"",step:null==c?void 0:c.toString(),choices:null==p?void 0:p.join("|")}},void 0,{shallow:!0}),(0,o.Uh)(p)&&(0,o.Uh)(C)&&c>0&&c<C.length+1&&g(C[c-1].choices.map(e=>null==e?void 0:e.id).filter(e=>!!(0,o.Uh)(e)&&p.includes(e.toString())).length>0))},[p,c,m]),(0,a.useEffect)(()=>{V()&&0!==c&&v.length>0&&(h(0),v([]),y(void 0))},[d.asPath]);let R=(0,a.useMemo)(()=>({activeStep:c,getNumberOfQuestions:S,currentQuestionChoice:f,setActiveStep:h,setChoices:v,getChoices:k,getQuestions:D,setQuestions:b,getWizardName:I,setWizardName:E,getReferrer:T}),[c,f,h,v,k,b,I,E,T]),V=()=>{let e=new URLSearchParams(new URL(window.location.href).search),t=e.get("step"),i=e.get("referrer"),r=e.get("choices");return!(0,o.Uh)(t)&&!(0,o.Uh)(i)&&!(0,o.Uh)(r)};return(0,r.jsx)(l.Provider,{value:R,children:t})}},2826:function(e,t,i){"use strict";i.d(t,{v:function(){return n}});var r=i(11163),a=i(67294);function n(){let e=(0,r.useRouter)();return{locale:(0,a.useMemo)(()=>{var t,i;return null!==(i=null!==(t=e.locale)&&void 0!==t?t:e.defaultLocale)&&void 0!==i?i:""},[e.locale,e.defaultLocale]),toPath(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"/";return"nl"===this.locale?e:"/".concat(this.locale).concat(e)}}}},30705:function(e,t,i){"use strict";i.d(t,{w:function(){return l}});var r=i(74661),a=i.n(r),n=i(2826),o=JSON.parse('{"Page not found":"Page not found","Test":"Test","Menu":"Menu","Map":"Map","MyLoket":"My Loket","Contact":"Contact","Translate":"Translate","Follow us":"Follow us","You are looking for":{"query":"You are searching for <strong>{query}</strong>","facets":"You are searching for <strong>{query}</strong> with filters <strong>{facets}</strong>","onlyFacet":"You are searching with the filters <strong>{facets}</strong>","none":""},"Overview announcer":{"onlyPage":"You are on page {page}","onlyFilter":"You are filtered on {filter}","pageAndFilter":"You are on page {page} with filters {filter}","none":""},"dvg_graphql_search_content_type":{"label":"Filter op","name":"content-type"},"dvg_graphql_search_district":{"label":"District","name":"district"},"dvg_graphql_search_participation":{"label":"Participation","name":"participation"},"dvg_graphql_search_topic":{"label":"Topic","name":"topic"},"searchQuery":{"label":"Search","name":"search"},"page":{"label":"Page","name":"page"},"event":{"label":"Events","name":"events"},"news":{"label":"News","name":"news"},"blog_event_news":{"label":"Events, news and blogs","name":"events, news and blogs"},"spatial_plan":{"label":"Plans","name":"plans"},"results":"results","Search results":"Search results","Show results":"Show results","Search":"Search","How may we help you?":"How may we help you?","Page":"Page","Previous page":"Go to previous page","Next page":"Go to next page","Go to":"Go to","Go to question":"Go to question","to page count":"Go to page {count}","to filters":"Go to search filters","to search results":"Go to search results","Open filters":"Filters","Remove filters":"Remove filters","Show all":"Show all","Skip to content":"Skip to content","Email":"Email","Phone":"Phone","Mobile":"Mobile","Socials":"Socials","Skype":"Skype","Profile group":"Profile group","Go to top":"Go to top","Share on":"Share on","Look what I have found: ":"Look what I have found: ","Here you will find your advice from the Regelhulp on Rotterdam.nl: ":"Here you will find your advice from the Regelhulp on Rotterdam.nl: ","Share on platform":{"facebook":"Share on Facebook","twitter":"Share on X","linkedin":"Share on LinkedIn","whatsapp":"Share on WhatsApp","email":"Share on Email","none":""},"Edit this page in CMS":"Edit this page in CMS","Stop preview mode":"Stop preview mode","Preview mode":"Preview mode","Read more":"Read more","Last updated":"Last updated","Link opens an external page":"Link opens an external page","Open attachment":"Open attachment","Pay attention":"Pay attention","Information":"Information","Please accept the cookies to see this content":"Please accept the cookies to see this content","Accept cookies":"Accept cookies","Decline cookies":"Decline cookies",".nl uses cookies to make the website more user-friendly.":".nl uses cookies to make the website more user-friendly.","Startdate":"Start date","Start":"Start","Enddate":"End date","End":"End","Date":"Date","Location":"Location","Go directly to":"Go directly to","Jump to":"Jump to","There are no matching articles for this subject...":"There are no matching articles for this subject...","Close menu":"Close menu","Close filter menu":"Close filter menu","Reading time":"Reading time","/search":"/search","Did you mean":"Did you mean:","Did you mean {suggestion}":"Did you mean: {suggestion}","Have the text read aloud with ReadSpeaker":"Have the text read aloud with ReadSpeaker","Arrange quickly":"Arrange quickly","Cookies are now: enabled":"Cookies are now: enabled","Cookies are now: disabled":"Cookies are now: disabled","Read out":"Read out","Language switch":"Language switch","Use DeepL to translate this website. We take no responsibility for the accuracy of the translation.":"Use DeepL to translate this website. We take no responsibility for the accuracy of the translation.","Tourist info":"Tourist info","Profile":"Profile","Profilegroup":"Profilegroup","Sectionpage":"Sectionpage","Task":"Task","Request/arrange":"Request/arrange","Webform":"Webform","On this page":"On this page","Back":"back","Step {entrycount} of {totalcount}":"Step {entrycount} of {totalcount}","Close main navigation":"Close main navigation","Close image zoom dialog":"Close image zoom dialog","This is how the aid wizard works":"This is how the aid wizard works","Skip this question":"Skip this question","Next question":"Next question","Show advice":"Show advice","Multiple answers possible":"Multiple choices possible","One answers possible":"One answers possible","More information":"More information","Continue with the questions":"Continue with the questions","Start over":"Start over","Save overview":"Save overview","Link copied":"Link copied","You can arrange this with the municipality:":"You can arrange this with the municipality:","Note: The overview only shows what you can arrange via the website of the municipality of Rotterdam.":"Note: The overview only shows what you can arrange via the website of the municipality of Rotterdam.","Also good to know":"Also good to know","Back to":"Back to","Back to explanation":"Back to explanation","Previous question":"Previous question","Copy the link to your overview and email it to yourself. Or to someone who is helping you.":"Copy the link to your overview and email it to yourself. Or to someone who is helping you.","Useful information":"Useful information","What are you looking for?":"What are you looking for?","Make an appointment":"Make an appointment","Waar ben je naar op zoek?":"What are you looking for?","Bedoel je:":"Did you mean:","Je zoekt op":{"query":"You are searching for <strong>{query}</strong>","facets":"You are searching for <strong>{query}</strong> with filters <strong>{facets}</strong>","onlyFacet":"You are searching with the filters <strong>{facets}</strong>","none":""}}'),s=JSON.parse('{"Page not found":"Pagina niet gevonden","Test":"Test","Menu":"Menu","Map":"Kaart","MyLoket":"Mijn Loket","Contact":"Contact","Translate":"Translate","Follow us":"Volg ons","You are looking for":{"query":"U zoekt op <strong>{query}</strong>","facets":"U zoekt op <strong>{query}</strong> met de filters <strong>{facets}</strong>","onlyFacet":"U zoekt met de filter <strong>{facets}</strong>","none":""},"Overview announcer":{"onlyPage":"U bent op pagina {page}","onlyFilter":"U bent gefilterd op {filter}","pageAndFilter":"U bent op pagina {page} gefilterd op {filter}","none":""},"dvg_graphql_search_content_type":{"label":"Filter op","name":"content-type"},"dvg_graphql_search_district":{"label":"Gebied","name":"gebied"},"dvg_graphql_search_participation":{"label":"Deelnamen","name":"deelnamen"},"dvg_graphql_search_topic":{"label":"Onderwerp","name":"onderwerp"},"searchQuery":{"label":"Zoekopdracht","name":"zoekopdracht"},"page":{"label":"Pagina","name":"pagina"},"event":{"label":"Evenementen","name":"evenementen"},"news":{"label":"Nieuws","name":"nieuws"},"blog_event_news":{"label":"Evenementen, nieuws en blogs","name":"evenementen, nieuws en blogs"},"spatial_plan":{"label":"Plannen","name":"plannen"},"results":"resultaten","Search results":"Zoekresultaten","Show results":"Toon resultaten","Search":"Zoeken","How may we help you?":"Hoe kunnen wij u helpen?","Page":"Pagina","Previous page":"Terug naar vorige pagina","Next page":"Ga naar volgende pagina","Go to":"Naar","Go to question":"Ga naar vraag","to page count":"Ga naar pagina {count}","to filters":"Ga naar zoek filters","to search results":"Ga naar zoekresultaten","Open filters":"Filters","Remove filters":"Verwijder filters","Show all":"Toon alles","Skip to content":"Ga naar de hoofdinhoud","Email":"E-mail","Phone":"Telefoon","Mobile":"Mobiel","Socials":"Socials","Skype":"Skype","Profile group":"Profiel groep","Go to top":"Ga naar boven","Share on":"Delen via","Look what I have found: ":"Kijk wat ik heb gevonden: ","Look what I have found on {siteName}":"Kijk wat ik heb gevonden op {siteName}","Here you will find your advice from the Regelhulp on Rotterdam.nl: ":"Hier vindt u uw advies van de regelhulp op rotterdam.nl: ","Share on platform":{"facebook":"Deel via Facebook","twitter":"Deel via X","linkedin":"Deel via LinkedIn","whatsapp":"Deel via WhatsApp","email":"Deel via E-mail","none":""},"Edit this page in CMS":"Pagina in CMS aanpassen","stop preview mode":"Preview mode stoppen","Preview mode":"Preview mode","Read more":"Lees meer","Last updated":"Laatste update","Link opens an external page":"Link opent een externe pagina","Open attachment":"Open bijlage","Pay attention":"Let op","Information":"Informatie","Please accept the cookies to see this content":"Accepteer de cookies om deze inhoud te kunnen zien","Accept cookies":"Accepteer cookies","Decline cookies":"Weiger cookies","{siteName} uses cookies to make the website more user-friendly.":"{siteName} gebruikt cookies om de website gebruiksvriendelijker te maken.","{siteName} uses <a href=\\"/cookies\\">cookies</a> to make the website more user-friendly.":"{siteName} gebruikt <a href=\\"/cookies\\">cookies</a> om de website gebruiksvriendelijker te maken.","Startdate":"Startdatum","Start":"Start","Enddate":"Einddatum","End":"Eind","Date":"Datum","Location":"Locatie","Go directly to":"Ga direct naar","Jump to":"Ga naar","There are no matching articles for this subject...":"Er zijn geen overeenkomende artikelen voor dit onderwerp...","Close menu":"Sluit menu","Close filter menu":"Sluit filter menu","Reading time":"Leestijd","/search":"/zoeken","Have the text read aloud with ReadSpeaker":"Laat de tekst voorlezen met ReadSpeaker","Arrange quickly":"Snel regelen","Did you mean":"Bedoelt u:","Did you mean {suggestion}":"Bedoelt u: {suggestion}","Cookies are now: enabled":"Cookies zijn nu: ingeschakeld","Cookies are now: disabled":"Cookies zijn nu: uitgeschakeld","Read out":"Lees voor","Language switch":"Talen switch","Use DeepL to translate this website. We take no responsibility for the accuracy of the translation.":"Use DeepL to translate this website. We take no responsibility for the accuracy of the translation.","Tourist info":"Toeristische info","Profile":"Profiel","Profilegroup":"Profielgroep","Sectionpage":"Sectiepagina","Task":"Taak","Request/arrange":"Aanvragen/regelen","Webform":"Formulier","On this page":"Op deze pagina","Back":"terug","Back to last question":"Terug naar laatste vraag","Step {entrycount} of {totalcount}":"Stap {entrycount} van {totalcount}","Question {entrycount} of {totalcount}":"Vraag {entrycount} van {totalcount}","Close main navigation":"Sluit hoofdnavigatie","Close image zoom dialog":"Sluit het zoomdialoogvenster voor afbeeldingen","This is how it works":"Zo werkt het","Skip this question":"Deze vraag overslaan","Next question":"Volgende vraag","Show advice":"Toon advies","Multiple choices possible":"Meerdere antwoorden mogelijk","One choice possible":"E\xe9n antwoord mogelijk","More information":"Meer informatie","Continue with the questions":"Door met de vragen","Start over":"Begin opnieuw","Save overview":"Bewaar voor later","Link copied":"Link gekopieerd","You can arrange this with the municipality:":"Dit kunt u regelen bij de gemeente:","Note: The overview only shows what you can arrange via the website of the municipality of Rotterdam.":"Let op: in het overzicht staat alleen wat u via de website bij gemeente Rotterdam kunt regelen","Also good to know":"Ook goed om te weten","Back to":"Terug naar","Back to explanation":"Terug naar uitleg","Previous question":"Vorige vraag","Your choices":"Uw keuzes","Tip: If you answer 1 or more questions, you will receive a more extensive overview that matches your personal situation.":"Tip: als u 1 of meer vragen beantwoordt, krijgt u een uitgebreider overzicht dat past bij uw persoonlijke situatie.","Share on WhatsApp":"Delen via WhatsApp","Copy link to this overview":"Link naar dit overzicht kopi\xebren","Or share this overview":"Of deel dit overzicht","Send":"Versturen","Sending":"Bezig met versturen","Email sent":"We hebben het overzicht verstuurd","To the questions":"Naar de vragen","Copy the link to your overview and email it to yourself. Or to someone who is helping you.":"Kopieer de link naar uw overzicht en mail hem naar uzelf. Of naar iemand die u helpt.","Useful information":"Handige informatie","Make appointment":"Afspraak Maken","What are you looking for?":"Waar ben u naar op zoek?","Waar ben je naar op zoek?":"Waar ben je naar op zoek?","Bedoel je:":"Bedoel je:","Je zoekt op":{"query":"Je zoekt op <strong>{query}</strong>","facets":"Je zoekt op <strong>{query}</strong> met de filters <strong>{facets}</strong>","onlyFacet":"Je zoekt met de filter <strong>{facets}</strong>","none":""}}'),u=i(67294);function l(){let e=(0,n.v)();return(0,u.useMemo)(()=>a()(e.locale,{en:o,nl:s}),[e])}},24239:function(e,t,i){"use strict";i(67294),t.Z=function(e){return e.condition?e.wrapper(e.children):e.children}},39071:function(e,t,i){"use strict";i.d(t,{v:function(){return n}});var r=i(85893),a=i(91430);function n(e){let{children:t}=e,i=(0,a.K)();return(0,r.jsx)(r.Fragment,{children:i(t)})}},53361:function(e,t,i){"use strict";i.d(t,{hT:function(){return v},z0:function(){return p}});var r,a,n=i(85893),o=i(2826),s=i(60023),u=i(72378),l=i.n(u),d=i(67294),c=i(8100),h=function(){return(h=Object.assign||function(e){for(var t,i=1,r=arguments.length;i<r;i++)for(var a in t=arguments[i])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},f=(r=c.ZP,a=function(e){return function(t,i,r){return r.revalidateOnFocus=!1,r.revalidateIfStale=!1,r.revalidateOnReconnect=!1,e(t,i,r)}},function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var i="function"==typeof e[1]?[e[0],e[1],e[2]||{}]:[e[0],null,(null===e[1]?e[2]:e[1])||{}],n=i[0],o=i[1],s=i[2],u=(s.use||[]).concat(a);return r(n,o,h(h({},s),{use:u}))});let g=(0,d.createContext)({targetLanguage:void 0,setTargetLanguage:()=>{},getTranslation:()=>void 0,register:()=>{},isValidating:!1});function p(){let{targetLanguage:e,setTargetLanguage:t,getTranslation:i,register:r,isValidating:a}=(0,d.useContext)(g);return{targetLanguage:e,setTargetLanguage:t,getTranslation:i,register:r,isValidating:a}}function v(e){let{children:t}=e,i=(0,d.useRef)([]),r=(0,d.useRef)(null),[a,u]=(0,d.useState)({}),[c,h]=(0,d.useState)(void 0),p=(0,o.v)(),v=(0,s.Uh)(c)&&c!==p.locale,y=(0,d.useCallback)(e=>{if((0,s.Uh)(c)&&c in a){let t=a[c][e];if("string"==typeof t){let e=document.createElement("textarea");return e.innerHTML=t,e.value}return t}},[c,a]),C=(0,d.useCallback)(e=>{(0,s.Uh)(e)&&!i.current.includes(e)&&(i.current.push(e),null!=r.current&&clearTimeout(r.current),r.current=setTimeout(()=>{v&&k()},1e3))},[v]),b=i.current.filter(e=>(0,s.Uh)(c)&&c in a?!(e in a[c]):a);(0,d.useEffect)(()=>{(0,s.Uh)(c)&&(document.documentElement.lang=c),(0,s.Uh)(c)&&"AR"===c?document.documentElement.dir="rtl":document.documentElement.dir="ltr"},[c]);let{data:w,isValidating:E,mutate:k}=f(v?["/api/deepl/translate",b]:null,async(e,t)=>await m(e,JSON.stringify(t.reduce((e,t)=>({...e,[t]:t}),{})),p.locale,c));(0,d.useEffect)(()=>{(0,s.Uh)(w)&&u(e=>l()(e,w))},[w]);let D=(0,d.useMemo)(()=>({targetLanguage:c,setTargetLanguage:h,getTranslation:y,register:C,isValidating:E}),[c,h,y,C,E]);return(0,n.jsx)(g.Provider,{value:D,children:t})}async function m(e,t,i,r){return(0,s.Uh)(e)&&(0,s.Uh)(r)?await fetch(e,{method:"POST",body:new URLSearchParams({source_lang:i,target_lang:r,text:t})}).then(async e=>await e.json()):{}}},91430:function(e,t,i){"use strict";i.d(t,{K:function(){return n}});var r=i(67294),a=i(53361);function n(){let{register:e,getTranslation:t,isValidating:i}=(0,a.z0)(),[,n]=(0,r.useState)(!1),o=(0,r.useCallback)(i=>{var r;return e(i),null!==(r=t(i))&&void 0!==r?r:i},[e,t]);return(0,r.useEffect)(()=>{n(i)},[i]),o}},30204:function(e,t,i){"use strict";i.d(t,{mD:function(){return s},qy:function(){return o}});var r=i(85893),a=i(67294);let n=(0,a.createContext)({site:"",domain:"",siteName:"",theme:""});function o(){let{site:e,domain:t,siteName:i,theme:r}=(0,a.useContext)(n);return{site:e,domain:t,siteName:i,theme:r}}function s(e){let{children:t,settings:i}=e,{site:o,domain:s,siteName:u,theme:l}=i,d=(0,a.useMemo)(()=>({site:o,domain:s,siteName:u,theme:l}),[o,s,u,l]);return(0,r.jsx)(n.Provider,{value:d,children:t})}},24874:function(e,t,i){"use strict";var r=i(34155);e.exports={getCmsUrl:function(){var e,t;return null!==(t=null!==(e=r.env.DEFAULT_CMS_URL)&&void 0!==e?e:"https://backend-dvg.rotterdam.nl")&&void 0!==t?t:"https://www.domain.com"},getDevRevalidate:function(){return null},getCmsDomain:function(){var e,t;return null!==(t=null!==(e=r.env.DEFAULT_CMS_DOMAIN)&&void 0!==e?e:"backend-dvg.rotterdam.nl")&&void 0!==t?t:""},getReadspeakerId:function(){var e,t;return null!==(t=null!==(e=r.env.READSPEAK_ID)&&void 0!==e?e:"9200")&&void 0!==t?t:""},getSiteImproveId:function(){var e,t;return null!==(t=null!==(e=r.env.SITE_IMPROVE_ID)&&void 0!==e?e:"6006165")&&void 0!==t?t:""},getKameleoonSiteCode:function(){var e,t;return null!==(t=null!==(e=r.env.KAMELEOON_SITE_CODE)&&void 0!==e?e:"7mrohxmwmi")&&void 0!==t?t:""},THEMES:{GGD:"ggd",ROTTERDAM:"rotterdam"}}},60023:function(e,t,i){"use strict";i.d(t,{FA:function(){return l},YO:function(){return c},$W:function(){return g},bJ:function(){return u},Uh:function(){return s},vd:function(){return f},p$:function(){return h},ag:function(){return d}});var r=i(67294),a=i(33493),n=i(24874),o=i(34155);function s(e){return null!=e}function u(e){return void 0!==e&&e.length>0}function l(e){return e.filter(e=>""!==e&&null!=e)}function d(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1024,[t,i]=(0,r.useState)(!0),n=(0,r.useCallback)(()=>{(0,a.C5)()&&(window.matchMedia("(min-width: ".concat(e,"px)")).matches?i(!0):window.matchMedia("(max-width: ".concat(e-1,"px)")).matches?i(!1):i(!0))},[]);return(0,r.useEffect)(()=>(n(),window.addEventListener("resize",n),()=>window.removeEventListener("resize",n)),[]),t}function c(e){return e.filter(e=>s(e))}function h(e,t){var i,r;if(s(t))return s(e)&&s(e[0])&&e.length>0&&s(null===(i=e[0])||void 0===i?void 0:i.styles)&&s(e[0].styles)&&s(e[0].styles[t])&&s(e[0].styles[t])?{src:(r=e[0].styles[t].src,"true"===o.env.STORYBOOK?r:"".concat((0,n.getCmsUrl)()).concat(r)),alt:e[0].alt,width:e[0].styles[t].width,height:e[0].styles[t].height}:void 0}function f(e){return Object.fromEntries(Object.entries(e).filter(e=>{let[t,i]=e;return s(i)}))}function g(e,t){let i=Math.ceil(t/60);return"".concat(e("Reading time"),": ").concat(i>=1?i.toString():"1"," min")}},33493:function(e,t,i){"use strict";function r(){return!0}function a(){return!0}i.d(t,{C5:function(){return r},yv:function(){return a}})},83525:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"actionAsyncStorage",{enumerable:!0,get:function(){return r}});let r=(0,i(14001).createAsyncLocalStorage)();("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},76361:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"actionAsyncStorage",{enumerable:!0,get:function(){return r.actionAsyncStorage}});let r=i(83525);("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},14001:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"createAsyncLocalStorage",{enumerable:!0,get:function(){return n}});let i=Error("Invariant: AsyncLocalStorage accessed in runtime where it is not available");class r{disable(){throw i}getStore(){}run(){throw i}exit(){throw i}enterWith(){throw i}}let a=globalThis.AsyncLocalStorage;function n(){return a?new a:new r}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},8199:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var i in t)Object.defineProperty(e,i,{enumerable:!0,get:t[i]})}(t,{ReadonlyURLSearchParams:function(){return u.ReadonlyURLSearchParams},RedirectType:function(){return u.RedirectType},ServerInsertedHTMLContext:function(){return l.ServerInsertedHTMLContext},notFound:function(){return u.notFound},permanentRedirect:function(){return u.permanentRedirect},redirect:function(){return u.redirect},useParams:function(){return f},usePathname:function(){return c},useRouter:function(){return h},useSearchParams:function(){return d},useSelectedLayoutSegment:function(){return p},useSelectedLayoutSegments:function(){return g},useServerInsertedHTML:function(){return l.useServerInsertedHTML}});let r=i(67294),a=i(60257),n=i(22608),o=i(11288),s=i(66406),u=i(72717),l=i(65988);function d(){let e=(0,r.useContext)(n.SearchParamsContext);return(0,r.useMemo)(()=>e?new u.ReadonlyURLSearchParams(e):null,[e])}function c(){return(0,r.useContext)(n.PathnameContext)}function h(){let e=(0,r.useContext)(a.AppRouterContext);if(null===e)throw Error("invariant expected app router to be mounted");return e}function f(){return(0,r.useContext)(n.PathParamsContext)}function g(e){void 0===e&&(e="children");let t=(0,r.useContext)(a.LayoutRouterContext);return t?function e(t,i,r,a){let n;if(void 0===r&&(r=!0),void 0===a&&(a=[]),r)n=t[1][i];else{var u;let e=t[1];n=null!=(u=e.children)?u:Object.values(e)[0]}if(!n)return a;let l=n[0],d=(0,o.getSegmentValue)(l);return!d||d.startsWith(s.PAGE_SEGMENT_KEY)?a:(a.push(d),e(n,i,!1,a))}(t.tree,e):null}function p(e){void 0===e&&(e="children");let t=g(e);if(!t||0===t.length)return null;let i="children"===e?t[0]:t[t.length-1];return i===s.DEFAULT_SEGMENT_KEY?null:i}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},72717:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var i in t)Object.defineProperty(e,i,{enumerable:!0,get:t[i]})}(t,{ReadonlyURLSearchParams:function(){return o},RedirectType:function(){return r.RedirectType},notFound:function(){return a.notFound},permanentRedirect:function(){return r.permanentRedirect},redirect:function(){return r.redirect}});let r=i(7511),a=i(73394);class n extends Error{constructor(){super("Method unavailable on `ReadonlyURLSearchParams`. Read more: https://nextjs.org/docs/app/api-reference/functions/use-search-params#updating-searchparams")}}class o extends URLSearchParams{append(){throw new n}delete(){throw new n}set(){throw new n}sort(){throw new n}}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},73394:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var i in t)Object.defineProperty(e,i,{enumerable:!0,get:t[i]})}(t,{isNotFoundError:function(){return a},notFound:function(){return r}});let i="NEXT_NOT_FOUND";function r(){let e=Error(i);throw e.digest=i,e}function a(e){return"object"==typeof e&&null!==e&&"digest"in e&&e.digest===i}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},44234:function(e,t){"use strict";var i,r;Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"RedirectStatusCode",{enumerable:!0,get:function(){return i}}),(r=i||(i={}))[r.SeeOther=303]="SeeOther",r[r.TemporaryRedirect=307]="TemporaryRedirect",r[r.PermanentRedirect=308]="PermanentRedirect",("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},7511:function(e,t,i){"use strict";var r,a;Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var i in t)Object.defineProperty(e,i,{enumerable:!0,get:t[i]})}(t,{RedirectType:function(){return r},getRedirectError:function(){return l},getRedirectStatusCodeFromError:function(){return p},getRedirectTypeFromError:function(){return g},getURLFromRedirectError:function(){return f},isRedirectError:function(){return h},permanentRedirect:function(){return c},redirect:function(){return d}});let n=i(82595),o=i(76361),s=i(44234),u="NEXT_REDIRECT";function l(e,t,i){void 0===i&&(i=s.RedirectStatusCode.TemporaryRedirect);let r=Error(u);r.digest=u+";"+t+";"+e+";"+i+";";let a=n.requestAsyncStorage.getStore();return a&&(r.mutableCookies=a.mutableCookies),r}function d(e,t){void 0===t&&(t="replace");let i=o.actionAsyncStorage.getStore();throw l(e,t,(null==i?void 0:i.isAction)?s.RedirectStatusCode.SeeOther:s.RedirectStatusCode.TemporaryRedirect)}function c(e,t){void 0===t&&(t="replace");let i=o.actionAsyncStorage.getStore();throw l(e,t,(null==i?void 0:i.isAction)?s.RedirectStatusCode.SeeOther:s.RedirectStatusCode.PermanentRedirect)}function h(e){if("object"!=typeof e||null===e||!("digest"in e)||"string"!=typeof e.digest)return!1;let[t,i,r,a]=e.digest.split(";",4),n=Number(a);return t===u&&("replace"===i||"push"===i)&&"string"==typeof r&&!isNaN(n)&&n in s.RedirectStatusCode}function f(e){return h(e)?e.digest.split(";",3)[2]:null}function g(e){if(!h(e))throw Error("Not a redirect error");return e.digest.split(";",2)[1]}function p(e){if(!h(e))throw Error("Not a redirect error");return Number(e.digest.split(";",4)[3])}(a=r||(r={})).push="push",a.replace="replace",("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},25329:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"requestAsyncStorage",{enumerable:!0,get:function(){return r}});let r=(0,i(14001).createAsyncLocalStorage)();("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},82595:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var i in t)Object.defineProperty(e,i,{enumerable:!0,get:t[i]})}(t,{getExpectedRequestStore:function(){return a},requestAsyncStorage:function(){return r.requestAsyncStorage}});let r=i(25329);function a(e){let t=r.requestAsyncStorage.getStore();if(t)return t;throw Error("`"+e+"` was called outside a request scope. Read more: https://nextjs.org/docs/messages/next-dynamic-api-wrong-context")}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},11288:function(e,t){"use strict";function i(e){return Array.isArray(e)?e[1]:e}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"getSegmentValue",{enumerable:!0,get:function(){return i}}),("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},65988:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var i in t)Object.defineProperty(e,i,{enumerable:!0,get:t[i]})}(t,{ServerInsertedHTMLContext:function(){return a},useServerInsertedHTML:function(){return n}});let r=i(61757)._(i(67294)),a=r.default.createContext(null);function n(e){let t=(0,r.useContext)(a);t&&t(e)}},76608:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return ra}});var r,a,n,o,s=i(85893),u=i(67294),l=i(9008),d=i.n(l);function c(){return(0,s.jsxs)(d(),{children:[(0,s.jsx)("meta",{name:"mobile-web-app-capable",content:"yes"}),(0,s.jsx)("meta",{name:"apple-mobile-web-app-capable",content:"yes"}),(0,s.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1"}),(0,s.jsx)("meta",{httpEquiv:"Accept-CH",content:"DPR, Viewport-Width, Width"}),(0,s.jsx)("meta",{httpEquiv:"x-ua-compatible",content:"IE=edge"})]})}function h(){return(0,s.jsxs)(d(),{children:[(0,s.jsx)("link",{rel:"apple-touch-icon",sizes:"180x180",href:"/default/apple-touch-icon.png"}),(0,s.jsx)("link",{rel:"icon",type:"image/png",sizes:"32x32",href:"/default/favicon-32x32.png"}),(0,s.jsx)("link",{rel:"icon",type:"image/png",sizes:"16x16",href:"/default/favicon-16x16.png"}),(0,s.jsx)("link",{rel:"mask-icon",href:"/default/safari-pinned-tab.svg",color:"#00811f"}),(0,s.jsx)("link",{rel:"manifest",href:"/manifest.json"}),(0,s.jsx)("link",{rel:"shortcut icon",href:"/favicon.ico?v=2"}),(0,s.jsx)("link",{rel:"icon",href:"/favicon.ico?v=2"}),(0,s.jsx)("meta",{name:"msapplication-TileColor",content:"#ffffff"}),(0,s.jsx)("meta",{name:"msapplication-config",content:"/default/browserconfig.xml"}),(0,s.jsx)("meta",{name:"theme-color",content:"#ffffff"})]})}i(56024),i(67598);var f=i(33493),g=i(92142),p=i.n(g),v=i(30705),m=i(39071);function y(){let e=(0,v.w)();return(0,s.jsx)("div",{className:p().buttonWrapper,tabIndex:-1,id:"skip-to-content",children:(0,s.jsx)("a",{href:"#top-of-content",className:p().button,children:(0,s.jsx)(m.v,{children:e("Skip to content")})})})}var C,b,w,E,k,D=i(65885),S=i(29347),I=(C=function(e,t){return(C=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)},function(e,t){function i(){this.constructor=e}C(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}),T=function(e){function t(t){var i=e.call(this,t)||this;return t.cookies?i.cookies=t.cookies:i.cookies=new D.Z,i}return I(t,e),t.prototype.render=function(){return u.createElement(S.zt,{value:this.cookies},this.props.children)},t}(u.Component),R=i(53361),V=i(30204),O="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==i.g?i.g:"undefined"!=typeof self?self:{},A={},_={},x=(E||(E=1,Object.defineProperty(A,"__esModule",{value:!0}),A.Err=A.Ok=void 0,b=function(){if(w)return _;function e(e){if(!this.ok){if("string"==typeof this.error||void 0===this.error)throw Error(e||this.error||"There was an error! No specific error message was provided.");throw e&&(this.error.message=e),this.error}return this.data}function t(e){return this.ok?this.data:e(this.error)}function i(e){return this.ok?this.data:e}function r(e){return this.ok&&e(this.data),this}return w=1,Object.defineProperty(_,"__esModule",{value:!0}),_.Err=_.Ok=void 0,_.Ok=function(a){return{ok:!0,data:a,throw:e,else:t,or:i,and:r}},_.Err=function(a){return{ok:!1,error:a,throw:e,else:t,or:i,and:r}},_}(),Object.defineProperty(A,"Ok",{enumerable:!0,get:function(){return b.Ok}}),Object.defineProperty(A,"Err",{enumerable:!0,get:function(){return b.Err}})),A);function M(e,t,i,r){return new(i||(i=Promise))(function(t,a){function n(e){try{s(r.next(e))}catch(e){a(e)}}function o(e){try{s(r.throw(e))}catch(e){a(e)}}function s(e){var r;e.done?t(e.value):((r=e.value)instanceof i?r:new i(function(e){e(r)})).then(n,o)}s((r=r.apply(e,[])).next())})}"function"==typeof SuppressedError&&SuppressedError,(td=k||(k={})).Credentials="Credentials",td.EventSourceInitialization="EventSourceInitialization",td.FeatureFlagConfigurationNotFound="FeatureFlagConfigurationNotFound",td.FeatureFlagVariableNotFound="FeatureFlagVariableNotFound",td.FeatureFlagVariationNotFound="FeatureFlagVariationNotFound",td.FeatureFlagExperimentNotFound="FeatureFlagExperimentNotFound",td.FeatureFlagEnvironmentDisabled="FeatureFlagEnvironmentDisabled",td.VisitAmount="VisitAmount",td.VisitorCodeMaxLength="VisitorCodeMaxLength",td.VisitorCodeEmpty="VisitorCodeEmpty",td.StorageInitialization="StorageInitialization",td.StorageWrite="StorageWrite",td.StorageRead="StorageRead",td.StorageParse="StorageParse",td.StorageEmpty="StorageEmpty",td.ClientConfiguration="ClientConfiguration",td.TargetingCondition="TargetingCondition",td.AmongValuesCheck="AmongValuesCheck",td.RangeCheck="RangeCheck",td.Initialization="Initialization",td.JSONParse="JSONParse",td.NumberParse="NumberParse",td.VersionParse="VersionParse",td.CookieParse="CookieParse",td.SemanticVersionParse="SemanticVersionParse",td.RemoteData="RemoteData",td.MaximumRetriesReached="MaximumRetriesReached";let N={[k.CookieParse]:e=>`Couldn't parse cookie string: ${e}`,[k.JSONParse]:e=>`Couldn't parse JSON variable: ${e}`,[k.NumberParse]:e=>`It's not possible to parse value ${e} to Number`,[k.VersionParse]:e=>`It's not possible to parse a version value ${e} to Number, version should be in format x.x`,[k.SemanticVersionParse]:e=>`It's not possible to parse a version value ${e} to Number, version should be in format x.x.x`,[k.Initialization]:()=>"It seems that the client wasn't properly initialized, make sure to run `initialize` method before invoking other methods",[k.Credentials]:()=>"KameleoonClient can not be created without credentials",[k.StorageInitialization]:()=>"There was an error while initializing React Native SDK storage, it seems that the storage library dependency wasn't installed",[k.EventSourceInitialization]:()=>"There was an error while initializing Real Time Update service, it seems that the event source library dependency wasn't installed",[k.FeatureFlagConfigurationNotFound]:e=>`No feature flag with key ${e} was found.`,[k.FeatureFlagEnvironmentDisabled]:(e,t)=>`Feature flag with key ${e} is disabled in ${t} environment.`,[k.FeatureFlagVariableNotFound]:(e,t)=>`No feature flag variable with key ${e} was found for ${t} visitorCode.`,[k.FeatureFlagVariationNotFound]:(e,t)=>`No feature flag variation with key ${e} was found for ${t} visitorCode.`,[k.FeatureFlagExperimentNotFound]:(e,t)=>`No feature flag experiment with id ${e} was found for ${t} visitorCode.`,[k.VisitAmount]:()=>"Visit amount must be a number between 1 and 25",[k.VisitorCodeMaxLength]:()=>"Visitor code can not be more than 255 characters long",[k.VisitorCodeEmpty]:()=>"Visitor code can not be empty",[k.StorageWrite]:e=>`Couldn't update storage for kameleoonClient: ${e}`,[k.StorageRead]:e=>`No data found in storage under ${e} key`,[k.StorageEmpty]:()=>"No data found in storage",[k.StorageParse]:(e,t)=>`Couldn't parse ${t} storage data, the data may be corrupted. Error: ${e}`,[k.ClientConfiguration]:e=>`Couldn't retrieve client configuration from Kameleoon Api. Error: ${e}`,[k.TargetingCondition]:e=>`${e} targeting condition is not yet supported.`,[k.AmongValuesCheck]:(e,t)=>`Couldn't parse value "${t}": ${e}`,[k.RangeCheck]:e=>`Couldn't parse value "${e}" as a range, value should be in format [x: number, y: number]`,[k.RemoteData]:e=>`Couldn't retrieve data from Kameleoon server. Error: ${e}`,[k.MaximumRetriesReached]:e=>`Maximum retries reached, request failed. Reason: ${e}`};function F(e){throw Error(`Reaching an impossible state because of ${e}`)}class $ extends Error{constructor(e,t,i){switch(super(`Error: ${e}`),this.name="KameleoonError",this.errorType=e,e){case k.Initialization:case k.Credentials:case k.VisitorCodeMaxLength:case k.VisitorCodeEmpty:case k.StorageInitialization:case k.VisitAmount:case k.EventSourceInitialization:case k.StorageEmpty:this.message=N[e]();break;case k.CookieParse:case k.FeatureFlagConfigurationNotFound:case k.NumberParse:case k.ClientConfiguration:case k.MaximumRetriesReached:case k.RemoteData:case k.VersionParse:case k.SemanticVersionParse:this.message=N[e](t);break;case k.FeatureFlagExperimentNotFound:case k.FeatureFlagVariationNotFound:case k.FeatureFlagEnvironmentDisabled:case k.FeatureFlagVariableNotFound:this.message=N[e](t,i);break;case k.StorageWrite:case k.JSONParse:case k.StorageRead:this.message=N[e](t);break;case k.StorageParse:this.message=N[e](t,i);break;case k.TargetingCondition:this.message=N[e](t);break;case k.AmongValuesCheck:this.message=N[e](t,i);break;case k.RangeCheck:this.message=N[e](t);break;default:F(e)}}get type(){return this.errorType}}(tc=t3||(t3={})).DataApi="dataApi",tc.Events="events",tc.ClientConfiguration="clientConfiguration",(th=t4||(t4={})).Get="GET",th.Post="POST",(tf=t6||(t6={}))[tf.VisitEvent=0]="VisitEvent",tf[tf.VisitData=1]="VisitData",tf[tf.DataMap=2]="DataMap",(tg=t5||(t5={})).Configuration="configuration",tg.Tracking="tracking",tg.RemoteData="remoteData",(tp=t9||(t9={})).UserAgent="User-Agent",tp.ContentType="Content-Type",tp.SdkVersion="X-Kameleoon-SDK-Version",tp.SdkType="X-Kameleoon-SDK-Type",tp.Authorization="Authorization",tp.AcceptEncoding="Accept-Encoding",tp.IfModifiedSince="If-Modified-Since",tp.LastModified="Last-Modified";let P="eventType=staticData",L="&browserIndex=",U="&browserVersion=",j="&deviceType=",K="&visitorCode=",G="&nonce=",z="&id=",B="&maxNumberPreviousVisits=",q="&os=",H="&osIndex=",W="&browser=",Y="&mappingValue=",J="visit/",X={[t3.DataApi]:"data.kameleoon.io",[t3.Events]:"events.kameleoon.eu",[t3.ClientConfiguration]:"sdk-config.kameleoon.eu"};(tv=t8||(t8={}))[tv.NONE=0]="NONE",tv[tv.ERROR=1]="ERROR",tv[tv.WARNING=2]="WARNING",tv[tv.INFO=3]="INFO",tv[tv.DEBUG=4]="DEBUG";let Q={[t8.NONE]:"NONE",[t8.ERROR]:"ERROR",[t8.WARNING]:"WARNING",[t8.INFO]:"INFO",[t8.DEBUG]:"DEBUG"},Z=(e,t)=>"credentials"===e?{clientId:"****",clientSecret:"****"}:t instanceof Map?Array.from(t.entries()):t;class ee{static setLogger(e){ee.logger=e}static setLogLevel(e){ee.logLevel=e}static log({level:e,strings:t,keys:i}){let r;if(ee.checkLevel(e)){if("string"==typeof t)r=t;else if("function"==typeof t)try{r=t()}catch(e){r="Failed to log message"}else r=function(e,t){let i="";if(t)for(let r=0;r<t.length;r++){let a=t[r];if("object"==typeof a)try{i+=e[r]+JSON.stringify(a,Z)}catch(t){i+=e[r]+"{object}"}else i+="string"==typeof a?e[r]+"'"+a+"'":e[r]+a}return i+e[e.length-1]}(t,i);ee.writeMessage(e,r)}}static info(e,...t){ee.log({level:t8.INFO,strings:e,keys:t})}static error(e,...t){ee.log({level:t8.ERROR,strings:e,keys:t})}static warning(e,...t){ee.log({level:t8.WARNING,strings:e,keys:t})}static debug(e,...t){ee.log({level:t8.DEBUG,strings:e,keys:t})}static checkLevel(e){return e<=ee.logLevel&&e!==t8.NONE}static writeMessage(e,t){ee.logger.log(e,`Kameleoon [${Q[e]}]: ${t}`)}}ee.logger=new class{log(e,t){switch(e){case t8.DEBUG:console.debug(t);break;case t8.INFO:console.info(t);break;case t8.WARNING:console.warn(t);break;case t8.ERROR:console.error(t)}}},ee.logLevel=t8.WARNING;let et=class{constructor({urlProvider:e,packageInfo:t,externalRequester:i,requestTimeout:r,trackRetryDelay:a,useAbortController:n}){ee.debug`CALL: new Requester(urlProvider, packageInfo: ${t}, externalRequester, requestTimeout: ${r}, trackRetryDelay: ${a}, useAbortController: ${n})`,this.urlProvider=e,this.useAbortController=n,this.externalRequester=i,this.trackRetryDelay=a,this.packageInfo=t,this.timeout=r,ee.debug`RETURN: new Requester(urlProvider, packageInfo: ${t}, externalRequester, requestTimeout: ${r}, trackRetryDelay: ${a}, useAbortController: ${n})`}getClientConfiguration(e,t){return M(this,0,void 0,function*(){let i=this.urlProvider.getClientConfigurationUrl(e),r=Object.assign({[t9.SdkType]:this.packageInfo.type.toLowerCase(),[t9.SdkVersion]:this.packageInfo.version},t&&{[t9.IfModifiedSince]:t});try{let e={message:""};ee.debug`Running configuration request Method: ${t4.Get}, Url: ${i}, Headers: ${r}, with retry limit ${3}`;for(let t=0;t<3;t++){let a=yield this.sendRequest({url:i,requestType:t5.Configuration,retryCount:t,parameters:{method:t4.Get,headers:r}});if(a.ok){let e=yield a.json();this.logReceivedConfigurationResponse(a.status,i,r);let t=this.getLastModifiedHeader(a);return x.Ok({configuration:e,lastModified:t})}if(304===a.status)return this.logReceivedConfigurationResponse(a.status,i,r),x.Ok({});if(2===t){if(a.text){let t=yield a.text();e=JSON.parse(t)}ee.error`Failed to get configuration response ${{status:a.status,message:e.message}} for request Method: ${t4.Get}, Url: ${i}, Headers: ${r}`}else yield this.logRequestError({logLevel:t8.WARNING,message:"Failed to get configuration response",response:a,method:t4.Get,url:i})}return x.Err(new $(k.MaximumRetriesReached,e.message))}catch(e){return yield this.logRequestError({logLevel:t8.ERROR,message:"Failed to get configuration response",error:e,method:t4.Get,url:i,headers:r}),x.Err(new $(k.ClientConfiguration,e))}})}getRemoteData(e){var t;return M(this,0,void 0,function*(){let i=this.urlProvider.getRemoteDataUrl(e);ee.debug`Running remote data request Method: ${t4.Get}, Url: ${i}`;try{let e=yield this.sendRequest({url:i,requestType:t5.RemoteData,retryCount:0,parameters:{method:t4.Get}});if(!e.ok){if(yield this.logRequestError({logLevel:t8.ERROR,message:"Failed to get remote data response",response:e,method:t4.Get,url:i}),e.text){let i=yield e.text(),r=null===(t=JSON.parse(i))||void 0===t?void 0:t.message;return x.Err(new $(k.RemoteData,r))}return x.Err(new $(k.RemoteData,"Unknown Reason - no `text()` was found for a response"))}let r=yield e.json();return ee.debug`Received remote data response: ${{status:e.status}} for request Method: ${t4.Get}, Url: ${i}`,x.Ok(r)}catch(e){return yield this.logRequestError({logLevel:t8.ERROR,message:"Failed to get remote data response",error:e,method:t4.Get,url:i}),x.Err(new $(k.RemoteData,e))}})}getVisitorData({visitorCode:e,filters:t,isMappingIdentifier:i}){var r;return M(this,0,void 0,function*(){let a=this.urlProvider.getVisitorDataUrl({visitorCode:e,filters:t,isMappingIdentifier:i});ee.debug`Running visitor data request Method: ${t4.Get}, Url: ${a}`;try{let e=yield this.sendRequest({url:a,requestType:t5.RemoteData,retryCount:0,parameters:{method:t4.Get}});if(!e.ok){if(yield this.logRequestError({logLevel:t8.ERROR,message:"Failed to get visitor data response",response:e,method:t4.Get,url:a}),"function"==typeof e.text){let t=yield e.text();if(t){let e=null===(r=JSON.parse(t))||void 0===r?void 0:r.message;return x.Err(new $(k.RemoteData,e))}}return e.status?x.Err(new $(k.RemoteData,`No error message. Error status: ${e.status}`)):x.Err(new $(k.RemoteData,"Unknown Reason - no text message or error status was found for a response"))}let t=yield e.json();return ee.debug`Received visitor data response: ${{status:e.status}} for request Method: ${t4.Get}, Url: ${a}`,x.Ok(t)}catch(e){return yield this.logRequestError({logLevel:t8.ERROR,message:"Failed to get visitor data response",error:e,method:t4.Get,url:a}),x.Err(new $(k.RemoteData,e))}})}track(e,t){return M(this,0,void 0,function*(){let i=this.urlProvider.getTrackingUrl(t);ee.debug`Running tracking request Method: ${t4.Post}, Url: ${i}, Body: ${e}, with retry limit ${3}, retry delay ${this.trackRetryDelay} ms`;for(let t=0;t<3;t++){let r;try{if((r=yield this.sendRequest({url:i,retryCount:t,requestType:t5.Tracking,parameters:{body:e,method:t4.Post,headers:{[t9.ContentType]:"*/*"}}})).ok)return ee.debug`Received tracking response: ${{status:r.status}} for request Method: ${t4.Post}, Url: ${i}, Body: ${e}`,x.Ok();yield this.logRequestError({logLevel:2==t?t8.ERROR:t8.WARNING,message:"Failed to get tracking response",response:r,method:t4.Post,url:i})}catch(e){yield this.logRequestError({logLevel:2==t?t8.ERROR:t8.WARNING,message:"Failed to get tracking response",error:e,method:t4.Post,url:i})}t<3&&(yield new Promise(e=>setTimeout(e,this.trackRetryDelay)))}return x.Err()})}sendRequest({url:e,requestType:t,retryCount:i,parameters:r}){return M(this,0,void 0,function*(){let a;if(this.useAbortController){let n=new AbortController,o=setTimeout(()=>n.abort(),this.timeout);a=yield this.externalRequester.sendRequest({url:e,retryCount:i,requestType:t,parameters:Object.assign(Object.assign({},r),{signal:n.signal})}),clearTimeout(o)}else a=yield this.externalRequester.sendRequest({url:e,retryCount:i,requestType:t,parameters:r});return a})}logRequestError({logLevel:e,message:t,error:i,method:r,url:a,response:n,headers:o}){return M(this,0,void 0,function*(){if(i){let n="Unknown error";i instanceof Error&&(n=i.message),ee.log({level:e,strings:()=>`${t} with error: ${n} for request Method: ${r}, Url: ${a}`})}else if(n&&ee.checkLevel(e)){let i=yield this.parseResponse(n);ee.log({level:e,strings:()=>`${t} response: Status: '${i.status}' Message: '${i.message}' for request Method: ${r}, Url: '${a}'`+(o?`, Headers: ${o}`:"")})}})}parseResponse(e){return M(this,0,void 0,function*(){let t="";try{if("function"==typeof e.text){let i=yield e.text();i&&(t=i)}}catch(e){}return{status:e.status,message:t}})}getLastModifiedHeader(e){if(e.headers){let t=t9.LastModified.toLowerCase();for(let[i,r]of e.headers)if(i.toLowerCase()===t)return r}}logReceivedConfigurationResponse(e,t,i){ee.debug`Received configuration response: ${{status:e}} for request Method: ${t4.Get}, Url: ${t}, Headers: ${i}`}};(tm=t7||(t7={})).Production="production",tm.Staging="staging",tm.Development="development";class ei{constructor(){this.ready=!1,this.isCustomDomain=!1,this.domains=X}initialize({domain:e,siteCode:t,packageInfo:i,environment:r}){this.siteCode=t,this.environment=r,this.packageInfo=i,this.ready=!0,this.setDomains(e)}set dataApiDomain(e){if(!this.isCustomDomain)return void(this.domains[t3.DataApi]=e);let t=e.split(".")[0],i=this.domains[t3.DataApi];this.domains[t3.DataApi]=i.replace(/^[^.]+/,t)}getClientConfigurationUrl(e){this.isInitialized();let t=`https://${this.domains[t3.ClientConfiguration]}/v3/`,i=this.environment===t7.Production?"":"?environment="+encodeURIComponent(this.environment),r="";return e&&(r=i?"&ts="+e:"?ts="+e),t+this.siteCode+i+r}getEventSourceUrl(){return this.isInitialized(),`https://${this.domains[t3.Events]}:8110/sse?siteCode=${this.siteCode}`}getRemoteDataUrl(e){return this.isInitialized(),this.getDataApiUrl(t6.DataMap)+this.siteCode+"&key="+encodeURI(e)}getVisitorDataUrl({visitorCode:e,filters:t,isMappingIdentifier:i}){this.isInitialized();let{customData:r,previousVisitAmount:a,currentVisit:n,conversions:o,geolocation:s,experiments:u,pageViews:l,device:d,browser:c,operatingSystem:h,kcs:f,personalization:g,visitorCode:p,cbs:v}=t;return this.getDataApiUrl(t6.VisitData)+this.siteCode+(i?Y:K)+e+("number"!=typeof a?B+1:B+a)+(r||p?"&customData=true":"")+(o?"&conversion=true":"")+(s?"&geolocation=true":"")+(u?"&experiment=true":"")+(l?"&page=true":"")+"&staticData=true"+(n?"&currentVisit=true":"")+(f?"&kcs=true":"")+(g?"&personalization=true":"")+(v?"&cbs=true":"")}getTrackingUrl(e){this.isInitialized();let{type:t,version:i}=this.packageInfo,r=this.getDataApiUrl(t6.VisitEvent)+this.siteCode+"&sdkName="+t.toLowerCase()+"&sdkVersion="+i;return e&&(r+="&bodyUa=true"),r}isInitialized(){if(!this.ready)throw Error("UrlProvider is not initialized")}getDataApiUrl(e){if(!this.domains[t3.DataApi])throw Error("Data API domain is not set");let t=`https://${this.domains[t3.DataApi]}`;switch(e){case t6.VisitEvent:return`${t}/${J+"events?siteCode="}`;case t6.VisitData:return`${t}/${J+"visitor?siteCode="}`;case t6.DataMap:return`${t}/map/map?siteCode=`}}setDomains(e){e&&(this.isCustomDomain=!0,this.domains[t3.DataApi]="data."+e,this.domains[t3.Events]="events."+e,this.domains[t3.ClientConfiguration]="sdk-config."+e)}}(ty=ie||(ie={})).BOOLEAN="BOOLEAN",ty.NUMBER="NUMBER",ty.STRING="STRING",ty.JSON="JSON",ty.JS="JS",ty.CSS="CSS",(tC=it||(it={})).Sent="sent",tC.Unsent="unsent",tC.Pending="pending",(tb=ii||(ii={}))[tb.Second=1e3]="Second",tb[tb.Minute=6e4]="Minute",tb[tb.Hour=36e5]="Hour",tb[tb.Day=864e5]="Day",tb[tb.Week=6048e5]="Week",tb[tb.Month=2592e6]="Month";class er{constructor(e){this.cacheMap=new Map,this.intervalId=null,this.cleanupTimeout=e*ii.Second}add({key:e,data:t,lifetime:i}){ee.debug`CALL: CacheManager.add(key: ${e}, data: ${t}, lifetime: ${i})`,null===this.intervalId&&this.activate();let r=i*ii.Second,a={data:t,expirationTime:Date.now()+r};this.cacheMap.set(e,a),ee.debug`RETURN: CacheManager.add(key: ${e}, data: ${t}, lifetime: ${i})`}getAliveItem(e){ee.debug`CALL: CacheManager.getAliveItem(key: ${e})`;let t=this.cacheMap.get(e);if(t&&t.expirationTime>=Date.now()){let i=t.data;return ee.debug`RETURN: CacheManager.getAliveItem(key: ${e}) -> (item: ${i})`,i}return t&&this.cacheMap.delete(e),ee.debug`RETURN: CacheManager.getAliveItem(key: ${e}) -> (item: null)`,null}activate(){this.intervalId=setInterval(()=>{let e=Date.now();for(let[t,i]of this.cacheMap)i.expirationTime<e&&this.cacheMap.delete(t);this.cacheMap.size||this.cleanupInterval()},this.cleanupTimeout)}cleanupInterval(){this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null)}}(tw=ir||(ir={}))[tw.Polling=0]="Polling",tw[tw.RealTime=1]="RealTime",(tE=ia||(ia={})).TARGETED_DELIVERY="TARGETED_DELIVERY",tE.EXPERIMENTATION="EXPERIMENTATION",(tk=io||(io={})).ANDROID="ANDROID",tk.SWIFT="SWIFT",tk.JAVA="JAVA",tk.CSHARP="CSHARP",tk.NODEJS="NODEJS",tk.PHP="PHP",tk.RUBY="RUBY",tk.GO="GO",tk.FLUTTER="FLUTTER",tk.REACTJS="REACTJS",(tD=is||(is={})).ACTIVATED="ACTIVATED",tD.DEACTIVATED="DEACTIVATED",tD.SCHEDULED="SCHEDULED",(tS=iu||(iu={})).Visit="VISIT",tS.Visitor="VISITOR",tS.Page="Page",(tI=il||(il={})).Required="REQUIRED",tI.NotRequired="NOT_REQUIRED";class ea{addEventHandler(e,t){this.eventHandlers||(this.eventHandlers=new Map),this.eventHandlers.set(e,t)}fireEvent(e,t){var i;let r=null===(i=this.eventHandlers)||void 0===i?void 0:i.get(e);r&&t&&r(t)}}(tT=id||(id={})).Evaluation="evaluation",tT.ConfigurationUpdate="configurationUpdate",il.NotRequired;let en={customData:[],featureFlags:[],configuration:{realTimeUpdate:!1,consentType:il.NotRequired,dataApiDomain:"data.kameleoon.io"}};class eo{constructor(e){this._featureFlags=e.slice().sort((e,t)=>e.id-t.id)}getFeatureFlagByHash(e){let t=Math.floor(e*this._featureFlags.length);return t=Math.min(t,this._featureFlags.length-1),this._featureFlags[t]}get featureFlags(){return this._featureFlags}}class es{constructor({updateInterval:e,urlProvider:t,storage:i,requester:r,dataManager:a,eventSource:n,externalVisitorCodeManager:o,eventManager:s,externalPackageInfo:u,defaultDataFile:l}){this.updateConfigurationIntervalId=null,this.updateType=ir.Polling,this.configurationData=en,this.featureFlagsData=new Map,this.isTargetedDeliveryRule=null,this.segmentsData=null,this.holdoutData=null,this.meGroupsData=new Map,this.mappedRules=null,this.mappedExperiments=null,this.usedDefaultDataFile=!1,this.CACHE_REVALIDATE_PERIOD=90*ii.Minute,this.urlProvider=t,this.requester=r,this.updateInterval=e,this.lastUpdate=new Date,this.storage=i,this.dataManager=a,this.eventManager=s,this.visitorCodeManager=o,this.eventSource=n,this.externalPackageInfo=u,this.defaultDataFile=l}initialize(){return M(this,0,void 0,function*(){if(ee.debug("CALL: ClientConfiguration.initialize()"),this.readStorageData(),this.checkShouldUpdate()){let e=yield this.updateClientConfiguration();if(!e.ok)return ee.error("Error occurred during client configuration update"),e;if(e.data)return ee.debug("RETURN: ClientConfiguration.initialize()"),x.Ok()}return this.updateType!==ir.RealTime||this.eventSource.isOpen?this.updateType===ir.Polling&&this.handlePollingUpdates():this.handleRealTimeUpdates(),ee.debug("RETURN: ClientConfiguration.initialize()"),x.Ok()})}cleanupHandlers(){this.eventSource.isOpen&&this.eventSource.close(),this.updateConfigurationIntervalId&&clearInterval(this.updateConfigurationIntervalId)}handleRealTimeUpdates(){this.cleanupHandlers(),this.eventSource.open(e=>{this.updateClientConfiguration(e).then(t=>{t.ok&&this.eventManager.fireEvent(id.ConfigurationUpdate,{timestamp:e})})}),this.eventSource.onError(e=>{ee.error`Error occurred during real-time update: ${e}. Switching to polling updates while the connection is not restored.`,this.updateType=ir.Polling,this.handlePollingUpdates()})}handlePollingUpdates(){this.cleanupHandlers();try{let e=this.lastUpdate.getTime(),t=Date.now(),i=Math.max(this.updateInterval-(t-e),0);setTimeout(()=>M(this,0,void 0,function*(){yield this.updateClientConfiguration(),this.updateConfigurationIntervalId=setInterval(this.updateClientConfiguration.bind(this),this.updateInterval)}),i)}catch(e){throw this.updateConfigurationIntervalId&&clearInterval(this.updateConfigurationIntervalId),e}}get featureFlags(){return this.featureFlagsData}get configuration(){return this.configurationData.configuration}get segments(){if(this.segmentsData)return this.segmentsData;let e=new Map;return this.featureFlagsData.forEach(t=>{t.rules.forEach(t=>{t.segment&&!e.has(t.segment.id.toString())&&e.set(t.segment.id.toString(),t.segment)})}),this.segmentsData=e,e}get ruleMap(){var e;if(null===(e=this.mappedRules)||void 0===e?void 0:e.size)return this.mappedRules;let t=new Map;for(let e of this.featureFlags.values())for(let i of e.rules){let{id:r,experimentId:a,variationByExposition:n}=i,o=new Map;n.forEach(({variationKey:e,variationId:t})=>{"number"==typeof t&&o.set(e,t)}),t.set(r,{featureId:e.id,experimentId:a,variations:o})}return this.mappedRules=t,t}get experimentMap(){var e;if(null===(e=this.mappedExperiments)||void 0===e?void 0:e.size)return this.mappedExperiments;let t=new Map;for(let e of this.featureFlags.values())for(let i of e.rules){let{experimentId:e,variationByExposition:r}=i,a=new Map;r.forEach(({variationKey:e,variationId:t})=>{"number"==typeof t&&a.set(e,t)}),t.set(e,{type:i.type,variations:a})}return this.mappedExperiments=t,t}get holdout(){return this.holdoutData}get meGroups(){return this.meGroupsData}get isConsentRequired(){return this.configuration.consentType===il.Required}get hasAnyTargetedDeliveryRule(){if(null!==this.isTargetedDeliveryRule)return this.isTargetedDeliveryRule;for(let e of this.featureFlags.values())if(e.environmentEnabled&&e.rules.some(e=>e.type===ia.TARGETED_DELIVERY))return!0;return!1}checkShouldUpdate(){let{configuration:e}=this.configurationData;return this.updateType=e.realTimeUpdate?ir.RealTime:ir.Polling,!this.featureFlags.size||this.lastUpdate.getTime()<Date.now()-this.updateInterval}readStorageData(){var e,t,i;ee.debug("CALL: ClientConfiguration.readStorageData()");let r=this.storage.read();if(r.ok){let{data:a,lastUpdate:n,lastModified:o,requestTime:s}=r.data,u=!1;if(this.defaultDataFile)try{let r=JSON.parse(this.defaultDataFile);this.defaultDataFile=void 0,this.usedDefaultDataFile=!0;let n=null!==(t=null!==(e=a.dateModified)&&void 0!==e?e:s)&&void 0!==t?t:-1,o=null!==(i=r.dateModified)&&void 0!==i?i:0;(!s||o>n)&&(a=r,u=!0)}catch(e){ee.error`Error parsing default data file: ${String(e)}`}this.updateConfigurationData(a,u),this.lastUpdate=new Date(this.usedDefaultDataFile?0:Date.parse(n)),this.lastModified=o,this.requestTime=s}ee.debug`RETURN: ClientConfiguration.readStorageData() -> (result: ${r.ok})`}updateClientConfiguration(e){return M(this,0,void 0,function*(){let t=Date.now();if(this.usedDefaultDataFile)return this.updateClientConfigurationInBackground(),x.Ok(!1);if(this.requestTime&&!e&&!this.externalPackageInfo.isServer){if(t-this.requestTime<=this.CACHE_REVALIDATE_PERIOD)return this.updateClientConfigurationInBackground(),x.Ok(!1);ee.debug`Cached configuration data has expired. Fetching fresh data.`}let i=yield this.requester.getClientConfiguration(e,this.lastModified);return this.applyNewConfigurationDataFromResponse(i)})}updateClientConfigurationInBackground(){setTimeout(()=>M(this,0,void 0,function*(){let e=yield this.requester.getClientConfiguration(void 0,this.lastModified);yield this.applyNewConfigurationDataFromResponse(e)}),0)}applyNewConfigurationDataFromResponse(e){var t,i;return M(this,0,void 0,function*(){if(this.requestTime=Date.now(),!e.ok)return this.featureFlags.size?(ee.error("Error occurred while updating configuration. Existing configuration will be used as a fallback."),x.Ok(!0)):e;if(void 0===e.data.configuration)return this.updateStorageData(),x.Ok(!1);let r=e.data.configuration;this.updateConfigurationData(r,!0),this.dataManager.clearTrees(),null===(t=this.mappedRules)||void 0===t||t.clear(),null===(i=this.experimentMap)||void 0===i||i.clear(),this.isTargetedDeliveryRule=null,e.data.lastModified&&(this.lastModified=e.data.lastModified);let a=this.updateStorageData();if(!a.ok)return a;let n=r.configuration.realTimeUpdate?ir.RealTime:ir.Polling,o=n!==this.updateType;return o&&(this.updateType=n,ee.info`Configuration update type was toggled to ${ir[n]}`,yield this.initialize()),x.Ok(o)})}updateConfigurationData(e,t=!0){let{configuration:i,featureFlags:r,customData:a,holdout:n,segments:o,dateModified:s}=e,u=o?new Map(o.map(e=>[e.id.toString(),e])):null,l=null;if(t&&(null==a?void 0:a.length))for(let e of(l=new Map,a)){if(void 0===e.id){l=null;break}l.set(e.id,e.index)}let d=new Map;for(let e of r)d.set(e.featureKey,e),t&&(this.updateFeatureFlagSegments(e,u),this.updateFeatureFlagBucketingCustomDataId(e,l));this.featureFlagsData=d,(null==a?void 0:a.length)&&(this.dataManager.customDataIndexes=a),this.meGroupsData=this.makeMEGroups(r),this.holdoutData=null!=n?n:null,this.configurationData={configuration:i,customData:a,holdout:n,dateModified:s},this.urlProvider.dataApiDomain=e.configuration.dataApiDomain,this.updateConsentRequired(),this.segmentsData=u}updateFeatureFlagSegments(e,t){null!==t&&e.rules.forEach(e=>{var i;let r=e.segmentId;e.segment=null!=r&&null!==(i=t.get(r.toString()))&&void 0!==i?i:null})}updateFeatureFlagBucketingCustomDataId(e,t){let i=e.bucketingCustomDataId;null!=i&&t&&(e.bucketingCustomDataIndex=t.get(i))}makeMEGroups(e){let t=new Map;e.forEach(e=>{let i=e.mutuallyExclusiveGroup;if(i){let r=t.get(i);r?r.push(e):t.set(i,[e])}});let i=new Map;return t.forEach((e,t)=>{i.set(t,new eo(e))}),i}updateStorageData(){this.lastUpdate=new Date;let e={data:Object.assign(Object.assign({},this.configurationData),{featureFlags:Array.from(this.featureFlags.values()),segments:this.segmentsData?Array.from(this.segmentsData.values()):void 0}),lastUpdate:this.lastUpdate.toString(),lastModified:this.lastModified,requestTime:this.requestTime};return this.storage.write(e)}updateConsentRequired(){this.visitorCodeManager.consentRequired=this.isConsentRequired&&!this.hasAnyTargetedDeliveryRule}}function eu(e){return Object.fromEntries(Object.entries(e).map(([e,t])=>[t,e]))}(tR=ic||(ic={})).UniqueIdentifier="uniqueIdentifier",tR.CustomData="customData",tR.PageView="pageView",tR.GeolocationData="geolocation",tR.Browser="browser",tR.Conversion="conversion",tR.Cookie="cookie",tR.Device="device",tR.OperatingSystem="operatingSystem",tR.UserAgent="userAgent",tR.ApplicationVersion="applicationVersion",tR.VisitsData="visitsData",tR.KameleoonConversionScore="kameleoonConversionScore",tR.Personalization="personalization",tR.CBScores="cbScores",tR.TargetedSegment="targetedSegment",(tV=ih||(ih={})).Phone="PHONE",tV.Tablet="TABLET",tV.Desktop="DESKTOP",(tO=ig||(ig={})).WindowsPhone="WINDOWS_PHONE",tO.Windows="WINDOWS",tO.Android="ANDROID",tO.Linux="LINUX",tO.Mac="MAC",tO.IOS="IOS",(tA=ip||(ip={})).Chrome="CHROME",tA.InternetExplorer="IE",tA.Firefox="FIREFOX",tA.Safari="SAFARI",tA.Opera="OPERA",tA.Other="OTHER";let el={[ig.Windows]:0,[ig.Mac]:1,[ig.IOS]:2,[ig.Linux]:3,[ig.Android]:4,[ig.WindowsPhone]:5},ed=eu(el),ec={[ip.Chrome]:0,[ip.InternetExplorer]:1,[ip.Firefox]:2,[ip.Safari]:3,[ip.Opera]:4,[ip.Other]:5},eh=eu(ec),ef="warehouseAudiences";(t_=iv||(iv={})).ANDROID="ANDROID",t_.IOS="IOS",t_.JAVA="JAVA",t_.CSHARP="CSHARP",t_.NODEJS="NODEJS",t_.PHP="PHP",t_.RUBY="RUBY",t_.GO="GO",t_.FLUTTER="FLUTTER",t_.REACT="REACT",t_.PYTHON="PYTHON",t_.JAVASCRIPT="JAVASCRIPT",t_.RUST="RUST";let eg={previousVisitAmount:1,currentVisit:!0,customData:!0,pageViews:!1,geolocation:!1,device:!1,browser:!1,operatingSystem:!1,conversions:!1,experiments:!1,kcs:!1,visitorCode:!0,personalization:!1};(tx=im||(im={})).And="AND",tx.Or="OR",(tM=iy||(iy={})).TRUE="TRUE",tM.FALSE="FALSE",tM.EXACT="EXACT",tM.CONTAINS="CONTAINS",tM.REGULAR_EXPRESSION="REGULAR_EXPRESSION",tM.EQUAL="EQUAL",tM.LOWER="LOWER",tM.GREATER="GREATER",tM.UNDEFINED="UNDEFINED",tM.AMONG_VALUES="AMONG_VALUES",tM.RANGE="RANGE",(tN=iC||(iC={})).NEW="NEW",tN.RETURNING="RETURNING",(tF=ib||(ib={})).ANY="ANY",tF.EXACT="EXACT",(t$=iw||(iw={})).ALL="ALL",t$.TEST="TEST",t$.PERSO="PERSO",(tP=iE||(iE={})).Experiment="EXPERIMENT",tP.Personalization="PERSONALIZATION",tP.Any="ANY",(tL=ik||(ik={})).EXACT="EXACT",tL.CONTAINS="CONTAINS",tL.REGULAR_EXPRESSION="REGULAR_EXPRESSION",tL.GREATER="GREATER",tL.EQUAL="EQUAL",tL.LOWER="LOWER",(tU=iD||(iD={})).GREATER="GREATER",tU.EQUAL="EQUAL",tU.LOWER="LOWER",(tj=iS||(iS={})).EXACT="EXACT",tj.CONTAINS="CONTAINS",tj.REGULAR_EXPRESSION="REGULAR_EXPRESSION",tj.OPTIONAL="OPTIONAL",(tK=iI||(iI={})).PAGE_URL="PAGE_URL",tK.PAGE_TITLE="PAGE_TITLE",tK.LANDING_PAGE="LANDING_PAGE",tK.ORIGIN="ORIGIN",tK.ORIGIN_TYPE="ORIGIN_TYPE",tK.REFERRERS="REFERRERS",tK.NEW_VISITORS="NEW_VISITORS",tK.INTERESTS="INTERESTS",tK.BROWSER_LANGUAGE="BROWSER_LANGUAGE",tK.GEOLOCATION="GEOLOCATION",tK.DEVICE_TYPE="DEVICE_TYPE",tK.SCREEN_DIMENSION="SCREEN_DIMENSION",tK.VISITOR_IP="VISITOR_IP",tK.AD_BLOCKER="AD_BLOCKER",tK.PREVIOUS_PAGE="PREVIOUS_PAGE",tK.KEY_PAGES="KEY_PAGES",tK.PAGE_VIEWS="PAGE_VIEWS",tK.FIRST_VISIT="FIRST_VISIT",tK.LAST_VISIT="LAST_VISIT",tK.ACTIVE_SESSION="ACTIVE_SESSION",tK.TIME_SINCE_PAGE_LOAD="TIME_SINCE_PAGE_LOAD",tK.SAME_DAY_VISITS="SAME_DAY_VISITS",tK.VISITS="VISITS",tK.VISITS_BY_PAGE="VISITS_BY_PAGE",tK.VISITOR_CODE="VISITOR_CODE",tK.SDK_LANGUAGE="SDK_LANGUAGE",tK.INTERNAL_SEARCH_KEYWORDS="INTERNAL_SEARCH_KEYWORDS",tK.TABS_ON_SITE="TABS_ON_SITE",tK.CONVERSION_PROBABILITY="CONVERSION_PROBABILITY",tK.HEAT_SLICE="HEAT_SLICE",tK.SKY_STATUS="SKY_STATUS",tK.TEMPERATURE="TEMPERATURE",tK.DAY_NIGHT="DAY_NIGHT",tK.FORECAST_SKY_STATUS="FORECAST_SKY_STATUS",tK.FORECAST_TEMPERATURE="FORECAST_TEMPERATURE",tK.DAY_OF_WEEK="DAY_OF_WEEK",tK.TIME_RANGE="TIME_RANGE",tK.HOUR_MINUTE_RANGE="HOUR_MINUTE_RANGE",tK.JS_CODE="JS_CODE",tK.COOKIE="COOKIE",tK.EVENT="EVENT",tK.BROWSER="BROWSER",tK.OPERATING_SYSTEM="OPERATING_SYSTEM",tK.DOM_ELEMENT="DOM_ELEMENT",tK.MOUSE_OUT="MOUSE_OUT",tK.TARGET_EXPERIMENT="TARGET_EXPERIMENT",tK.TARGET_FEATURE_FLAG="TARGET_FEATURE_FLAG",tK.TARGET_PERSONALIZATION="TARGET_PERSONALIZATION",tK.EXCLUSIVE_EXPERIMENT="EXCLUSIVE_EXPERIMENT",tK.CONVERSIONS="CONVERSIONS",tK.CUSTOM_DATUM="CUSTOM_DATUM",tK.YSANCE_SEGMENT="YSANCE_SEGMENT",tK.SEGMENT="SEGMENT",tK.YSANCE_ATTRIBUT="YSANCE_ATTRIBUT",tK.TEALIUM_BADGE="TEALIUM_BADGE",tK.TEALIUM_AUDIENCE="TEALIUM_AUDIENCE",tK.PRICE_OF_DISPLAYED_PAGE="PRICE_OF_DISPLAYED_PAGE",tK.NUMBER_OF_VISITED_PAGES="NUMBER_OF_VISITED_PAGES",tK.VISITED_PAGES="VISITED_PAGES",tK.CUSTOM="CUSTOM",tK.EXPLICIT_TRIGGER="EXPLICIT_TRIGGER",tK.APPLICATION_VERSION="APPLICATION_VERSION",(tG=iT||(iT={})).Minute="MINUTE",tG.Hour="HOUR",tG.Day="DAY",tG.Week="WEEK",tG.Month="MONTH",(tz=iR||(iR={})).Ascending="asc",tz.Descending="desc";let ep="localhost",ev=/^(\.?(([a-zA-Z\d][a-zA-Z\d-]*[a-zA-Z\d])|[a-zA-Z\d]))(\.(([a-zA-Z\d][a-zA-Z\d-]*[a-zA-Z\d])|[a-zA-Z\d])){1,126}$/;class em{static validateVersion(e){let t=e.split(".").map(e=>parseInt(e,10));for(;t.length<3;)t.push(0);return t.some(e=>isNaN(e))?x.Err(new $(k.SemanticVersionParse,e)):x.Ok(t.slice(0,3))}static validateDomain(e){return e?(e=em.checkAndTrimProtocol(e.toLowerCase()),ev.test(e)||e===ep||ee.error`The top-level domain ${e} is invalid. The value has been set as provided, but it does not meet the required format for proper SDK functionality. Please check the domain for correctness.`,x.Ok(e)):x.Err()}static validateNetworkDomain(e){return e?(e=(e=em.checkAndTrimProtocol(e.toLowerCase())).replace(/^\.+|\.+$/g,""),ev.test(e)||e===ep?x.Ok(e):(ee.error`The network domain ${e} is invalid.`,x.Err())):x.Err()}static checkAndTrimProtocol(e){for(let t of["http://","https://"])if(e.startsWith(t)){e=e.substring(t.length),ee.warning`The domain contains ${t}. Domain after protocol trimming: ${e}`;break}return e}}class ey{static getNonce(e){let t="";for(let i=0;i<16;i++){let i=Math.floor(16*e.getRandomNumber());t+="0123456789ABCDEF".charAt(i)}return t}static checkTargeting({segment:e,visitorCode:t,targetingData:i,experimentId:r,variationConfiguration:a,clientConfiguration:n,packageInfo:o,dataManager:s}){let u,l,d;if(ee.debug`CALL: checkTargeting(segment, visitorCode: ${t}, targetingData: ${i}, experimentId: ${r}, variationConfiguration, clientConfiguration, packageInfo, dataManager)`,!e||!e.conditionsData.firstLevel.length){let e=x.Ok(!0);return ee.debug`RETURN checkTargeting(segment, visitorCode: ${t}, targetingData: ${i}, experimentId: ${r}, variationConfiguration, clientConfiguration, packageInfo, dataManager) -> (result: ${e})`,e}if(!a){let e=x.Err(new $(k.Initialization));return ee.debug`RETURN checkTargeting(segment, visitorCode: ${t}, targetingData: ${i}, experimentId: ${r}, variationConfiguration, clientConfiguration, packageInfo, dataManager) -> (result: ${e})`,e}let c={},h=a.getStoredVariations(t);h.ok&&(c=h.data);let f=s.getTree(e);f.hasTargetingType(iI.SEGMENT)&&(u=s.trees,d=n.segments),f.hasTargetingType(iI.TARGET_FEATURE_FLAG)&&(l=n.ruleMap);let g=f.evaluate({variationData:c,sdkInfo:o,segments:d,ruleMap:l,trees:u,targetingData:i,experimentId:r,visitorCode:t});return ee.debug`RETURN checkTargeting(segment, visitorCode: ${t}, targetingData: ${i}, experimentId: ${r}, variationConfiguration, clientConfiguration, packageInfo, dataManager) -> (result: ${g})`,g}static convertTimeUnit(e,t){return e/({[iT.Minute]:ii.Minute,[iT.Hour]:ii.Hour,[iT.Day]:ii.Day,[iT.Week]:ii.Week,[iT.Month]:ii.Month})[t]}static isCustomData(e){return e.data.type===ic.CustomData}static updateCache({hasJsCssVariables:e,cacheManager:t,visitorCode:i,experimentId:r,variationId:a}){let n=t.getAliveItem(i),o=n?Object.assign({},n):{};o[r]={variationId:a,hasJsCssVariables:e,expirationTime:Date.now()+5*ii.Second},t.add({key:i,data:o,lifetime:5})}static getTrackingCode(e,t){let i="window.kameleoonQueue=window.kameleoonQueue||[];",r=e.getAliveItem(t);if(!r)return i;let a={};return Object.entries(r).forEach(([e,{variationId:t,expirationTime:r,hasJsCssVariables:n}])=>{let o=!n;r>Date.now()&&(i+=`window.kameleoonQueue.push(['Experiments.assignVariation',${e},${t},true]);window.kameleoonQueue.push(['Experiments.trigger',${e},${o}]);`,a[Number(e)]={variationId:t,expirationTime:r,hasJsCssVariables:n})}),e.add({key:t,data:a,lifetime:5}),i}static compareSemVer({version:e,compareVersion:t,operator:i}){let r=em.validateVersion(e),a=em.validateVersion(t);if(!r.ok)return x.Err(r.error);if(!a.ok)return x.Err(a.error);let[n,o,s]=r.data,[u,l,d]=a.data,[c,h,f]=[n===u,o===l,s===d];switch(i){case iD.EQUAL:return x.Ok(c&&h&&f);case iD.GREATER:return x.Ok(n>u||c&&o>l||c&&h&&s>d);case iD.LOWER:return x.Ok(n<u||c&&o<l||c&&h&&s<d);default:ee.error`Unknown version match type: ${i}`,F(i)}}static getVariationByHash(e,t){let i=0;for(let r of e)if((i+=r.exposition)>=t)return r;return null}}class eC{static insertInOrderedListMutably({list:e,element:t,order:i}){if(e.includes(t))return;let r=e.findIndex(e=>i===iR.Ascending?e>=t:e<=t);-1===r?e.push(t):e.splice(r,0,t)}static insertVisitInOrderedListMutably({list:e,visit:t}){if(e.find(e=>"number"==typeof e?e===t.timeStarted:e.timeStarted===t.timeStarted))return;let i=e.findIndex(e=>"number"==typeof e?e>=t.timeStarted:e.timeStarted>=t.timeStarted);-1===i?e.push(t):e.splice(i,0,t),e.length>26&&e.splice(0,e.length-26)}}class eb{constructor({urlAddress:e,title:t,referrers:i}){this.urlAddress=e,this.title=t,this.referrers=i,this.timestamps=[{time:Date.now(),status:it.Unsent}]}get url(){var e;if(!this.urlAddress)return"";let t=this.title?"&title="+encodeURIComponent(this.title):"",i=(null===(e=this.referrers)||void 0===e?void 0:e.length)?"&referrersIndices="+JSON.stringify(this.referrers):"";return"eventType=page&href="+encodeURIComponent(this.urlAddress)+t+i}get status(){let{[it.Sent]:e,[it.Unsent]:t,[it.Pending]:i}=this.timestamps.reduce((e,{status:t})=>(e[t]=!0,e),{[it.Sent]:!1,[it.Unsent]:!1,[it.Pending]:!1});return!e||t||i?i&&!t?it.Pending:it.Unsent:it.Sent}set status(e){this.timestamps=this.timestamps.map(t=>Object.assign(Object.assign({},t),{status:e}))}set _nonce(e){this.nonce=e}get data(){return{urlAddress:this.urlAddress,title:this.title,referrers:this.referrers,type:ic.PageView,timestamps:this.timestamps,status:this.status,nonce:this.nonce}}static _fromRaw(e){let{urlAddress:t,title:i,referrers:r,timestamps:a,nonce:n}=e,o=new eb({urlAddress:t,title:i,referrers:r});return o.timestamps=a,n&&(o._nonce=n),o}static _updateFromVisit(e,t){let i=e.pageEvents;if(i)for(let e of i){let i,r=[],{time:a}=e,{href:n,title:o,referrersIndices:s}=e.data;if("number"==typeof s[0]&&(r=s),t.has(n)){let e=t.get(n).timestamps;(i=new eb({urlAddress:n,title:o,referrers:r})).timestamps=[...e,{time:a,status:it.Sent}]}else(i=new eb({urlAddress:n,title:o,referrers:r})).timestamps=[{time:a,status:it.Sent}];t.set(n,i)}}}let ew=class e{constructor(e,t,...i){this._status=it.Unsent,this.isIdentifier=!1;let r="boolean"==typeof t;"number"==typeof e?this.index=e:(this.name=e,this.index=-1),this.overwrite=!r||t,this.value=r?i:[t,...i].filter(e=>null!=e)}get url(){if("number"!=typeof this.index)return"";let e=[...new Set(this.value)],t={};e.forEach(e=>{t[e]=1});let i="";return this.isIdentifier&&(i="&mappingIdentifier="+String(!0)),"eventType=customData&index="+this.index+"&valuesCountMap="+encodeURIComponent(JSON.stringify(t))+"&overwrite="+String(this.overwrite)+i}get data(){return Object.assign(Object.assign({index:this.index},void 0!==this.name?{name:this.name}:{}),{value:this.value,type:ic.CustomData,isIdentifier:this.isIdentifier,status:this.status,overwrite:this.overwrite})}get status(){return this._isMappingIdentifier?it.Unsent:this._status}static _fromRaw(t){let i;let{index:r,value:a,status:n,isIdentifier:o,name:s,overwrite:u}=t;return s?(i=new e(s,null==u||u,...a))._index=r:i=new e(r,null==u||u,...a),i.status=n,i._isMappingIdentifier=o,i}set _isMappingIdentifier(e){this.isIdentifier=e}set status(e){this._status=e}static _updateFromVisit(t,i){var r;if(null===(r=t.customDataEvents)||void 0===r?void 0:r.length)for(let r=t.customDataEvents.length-1;r>=0;r--){let{index:a,valuesCountMap:n}=t.customDataEvents[r].data;i.has(a)||i.set(a,new e(a,...Object.keys(n)))}}set _index(e){this.index=e}},eE=class e{constructor({goalId:e,revenue:t=0,negative:i=!1,metadata:r}){this.goalId=e,this.revenue=t,this.negative=i,this.status=it.Unsent,this.id=Math.floor(1e6*Math.random()),this.metadata=r}set _id(e){this.id=e}set _nonce(e){this.nonce=e}get url(){var e;return"eventType=conversion&goalId="+String(this.goalId)+"&revenue="+String(this.revenue)+"&negative="+String(this.negative)+((null===(e=this.metadata)||void 0===e?void 0:e.length)?"&metadata="+this._encodeMetadata():"")}get data(){var e;return{goalId:this.goalId,nonce:this.nonce,revenue:this.revenue,negative:this.negative,type:ic.Conversion,status:this.status,id:this.id,metadata:(null===(e=this.metadata)||void 0===e?void 0:e.map(e=>e.data))||void 0}}_encodeMetadata(){var e;if(!(null===(e=this.metadata)||void 0===e?void 0:e.length))return"";let t=new Set;return encodeURIComponent(JSON.stringify(this.metadata.reduce((e,i)=>(t.has(i.data.index)||(t.add(i.data.index),e[i.data.index]=i.data.value),e),{})))}static _fromRaw(t){let{goalId:i,revenue:r,negative:a,status:n,id:o,nonce:s,metadata:u}=t,l=new e({goalId:i,revenue:r,negative:a,metadata:e.parseMetadata(u)});return l._id=o,l.status=n,s&&(l._nonce=s),l}static parseMetadata(e){return(null==e?void 0:e.map(e=>ew._fromRaw(e)))||void 0}static _listFromVisit(t){var i,r;let a=[];if(!(null===(i=t.conversionEvents)||void 0===i?void 0:i.length))return[];if(null===(r=t.conversionEvents)||void 0===r?void 0:r.length)for(let i of t.conversionEvents){let{goalId:t,revenue:r,negative:n}=i.data,o=new e({goalId:t,revenue:r,negative:n});o.status=it.Sent,a.push(o)}return a}static _updateFromVisit(t,i){var r;if(null===(r=t.conversionEvents)||void 0===r?void 0:r.length)for(let r of t.conversionEvents){let{goalId:t}=r.data;if(!i.has(t)){let r=new e({goalId:t});r.status=it.Sent,i.set(t,r)}}}},ek=class e{constructor(e,t){this.browser=e,this.version=t,this.status=it.Unsent}get url(){if(!this.browser)return"";let e=this.version?U+this.version:"";return P+W+this.browser+L+ec[this.browser]+e}get data(){return{browser:this.browser,type:ic.Browser,version:this.version,status:this.status}}static _fromRaw(t){let{browser:i,version:r,status:a}=t,n=new e(i,r);return n.status=a,n}static _fromVisit(t){if(!t.staticDataEvent)return;let{browser:i,browserIndex:r,browserVersion:a}=t.staticDataEvent.data;if(i||"number"==typeof r){let t=null!=i?i:eh[r];return a?new e(t,a):new e(t)}}},eD=class e{constructor(e){this.device=e,this.status=it.Unsent}get url(){return this.device?P+j+this.device:""}get data(){return{device:this.device,type:ic.Device,status:this.status}}static _fromRaw(t){let{device:i,status:r}=t,a=new e(i);return a.status=r,a}static _fromVisit(t){var i;if(null===(i=t.staticDataEvent)||void 0===i?void 0:i.data.deviceType)return new e(t.staticDataEvent.data.deviceType)}},eS=class e{constructor(e){this.operatingSystem=e,this.status=it.Unsent}get url(){return this.operatingSystem?P+q+this.operatingSystem+H+el[this.operatingSystem]:""}get data(){return{operatingSystem:this.operatingSystem,type:ic.OperatingSystem,status:this.status}}static _fromRaw(t){let{operatingSystem:i,status:r}=t,a=new e(i);return a.status=r,a}static _fromVisit(t){if(!t.staticDataEvent)return;let{os:i,osIndex:r}=t.staticDataEvent.data;if(i||"number"==typeof r)return new e(null!=i?i:ed[r])}};class eI{constructor({country:e,region:t,city:i,postalCode:r,coordinates:a}){this.country=e,this.region=t,this.city=i,this.postalCode=r,this.coordinates=a,this.status=it.Unsent}get url(){let e=this.region?"&region="+encodeURIComponent(this.region):"",t=this.city?"&city="+encodeURIComponent(this.city):"",i=this.postalCode?"&postalCode="+encodeURIComponent(this.postalCode):"",r=this.coordinates?"&latitude="+this.coordinates[0]+"&longitude="+this.coordinates[1]:"";return"eventType=geolocation&country="+encodeURIComponent(this.country)+e+t+i+r}get data(){return{type:ic.GeolocationData,country:this.country,region:this.region,city:this.city,postalCode:this.postalCode,coordinates:this.coordinates,status:this.status}}static _fromRaw(e){let{country:t,region:i,city:r,postalCode:a,coordinates:n,status:o}=e,s=new eI({country:t,region:i,city:r,postalCode:a,coordinates:n});return s.status=o,s}static _fromVisit(e){var t;let i;if(!(null===(t=e.geolocationEvents)||void 0===t?void 0:t.length))return;for(let t of e.geolocationEvents){let{data:e}=t;e.country&&(i=e)}let{country:r,region:a,city:n}=i||{};return r?new eI(a&&n?{country:r,region:a,city:n}:a?{country:r,region:a}:{country:r}):void 0}}class eT{constructor(e){this.status=it.Sent,this.visits=e,this.visitNumber=e.length?e.length-1:0}get url(){return""}get data(){return{visits:this.visits,visitNumber:this.visitNumber,type:ic.VisitsData,status:this.status}}get isSent(){return!0}set timestamp(e){eC.insertVisitInOrderedListMutably({list:this.visits,visit:e}),this.visitNumber=this.visits.length?this.visits.length-1:0}updateVisitNumber(e){e>this.visitNumber&&(this.visitNumber=e)}}class eR{constructor(e){this.kcs=e,this.status=it.Sent}get url(){return""}get data(){return{kcs:this.kcs,type:ic.KameleoonConversionScore,status:this.status}}}class eV{constructor(e,t){this.id=e,this.variationId=t,this.status=it.Sent}get url(){return""}get data(){return{id:this.id,variationId:this.variationId,type:ic.Personalization,status:it.Sent}}static _fromRaw(e){return new eV(e.id,e.variationId)}static _updateFromVisit(e,t){var i;if(null===(i=e.personalizationEvents)||void 0===i?void 0:i.length)for(let i of e.personalizationEvents){let{id:e,variationId:r}=i.data;if(!t.has(e)){let i=new eV(e,r);t.set(e,i)}}}}class eO{constructor(e){this.values=new Map(Object.entries(e).map(([e,t])=>[Number(e),this.extractVarIds(t)])),this.cbs=e,this.status=it.Sent}extractVarIds(e){let t=new Map;return Object.entries(e).forEach(([e,i])=>{t.has(i)||t.set(i,[]),t.get(i).push(Number(e))}),Array.from(t.entries()).sort(([e],[t])=>t-e).map(([,e])=>({ids:e.sort((e,t)=>e-t)}))}getValues(){return this.values}get url(){return""}get data(){return{cbs:this.cbs,type:ic.CBScores,status:this.status}}static _fromRaw(e){let t=new eO(e.cbs);return t.status=e.status,t}}class eA{constructor({filters:e,dataManager:t,visitorCode:i}){this.visitsData=new eT([]),this.visitorData=[],this.storageVisitorData=[],this.experimentData={},this.singleDataTypes={[ic.Device]:null,[ic.Browser]:null,[ic.GeolocationData]:null,[ic.OperatingSystem]:null,[ic.KameleoonConversionScore]:null,[ic.CBScores]:null},this.multipleDataTypes={[ic.CustomData]:new Map,[ic.PageView]:new Map,[ic.Conversion]:new Map,[ic.Personalization]:new Map},this.filters=e,this.dataManager=t,this.visitorDataTypes=t.getVisitorStoredDataTypes(i)}get data(){return{visitorData:this.visitorData,storageVisitorData:this.storageVisitorData,visitsData:this.visitsData,experimentData:this.experimentData}}processVisit(e){this.processBrowser(e),this.processDevice(e),this.processOperatingSystem(e),this.processGeolocationData(e),this.processCustomData(e),this.processConversion(e),this.processPageView(e),this.processExperiments(e),this.processPersonalization(e)}processMultipleDataTypes(){for(let[e,t]of Object.entries(this.multipleDataTypes))if(t.size)switch(e){case ic.PageView:this.visitorData.push(...t.values()),this.storageVisitorData.push(...t.values());break;case ic.Personalization:case ic.Conversion:this.storageVisitorData.push(...t.values());break;case ic.CustomData:t.forEach(e=>{this.visitorData.push(e),this.dataManager.storedCustomDataIndexes.has(e.data.index)||this.storageVisitorData.push(e)})}}processKcs(e){if(this.filters.kcs&&e){let t=new eR(e);this.storageVisitorData.push(t)}}processVisitsData(e){var t;this.visitsData.timestamp={timeStarted:e.timeStarted,timeLastActivity:null!==(t=e.timeLastEvent)&&void 0!==t?t:e.timeStarted}}processVisitNumber(e,t){if(e.staticDataEvent){let i=e.staticDataEvent.data.visitNumber+(t?0:1);this.visitsData.updateVisitNumber(i)}}processCbs(e){if(this.filters.cbs&&e){let t=new eO(e);this.storageVisitorData.push(t)}}processBrowser(e){if(this.filters.browser&&!this.singleDataTypes[ic.Browser]){let t=ek._fromVisit(e);t&&(this.visitorDataTypes.has(ic.Browser)||this.storageVisitorData.push(t),this.visitorData.push(t),this.singleDataTypes[ic.Browser]=t)}}processDevice(e){if(this.filters.device&&!this.singleDataTypes[ic.Device]){let t=eD._fromVisit(e);t&&(this.visitorDataTypes.has(ic.Device)||this.storageVisitorData.push(t),this.visitorData.push(t),this.singleDataTypes[ic.Device]=t)}}processOperatingSystem(e){if(this.filters.operatingSystem&&!this.singleDataTypes[ic.OperatingSystem]){let t=eS._fromVisit(e);t&&(this.visitorDataTypes.has(ic.OperatingSystem)||this.storageVisitorData.push(t),this.visitorData.push(t),this.singleDataTypes[ic.OperatingSystem]=t)}}processGeolocationData(e){if(this.filters.geolocation&&!this.singleDataTypes[ic.GeolocationData]){let t=eI._fromVisit(e);t&&(this.visitorDataTypes.has(ic.GeolocationData)||this.storageVisitorData.push(t),this.visitorData.push(t),this.singleDataTypes[ic.GeolocationData]=t)}}processCustomData(e){this.filters.customData&&ew._updateFromVisit(e,this.multipleDataTypes[ic.CustomData])}processConversion(e){if(this.filters.conversions){eE._updateFromVisit(e,this.multipleDataTypes[ic.Conversion]);let t=eE._listFromVisit(e);t.length&&this.visitorData.push(...t)}}processPageView(e){this.filters.pageViews&&eb._updateFromVisit(e,this.multipleDataTypes[ic.PageView])}processExperiments(e){if(this.filters.experiments&&e.experimentEvents)for(let t of e.experimentEvents){let{id:e,variationId:i}=t.data;this.experimentData[e]={variationId:i,isTargetedRule:!1,status:it.Unsent}}}processPersonalization(e){this.filters.personalization&&eV._updateFromVisit(e,this.multipleDataTypes[ic.Personalization])}processMappingIdentifier(e){var t,i;if(!e)return;let r=null===(i=null===(t=e.customDataEvents)||void 0===t?void 0:t.find(e=>e.data.mappingIdentifier))||void 0===i?void 0:i.time;return r&&e.visitorCode?{mappingIdentifier:e.visitorCode,timestamp:r}:void 0}}class e_{static parseFeatureVariable(e){let{key:t,type:i,value:r}=e;switch(i){case ie.BOOLEAN:return x.Ok({key:t,type:i,value:!!r});case ie.JS:case ie.CSS:case ie.STRING:return x.Ok({key:t,type:i,value:String(r)});case ie.NUMBER:let a=Number(r);return Number.isNaN(a)?x.Err(new $(k.NumberParse,String(r))):x.Ok({key:t,type:i,value:a});case ie.JSON:try{let r=JSON.parse(String(e.value));return x.Ok({key:t,type:i,value:r})}catch(e){return x.Err(new $(k.JSONParse,e))}default:F(i)}}static parseVisitorData({data:e,filters:t,visitorCode:i,dataManager:r,variationConfiguration:a}){let n=new eA({filters:t,dataManager:r,visitorCode:i}),{currentVisit:o,previousVisits:s,kcs:u,cbs:l}=e;if(!(null==s?void 0:s.length)&&!o)return{visitorData:[],storageVisitorData:[],visitsData:new eT([])};o&&(n.processVisit(o),n.processVisitNumber(o,!0)),null==s||s.forEach(e=>{n.processVisit(e),n.processVisitsData(e),n.processVisitNumber(e,!1)}),n.processKcs(u),n.processCbs(l),n.processMultipleDataTypes();let d=n.processMappingIdentifier(null!=o?o:null==s?void 0:s[0]),{visitorData:c,storageVisitorData:h,visitsData:f,experimentData:g}=n.data;return a.updateStoredVariations(i,g),{visitorData:c,storageVisitorData:h,visitsData:f,mappingIdentifier:d}}static parseRegExp(e){if("/"===e[0]){let[t,i,r]=e.split("/");return new RegExp(i,r)}return new RegExp(e)}static parseSecret(e){if(null===e)return"null";let t=e.length;if(t<=4)return"*".repeat(t);let i=Math.max(t-4,4);return e.substring(0,t-i)+"*".repeat(i)}}class ex{constructor(e,t){ee.debug`CALL: new ClientSettings(siteCode: ${e}, configuration: ${t})`,this.siteCode=e,this.environment=this.getEnvironment(t),this.networkDomain=this.getNetworkDomain(t),this.updateInterval=this.getUpdateInterval(t),this.cleanupInterval=this.getCleanupInterval(t),this.requestTimeout=this.getRequestTimeout(t),this.trackingInterval=this.getTrackingInterval(t),this.trackRetryDelay=5*ii.Second,ee.debug`RETURN: new ClientSettings(siteCode: ${e}, configuration: ${t})`}getTrackingInterval(e){return"number"==typeof(null==e?void 0:e.trackingInterval)?e.trackingInterval<100?(ee.warning("Tracking interval must not be shorter than 100 ms. Minimum possible interval was applied."),100):e.trackingInterval>1e3?(ee.warning("Tracking interval must not be longer than 1000 ms. Maximum possible interval was applied."),1e3):e.trackingInterval:1e3}getEnvironment(e){return(null==e?void 0:e.environment)?e.environment:t7.Production}getCleanupInterval(e){return"number"==typeof(null==e?void 0:e.targetingDataCleanupInterval)?e.targetingDataCleanupInterval<1?(ee.warning("Targeting data cleanup interval must not be shorter than 1 minute. Minimum possible interval was applied."),1*ii.Minute):e.targetingDataCleanupInterval*ii.Minute:null}getUpdateInterval(e){return"number"==typeof(null==e?void 0:e.updateInterval)?e.updateInterval<1?(ee.warning("Update interval must not be shorter than 1 minute. Minimum possible interval was applied."),1*ii.Minute):e.updateInterval*ii.Minute:60*ii.Minute}getNetworkDomain(e){let t=em.validateNetworkDomain(null==e?void 0:e.networkDomain);return t.ok?t.data:null}getRequestTimeout(e){return"number"==typeof(null==e?void 0:e.requestTimeout)?e.requestTimeout:10*ii.Second}get settings(){return{trackingInterval:this.trackingInterval,trackRetryDelay:this.trackRetryDelay,cleanupInterval:this.cleanupInterval,updateInterval:this.updateInterval,requestTimeout:this.requestTimeout,networkDomain:this.networkDomain,environment:this.environment,siteCode:this.siteCode}}}let eM=class e{constructor(e){this.cookie=e,this.status=it.Sent}static fromString(t){return new e(t?t.split(";").map(e=>{let[i,r]=e.trim().split("=");return i?{key:i,value:r}:(ee.warning`Cookie string has an empty key: ${t}`,null)}).filter(e=>null!==e):[])}get url(){return""}get data(){return{cookie:this.cookie,type:ic.Cookie,status:this.status}}};class eN{constructor(e=null,t){this.cleanupInterval=e,this.packageInfo=t}mutUpdateData({infoData:e,visitorCode:t,mutData:i,dataItem:r}){let{visitorReference:a,data:n,isReference:o}=this.dereferenceData(i,t);this.packageInfo.isServer&&o&&!i[a]&&(e.mappingIdentifiers&&delete e.mappingIdentifiers[t],delete i[t],a=t);let s=this.cleanupInterval?Date.now()+this.cleanupInterval:0;switch(r.data.type){case ic.CustomData:this.updateCustomData({expirationTime:s,customData:r,visitorCode:a,mutData:n});break;case ic.PageView:this.updatePageView({expirationTime:s,pageView:r,visitorCode:a,mutData:n});break;case ic.Conversion:this.updateConversion({expirationTime:s,conversion:r,visitorCode:a,mutData:n});break;case ic.VisitsData:this.updateVisitsData({expirationTime:s,visitsData:r,visitorCode:a,mutData:n});break;case ic.Personalization:this.updatePersonalization({expirationTime:s,personalization:r,visitorCode:a,mutData:n});break;case ic.TargetedSegment:this.updateTargetedSegment({expirationTime:s,targetedSegment:r,visitorCode:a,mutData:n});break;default:this.updateCommonData({expirationTime:s,commonData:r,visitorCode:a,mutData:n})}return s}mutCleanupData(e,t){var i;if(!this.cleanupInterval)return null;let r=0;for(let[a,n]of Object.entries(e)){if("string"==typeof n){this.removeReference({mutData:e,visitorCode:a,linkedVisitor:n,infoData:t});continue}let o=0;for(let e of Object.keys(n)){let t;switch(e){case ic.CustomData:case ic.PageView:case ic.Conversion:case ic.Personalization:t=this.deleteNestedExpiredField(n,e);break;default:t=this.deleteExpiredField(n,e)}(!o||t&&t<o)&&(o=t)}Object.keys(e[a]).length?(!r||o&&o<r)&&(r=o):(delete e[a],this.packageInfo.isServer&&(null!==(i=t.mappingIdentifiers)&&void 0!==i||(t.mappingIdentifiers={}),delete t.mappingIdentifiers[a]))}return r}mutAddUnsentData({mutData:e,visitorCode:t,dataType:i}){let r=e.unsentData[t];if(r&&r.length){let a=new Set([...r]);a.add(i),e.unsentData[t]=Array.from(a)}else e.unsentData[t]=[i]}createReference({mutData:e,visitorCode:t,linkedVisitor:i}){e[i]=t}removeReference({mutData:e,visitorCode:t,linkedVisitor:i,infoData:r}){this.packageInfo.isServer&&(e[i]||(delete e[t],r.mappingIdentifiers&&delete r.mappingIdentifiers[t]))}updatePageView({visitorCode:e,mutData:t,pageView:i,expirationTime:r}){let{data:a}=i,n=t[e]&&ic.PageView in t[e]&&a.urlAddress in t[e][ic.PageView],o={expirationTime:r,visitorCode:e,data:t,key:ic.PageView,nestedKey:a.urlAddress,value:a};if(n){for(let i of t[e][ic.PageView][a.urlAddress].timestamps){let{time:e}=i;if(a.timestamps.some(({time:t})=>t===e))continue;let t=a.timestamps.findIndex(({time:t})=>t>=e);-1===t?a.timestamps.push(i):a.timestamps.splice(t,0,i)}this.updateNestedField(o)}else this.createNestedField(o)}updateCustomData({visitorCode:e,customData:t,mutData:i,expirationTime:r}){let{data:a}=t,n=i[e]&&ic.CustomData in i[e],o={expirationTime:r,visitorCode:e,data:i,key:ic.CustomData,nestedKey:a.index.toString(),value:a};n?this.updateNestedField(o):this.createNestedField(o)}updateConversion({conversion:e,mutData:t,visitorCode:i,expirationTime:r}){let{data:a}=e,n=t[i]&&ic.Conversion in t[i],o={expirationTime:r,visitorCode:i,data:t,key:ic.Conversion,nestedKey:a.id.toString(),value:a};n?this.updateNestedField(o):this.createNestedField(o)}updateVisitsData({visitorCode:e,mutData:t,visitsData:i,expirationTime:r}){var a,n;let{data:o}=i,s=t[e]&&ic.VisitsData in t[e],u={expirationTime:r,data:t,key:ic.VisitsData,value:o,visitorCode:e};if(s){let i=t[e][ic.VisitsData];i.visits.forEach(e=>{eC.insertVisitInOrderedListMutably({list:o.visits,visit:e})});let r=Math.max(null!==(a=o.visitNumber)&&void 0!==a?a:o.visits.length-1,o.visits.length-1,null!==(n=i.visitNumber)&&void 0!==n?n:0);this.updateField(Object.assign(Object.assign({},u),{value:Object.assign(Object.assign({},o),{visits:o.visits,visitNumber:r})}))}else this.createField(u)}updatePersonalization({visitorCode:e,mutData:t,personalization:i,expirationTime:r}){let{data:a}=i,n=t[e]&&ic.Personalization in t[e],o={expirationTime:r,visitorCode:e,data:t,key:ic.Personalization,nestedKey:a.id.toString(),value:a};n?this.updateNestedField(o):this.createNestedField(o)}updateTargetedSegment({visitorCode:e,mutData:t,targetedSegment:i,expirationTime:r}){let{data:a}=i,n=t[e]&&ic.TargetedSegment in t[e],o={expirationTime:r,visitorCode:e,data:t,key:ic.TargetedSegment,nestedKey:a.id.toString(),value:a};n?this.updateNestedField(o):this.createNestedField(o)}updateCommonData({visitorCode:e,mutData:t,commonData:i,expirationTime:r}){let{data:a}=i,n=t[e]&&a.type in t[e],o={expirationTime:r,data:t,key:a.type,visitorCode:e,value:a};n?this.updateField(o):this.createField(o)}dereferenceData(e,t){return"string"==typeof e[t]?{visitorReference:e[t],data:e,isReference:!0}:{visitorReference:t,data:e,isReference:!1}}deleteExpiredField(e,t){return e?e[t].expirationTime<Date.now()?(delete e[t],0):e[t].expirationTime:0}deleteNestedExpiredField(e,t){let i;if(!e[t])return 0;let r=e[t];for(let[e,t]of Object.entries(r))t&&(t.expirationTime<Date.now()?delete r[e]:(!i||t.expirationTime<i)&&(i=t.expirationTime));return Object.keys(r).length||delete e[t],i}updateField({key:e,value:t,data:i,visitorCode:r,expirationTime:a}){i[r][e]=Object.assign(Object.assign({},t),{expirationTime:a})}createField({key:e,value:t,data:i,visitorCode:r,expirationTime:a}){i[r]=Object.assign(Object.assign({},i[r]),{[e]:Object.assign(Object.assign({},t),{expirationTime:a})})}updateNestedField({key:e,nestedKey:t,value:i,data:r,visitorCode:a,expirationTime:n}){r[a][e][t]=Object.assign(Object.assign({},i),{expirationTime:n})}createNestedField({key:e,nestedKey:t,value:i,data:r,visitorCode:a,expirationTime:n}){var o;(null===(o=r[a])||void 0===o?void 0:o[e])?r[a]=Object.assign(Object.assign({},r[a]),{[e]:Object.assign(Object.assign({},r[a][e]),{[t]:Object.assign(Object.assign({},i),{expirationTime:n})})}):r[a]=Object.assign(Object.assign({},r[a]),{[e]:{[t]:Object.assign(Object.assign({},i),{expirationTime:n})}})}}class eF{constructor({browserType:e,visitNumber:t,timeSincePreviousVisit:i,os:r,deviceType:a,browserVersion:n}){this.browserType=e,this.visitNumber=t,this.timeSincePreviousVisit=i,this.os=r,this.deviceType=a,this.browserVersion=n}get url(){let e=this.browserVersion?U+this.browserVersion:"",t=this.browserType?W+this.browserType:"",i=this.browserType?L+ec[this.browserType]:"",r=this.os?q+this.os:"",a=this.os?H+el[this.os]:"",n=this.deviceType?j+this.deviceType:"";return P+t+i+e+(void 0!==this.visitNumber?"&visitNumber="+this.visitNumber:"")+(void 0!==this.timeSincePreviousVisit?"&timeSincePreviousVisit="+this.timeSincePreviousVisit:"")+r+a+n}}class e${static setConditionFactoryInstance(e){this.conditionFactoryInstance=e}static createCondition(e){return this.conditionFactoryInstance.createCondition(e)}}class eP{constructor(e,t,i){var r;if(this.inverseResult=!1,this.isOperator(e))this.nodeValue=e;else{let t=e$.createCondition(e);this.inverseResult=!(null===(r=e.isInclude)||void 0===r||r),t.ok?this.nodeValue=t.data:this.nodeError=t.error}this.leftChild=t,this.rightChild=i}get value(){return this.nodeValue}get error(){return this.nodeError}get left(){return this.leftChild}get right(){return this.rightChild}get inverse(){return this.inverseResult}isOperator(e){return e===im.And||e===im.Or}}class eL{constructor(e){this.error=null,this.targetingTypes=new Set,ee.debug`CALL: new Tree(segment: ${e})`;let{nestedConditions:t,topLevelOperators:i}=this.flattenSegment(e),r=t.map(({conditions:e,operators:t})=>{let i=e.map(e=>(this.targetingTypes.add(e.targetingType),new eP(e)));return this.buildTree(i,t)});this.tree=this.buildTree(r,i),ee.debug`RETURN: new Tree(segment: ${e})`}evaluate(e){let t=this.evaluateNode(this.tree,e);return this.error?x.Err(this.error):x.Ok(t)}hasTargetingType(e){return this.targetingTypes.has(e)}evaluateNode(e,t){if(this.isLeafNode(e)){if(e.error)return e.error.type===k.TargetingCondition;let i=e.value.evaluate(t);return i.ok?e.inverse?!i.data:i.data:(this.error=i.error,!1)}if(this.isNonLeafNode(e))switch(e.value){case im.And:return this.evaluateNode(e.left,t)&&this.evaluateNode(e.right,t);case im.Or:return this.evaluateNode(e.left,t)||this.evaluateNode(e.right,t)}return!1}isLeafNode(e){return!(e.left&&e.right)}isNonLeafNode(e){return!!(e.left&&e.right&&(e.value===im.Or||e.value===im.And))}buildTree(e,t){if(1===e.length)return e[0];for(let i of t){let t=new eP(i,e.shift(),e.shift());e.unshift(t)}return e[0]}flattenSegment(e){let{firstLevel:t,firstLevelOrOperators:i}=e.conditionsData,r=[];return t.forEach(e=>{let{conditions:t,orOperators:i}=e,a={operators:this.convertOperators(i),conditions:t};r.push(a)}),{topLevelOperators:this.convertOperators(i),nestedConditions:r}}convertOperators(e){return e.map(e=>e?im.Or:im.And)}}class eU{constructor({device:e}){this.device=e}evaluate({targetingData:e}){let t=null==e?void 0:e[ic.Device];if(t){let{device:e}=t;return x.Ok(e===this.device)}return x.Ok(!1)}}class ej{constructor({browser:e,version:t,versionMatchType:i}){this.browser=e,this.version=t,this.versionMatchType=i}evaluate({targetingData:e}){let t=null==e?void 0:e[ic.Browser];if(t){let e=this.checkCondition(t);return this.error?x.Err(this.error):x.Ok(e)}return x.Ok(!1)}checkCondition(e){let{browser:t,version:i}=e;if("string"!=typeof this.browser)return!1;if(!this.version)return t===this.browser;if(!this.versionMatchType||"number"!=typeof i)return!1;let r=parseFloat(this.version);switch(isNaN(r)&&(ee.error`Failed to parse version: ${this.version} in Browser condition`,this.error=new $(k.VersionParse,this.version)),this.versionMatchType){case iD.EQUAL:return t===this.browser&&i===r;case iD.GREATER:return t===this.browser&&i>r;case iD.LOWER:return t===this.browser&&i<r;default:ee.error`Unexpected comparing operation for Browser condition: ${this.versionMatchType}`,F(this.versionMatchType)}}}class eK{constructor({goalId:e}){this.conditionValue=e}evaluate({targetingData:e}){let t=null==e?void 0:e[ic.Conversion];if(!this.conditionValue)return x.Ok(!1);if(t){if(Object.keys(t).length&&-1===this.conditionValue)return x.Ok(!0);let e=Object.values(t);return x.Ok(e.some(e=>!!e&&e.goalId===this.conditionValue))}return x.Ok(!1)}}class eG{constructor({customDataIndex:e,valueMatchType:t,value:i,range:r}){this.customDataIndex=e?Number(e):-1,this.matchType=t,this.conditionValue=i,this.range=r}evaluate({targetingData:e}){var t;let i=null===(t=null==e?void 0:e[ic.CustomData])||void 0===t?void 0:t[this.customDataIndex];if(this.matchType===iy.UNDEFINED)return x.Ok(!i);if(i){let{value:e}=i,t=this.checkCondition(e);return this.error?x.Err(this.error):x.Ok(t)}return x.Ok(!1)}checkCondition(e){if("string"!=typeof this.conditionValue&&this.matchType!==iy.TRUE&&this.matchType!==iy.FALSE&&this.matchType!==iy.RANGE)return ee.error`Unexpected condition value for CustomData condition: ${this.conditionValue}`,!1;let t=this.conditionValue;if(this.matchType===iy.AMONG_VALUES){let i=this.parseArray(t);if(!i.ok)return this.error=i.error,!1;let r=new Set(i.data);return Array.isArray(e)?e.some(e=>r.has(e)):i.data.includes(e)}if(this.matchType===iy.RANGE){let t=this.parseRange(this.range);if(!t.ok)return this.error=t.error,!1;let[i,r]=t.data,a=e=>e>=i&&e<=r;return Array.isArray(e)?e.some(e=>a(Number(e))):a(Number(e))}if(Array.isArray(e))return e.some(e=>this.checkCondition(e));switch(this.matchType){case iy.CONTAINS:return e.includes(t);case iy.EXACT:return e===this.conditionValue;case iy.REGULAR_EXPRESSION:return e_.parseRegExp(t).test(e);case iy.LOWER:return Number(e)<Number(this.conditionValue);case iy.EQUAL:return Number(e)===Number(this.conditionValue);case iy.GREATER:return Number(e)>Number(this.conditionValue);case iy.TRUE:return"true"===e.toLowerCase();case iy.FALSE:return"false"===e.toLowerCase();default:return ee.error`Unexpected comparing operation for CustomData condition: ${this.matchType}`,!1}}parseArray(e){try{let t=JSON.parse(e);if(Array.isArray(t))return x.Ok(t)}catch(t){return ee.error`Failed to parse array: ${e} in CustomData condition`,x.Err(new $(k.AmongValuesCheck,t,e))}return x.Ok([])}parseRange(e){return e&&2===e.length?x.Ok(e):(ee.error`Failed to parse range: ${e} in CustomData condition`,x.Err(new $(k.RangeCheck,e)))}}class ez{static getLatest(e){return Object.values(e).reduce((e,t)=>e.timestamps[e.timestamps.length-1].time>t.timestamps[t.timestamps.length-1].time?e:t)}}class eB{constructor({matchType:e,title:t}){this.matchType=e,this.conditionValue=t}evaluate({targetingData:e}){let t=null==e?void 0:e[ic.PageView];if(!t)return x.Ok(!1);let i=ez.getLatest(t);return x.Ok(this.checkCondition(i.title))}checkCondition(e){if(!this.matchType||!this.conditionValue)return!1;switch(this.matchType){case ik.CONTAINS:return e.includes(this.conditionValue);case ik.EXACT:return e===this.conditionValue;case ik.REGULAR_EXPRESSION:return e_.parseRegExp(this.conditionValue).test(e);default:return ee.error`Unexpected comparing operation for PageTitle condition: ${this.matchType}`,!1}}}class eq{constructor({matchType:e,url:t}){this.matchType=e,this.conditionValue=t}evaluate({targetingData:e}){let t=null==e?void 0:e[ic.PageView];if(!t)return x.Ok(!1);let i=ez.getLatest(t);return x.Ok(this.checkCondition(i.urlAddress))}checkCondition(e){if(!this.matchType||!this.conditionValue)return!1;switch(this.matchType){case ik.CONTAINS:return e.includes(this.conditionValue);case ik.EXACT:return e===this.conditionValue;case ik.REGULAR_EXPRESSION:return e_.parseRegExp(this.conditionValue).test(e);default:return ee.error`Unexpected comparing operation for PageUrl condition: ${this.matchType}`,!1}}}class eH{constructor({sdkLanguage:e,version:t,versionMatchType:i}){this.sdkLanguage=e,this.conditionValue=t,this.versionMatchType=i}evaluate({sdkInfo:e}){return this.checkCondition(e)}checkCondition(e){let{type:t,version:i}=e;if(!this.sdkLanguage)return x.Ok(!1);if("string"!=typeof this.conditionValue)return x.Ok(t===this.sdkLanguage);if(!this.versionMatchType||t!==this.sdkLanguage)return x.Ok(!1);let r=ey.compareSemVer({version:i,compareVersion:this.conditionValue,operator:this.versionMatchType});return r.ok?x.Ok(r.data):x.Err(r.error)}}class eW{constructor({visitorCode:e,matchType:t}){this.matchType=t,this.conditionValue=e}evaluate({visitorCode:e}){return x.Ok(this.checkCondition(e))}checkCondition(e){if(!this.matchType||!this.conditionValue)return!1;switch(this.matchType){case ik.CONTAINS:return e.includes(this.conditionValue);case ik.EXACT:return e===this.conditionValue;case ik.REGULAR_EXPRESSION:return e_.parseRegExp(this.conditionValue).test(e);default:return ee.error`Unexpected comparing operation for VisitorCode condition: ${this.matchType}`,!1}}}class eY{constructor({name:e,value:t,nameMatchType:i,valueMatchType:r}){this.cookie={key:null!=e?e:void 0,value:null!=t?t:void 0},this.keyMatchType=i,this.valueMatchType=r}evaluate({targetingData:e}){var t;let i=!this.cookie.key&&!this.cookie.value,r=!!this.valueMatchType&&!!this.keyMatchType;if(i||!r)return x.Ok(!1);let a=this.extractCookie(),n=(null===(t=null==e?void 0:e[ic.Cookie])||void 0===t?void 0:t.cookie)||[];return x.Ok(a.some(e=>this.checkCondition(e))||n.some(e=>this.checkCondition(e)))}extractCookie(){return"undefined"!=typeof document&&document.cookie?eM.fromString(document.cookie).data.cookie:[]}checkCondition(e){let t;let i=this.keyMatchType,{key:r,value:a}=e;if(i===iS.OPTIONAL){let e=this.cookie;return!!this.isOptionalCookie(e)&&this.compareCookieValue(a,e.value)}let{key:n,value:o}=this.cookie;switch(i){case iS.EXACT:t=r===n;break;case iS.CONTAINS:t=r.includes(n);break;case iS.REGULAR_EXPRESSION:t=e_.parseRegExp(n).test(r);break;default:ee.error`Unexpected comparing operation for Cookie condition: ${i}`,F(i)}return t&&this.compareCookieValue(a,o)}compareCookieValue(e,t){let i=this.valueMatchType;switch(i){case iy.EXACT:return e===t;case iy.CONTAINS:return e.includes(t);case iy.REGULAR_EXPRESSION:return e_.parseRegExp(t).test(e);default:return ee.error`Unexpected comparing operation for Cookie condition: ${i}`,!1}}isOptionalCookie(e){let{value:t}=e;return void 0!==t}}class eJ{constructor({os:e}){this.operatingSystem=e}evaluate({targetingData:e}){let t=null==e?void 0:e[ic.OperatingSystem];if(t){let{operatingSystem:e}=t;return x.Ok(e===this.operatingSystem)}return x.Ok(!1)}}class eX{constructor({country:e,region:t,city:i}){this.country=e,this.region=t,this.city=i}evaluate({targetingData:e}){let t=null==e?void 0:e[ic.GeolocationData];if(t){let{country:e,region:i,city:r}=t,[a,n,o]=[this.country,this.region,this.city];if(!a||!e)return x.Ok(!1);let s=!(e.toLowerCase()!==a.toLowerCase()||n&&(null==i?void 0:i.toLowerCase())!==n.toLowerCase()||o&&(null==r?void 0:r.toLowerCase())!==o.toLowerCase());return x.Ok(s)}return x.Ok(!1)}}class eQ{constructor({segmentId:e}){this.segmentId=e}evaluate(e){let{segments:t,trees:i}=e;if(!this.segmentId)return x.Ok(!1);let r=null==t?void 0:t.get(this.segmentId.toString());if(!r)return x.Ok(!1);let a=null==i?void 0:i.get(this.segmentId.toString());return a?a.evaluate(e):new eL(r).evaluate(e)}}class eZ{constructor({featureFlagId:e,variationKey:t,ruleId:i}){this.featureId=e,this.ruleId=i,this.variationKey=t}evaluate({variationData:e,ruleMap:t}){var i,r,a,n;if(!this.featureId||!t)return x.Ok(!1);if(this.featureId&&!this.ruleId&&!this.variationKey){for(let[r,a]of t){let{featureId:t,experimentId:r}=a;if(t===this.featureId&&"number"==typeof(null===(i=e[r])||void 0===i?void 0:i.variationId))return x.Ok(!0)}return x.Ok(!1)}if(this.featureId&&this.ruleId){let i=t.get(this.ruleId);if(!i)return x.Ok(!1);let{experimentId:n,variations:o}=i;if(this.variationKey){let t=o.get(this.variationKey);return x.Ok(!!t&&(null===(r=e[n])||void 0===r?void 0:r.variationId)===t)}return x.Ok(!!(null===(a=e[i.experimentId])||void 0===a?void 0:a.variationId))}if(this.featureId&&!this.ruleId&&this.variationKey)for(let[i,r]of t){let{featureId:t,experimentId:i,variations:a}=r;if(t===this.featureId&&a.has(this.variationKey)){let t=a.get(this.variationKey);return x.Ok(!!t&&(null===(n=e[i])||void 0===n?void 0:n.variationId)===t)}}return x.Ok(!1)}}class e0{constructor({matchType:e,url:t}){this.conditionValue=t,this.matchType=e}evaluate({targetingData:e}){let t=null==e?void 0:e[ic.PageView];if(!t)return x.Ok(!1);let i=this.getSecondLatestPageView(Object.values(t));if(!i)return x.Ok(!1);let r=i.urlAddress;return x.Ok(this.checkCondition(r))}checkCondition(e){if(!this.matchType||!this.conditionValue)return!1;switch(this.matchType){case ik.CONTAINS:return e.includes(this.conditionValue);case ik.EXACT:return e===this.conditionValue;case ik.REGULAR_EXPRESSION:return e_.parseRegExp(this.conditionValue).test(e);default:return ee.error`Unexpected comparing operation for PreviousPage condition: ${this.matchType}`,!1}}getSecondLatestPageView(e){let t,i;if(!(e.length<2))return e.forEach(e=>{let r=e.timestamps[e.timestamps.length-1].time;if(t)return r>t.timestamps[t.timestamps.length-1].time?(i=t,void(t=e)):void(r>(i?i.timestamps[i.timestamps.length-1].time:0)&&(i=e));t=e}),i}}class e1{constructor({matchType:e,pageCount:t}){this.matchType=e,this.conditionValue=t}evaluate({targetingData:e}){let t=null==e?void 0:e[ic.PageView];if(!t)return x.Ok(!1);let i=0;return Object.values(t).forEach(e=>{i+=e.timestamps.length}),x.Ok(this.checkCondition(i))}checkCondition(e){if(!this.matchType||"number"!=typeof this.conditionValue)return!1;switch(this.matchType){case ik.EQUAL:return e===this.conditionValue;case ik.GREATER:return e>this.conditionValue;case ik.LOWER:return e<this.conditionValue;default:return ee.error`Unexpected comparing operation for VisitedPages condition: ${this.matchType}`,!1}}}class e2{constructor({matchType:e,count:t,unitOfTime:i}){this.matchType=e,this.conditionValue=t,this.timeUnit=i}evaluate({targetingData:e,sdkInfo:t}){let i=null==e?void 0:e[ic.VisitsData];if(t.isServer?!(null==i?void 0:i.visits.length):!(null==i?void 0:i.visits)||i.visits.length<2)return x.Ok(!1);let r=i.visits[0];return x.Ok(this.checkCondition("number"==typeof r?r:r.timeStarted))}checkCondition(e){if(!this.matchType||"number"!=typeof this.conditionValue||!this.timeUnit)return!1;let t=Date.now()-e,i=ey.convertTimeUnit(t,this.timeUnit);switch(this.matchType){case ik.GREATER:return i>this.conditionValue;case ik.LOWER:return i<this.conditionValue;default:return ee.error`Unexpected comparing operation for FirstVisit condition: ${this.matchType}`,!1}}}class e3{constructor({matchType:e,count:t,unitOfTime:i}){this.matchType=e,this.conditionValue=t,this.timeUnit=i}evaluate({targetingData:e,sdkInfo:t}){let i=null==e?void 0:e[ic.VisitsData];if(t.isServer?!(null==i?void 0:i.visits.length):!(null==i?void 0:i.visits)||i.visits.length<2)return x.Ok(!1);let r=i.visits,a=r[t.isServer?r.length-1:r.length-2];return x.Ok(this.checkCondition("number"==typeof a?a:a.timeStarted))}checkCondition(e){if(!this.matchType||"number"!=typeof this.conditionValue||!this.timeUnit)return!1;let t=Date.now()-e,i=ey.convertTimeUnit(t,this.timeUnit);switch(this.matchType){case ik.GREATER:return i>this.conditionValue;case ik.LOWER:return i<this.conditionValue;default:return ee.error`Unexpected comparing operation for LastVisit condition: ${this.matchType}`,!1}}}class e4{constructor({matchType:e,visitCount:t}){this.matchType=e,this.conditionValue=t}evaluate({targetingData:e,sdkInfo:t}){let i=null==e?void 0:e[ic.VisitsData];if(!i)return x.Ok(!1);let r=0,a=(new Date).setHours(0,0,0,0),{visits:n}=i;return n.forEach(e=>{("number"==typeof e?e:e.timeStarted)>=a&&r++}),t.isServer&&(r+=1),x.Ok(this.checkCondition(r))}checkCondition(e){if(!this.matchType||"number"!=typeof this.conditionValue)return!1;switch(this.matchType){case ik.EQUAL:return e===this.conditionValue;case ik.GREATER:return e>this.conditionValue;case ik.LOWER:return e<this.conditionValue;default:return ee.error`Unexpected comparing operation for SameDayVisits condition: ${this.matchType}`,!1}}}class e6{constructor({matchType:e,visitCount:t}){this.matchType=e,this.conditionValue=t}evaluate({targetingData:e,sdkInfo:t}){let i=null==e?void 0:e[ic.VisitsData];if(!i)return x.Ok(!1);let r=i.visits.length+(t.isServer?1:0);return x.Ok(this.checkCondition(r))}checkCondition(e){if(!this.matchType||"number"!=typeof this.conditionValue)return!1;switch(this.matchType){case ik.EQUAL:return e===this.conditionValue;case ik.GREATER:return e>this.conditionValue;case ik.LOWER:return e<this.conditionValue;default:return ee.error`Unexpected comparing operation for Visits condition: ${this.matchType}`,!1}}}class e5{constructor({visitorType:e}){this.visitorType=e}evaluate({targetingData:e,sdkInfo:t}){let i=null==e?void 0:e[ic.VisitsData];if(!i||!this.visitorType)return x.Ok(!1);let{visits:r}=i,a=t.isServer?!r.length:r.length<=1;switch(this.visitorType){case iC.NEW:return x.Ok(a);case iC.RETURNING:return x.Ok(!a);default:ee.error`Unexpected visitor type for NewVisitor condition: ${this.visitorType}`,F(this.visitorType)}}}class e9{constructor({version:e,versionMatchType:t}){this.conditionValue=e,this.versionMatchType=t}evaluate({targetingData:e}){var t;let i=null===(t=null==e?void 0:e[ic.ApplicationVersion])||void 0===t?void 0:t.version;if(!i||!this.conditionValue||!this.versionMatchType)return x.Ok(!1);let r=ey.compareSemVer({version:i,compareVersion:this.conditionValue,operator:this.versionMatchType});return r.ok?x.Ok(r.data):x.Err(r.error)}}class e8{constructor({lowerBound:e,upperBound:t,keyMomentId:i,goalId:r}){this.lowerBound=e,this.upperBound=t,this.keyMomentId=i,this.goalId=r}evaluate({targetingData:e}){var t;let i=null==e?void 0:e[ic.KameleoonConversionScore];if("number"!=typeof this.keyMomentId||"number"!=typeof this.goalId||"number"!=typeof this.lowerBound||"number"!=typeof this.upperBound||!i)return x.Ok(!1);let r=null===(t=i.kcs[this.keyMomentId.toString()])||void 0===t?void 0:t[this.goalId.toString()];return"number"!=typeof r?x.Ok(!1):x.Ok(r>=this.lowerBound&&r<=this.upperBound)}}class e7{constructor({campaignType:e}){this.campaignType=e}evaluate(e){return x.Ok(this.checkCondition(e))}checkCondition(e){var t;let i=Object.values(e.variationData),r=Object.values((null===(t=e.targetingData)||void 0===t?void 0:t.personalization)||{}),a=1===i.length&&null!==e.experimentId&&void 0!==e.variationData[e.experimentId],n=0===i.length,o=0===r.length;switch(this.campaignType){case iE.Experiment:return n||a;case iE.Personalization:return o;case iE.Any:return o&&(n||a);default:return!1}}}class te{constructor({variationMatchType:e,variation:t,experiment:i}){this.variationMatchType=e,this.variationId=t||-1,this.experimentId=i||-1}evaluate(e){return x.Ok(this.checkCondition(e))}checkCondition(e){let t=e.variationData[this.experimentId];if(!t)return!1;switch(this.variationMatchType){case ib.ANY:return!0;case ib.EXACT:return t.variationId===this.variationId;default:return!1}}}class tt{constructor({personalizationId:e}){this.personalizationId=e}evaluate(e){return e.targetingData?x.Ok(this.checkCondition(e)):x.Ok(!1)}checkCondition(e){var t;if(!this.personalizationId)return!1;let i=null===(t=e.targetingData)||void 0===t?void 0:t[ic.Personalization];return void 0!==(null==i?void 0:i[this.personalizationId])}}class ti{createCondition(e){let{targetingType:t}=e;switch(t){case iI.CUSTOM_DATUM:return x.Ok(new eG(e));case iI.EXCLUSIVE_EXPERIMENT:return x.Ok(new e7(e));case iI.TARGET_EXPERIMENT:return x.Ok(new te(e));case iI.TARGET_FEATURE_FLAG:return x.Ok(new eZ(e));case iI.TARGET_PERSONALIZATION:return x.Ok(new tt(e));case iI.DEVICE_TYPE:return x.Ok(new eU(e));case iI.BROWSER:return x.Ok(new ej(e));case iI.PAGE_URL:return x.Ok(new eq(e));case iI.PAGE_TITLE:return x.Ok(new eB(e));case iI.CONVERSIONS:return x.Ok(new eK(e));case iI.VISITOR_CODE:return x.Ok(new eW(e));case iI.SDK_LANGUAGE:return x.Ok(new eH(e));case iI.COOKIE:return x.Ok(new eY(e));case iI.OPERATING_SYSTEM:return x.Ok(new eJ(e));case iI.GEOLOCATION:return x.Ok(new eX(e));case iI.SEGMENT:return x.Ok(new eQ(e));case iI.APPLICATION_VERSION:return x.Ok(new e9(e));case iI.PREVIOUS_PAGE:return x.Ok(new e0(e));case iI.PAGE_VIEWS:return x.Ok(new e1(e));case iI.LAST_VISIT:return x.Ok(new e3(e));case iI.FIRST_VISIT:return x.Ok(new e2(e));case iI.SAME_DAY_VISITS:return x.Ok(new e4(e));case iI.VISITS:return x.Ok(new e6(e));case iI.NEW_VISITORS:return x.Ok(new e5(e));case iI.HEAT_SLICE:return x.Ok(new e8(e));default:return ee.error`Unsupported targeted condition type found: ${t}`,x.Err(new $(k.TargetingCondition,t))}}}(tB=iV||(iV={})).ClientData="kameleoonClientData",tB.TargetingData="kameleoonTargetingData",tB.TrackingData="kameleoonTrackingData",tB.VariationData="kameleoonVariationData",tB.VisitorCode="kameleoonVisitorCode",tB.ConsentData="kameleoonConsentData",tB.DataInfo="kameleoonDataInfo",tB.KameleoonSimulationFFData="kameleoonSimulationFFData",tB.ForcedFeatureVariation="kameleoonForcedFeatureVariation",tB.ForcedExperimentVariation="kameleoonForcedExperimentVariation";let tr={data:{customData:[],featureFlags:[],configuration:{realTimeUpdate:!1,consentType:il.NotRequired,dataApiDomain:"data.kameleoon.io"}},lastUpdate:""},ta=29*ii.Minute;class tn{constructor(e){this.key=e}isDataValid(e){switch(this.key){case iV.ClientData:return this.checkClientDataIntegrity(e);case iV.TargetingData:return this.checkTargetingDataIntegrity(e);case iV.DataInfo:return this.checkDataInfoIntegrity(e);case iV.VariationData:return this.checkVariationDataIntegrity(e);case iV.TrackingData:return this.checkTrackingDataIntegrity(e);default:return!0}}getDefaultData(){switch(this.key){case iV.ClientData:return this.getDefaultClientData();case iV.DataInfo:return{unsentData:{},nextVisitTime:0,mappingIdentifiers:{}};case iV.TrackingData:return{scheduledVisitors:{}};case iV.TargetingData:case iV.VariationData:case iV.ConsentData:return{};case iV.VisitorCode:case iV.KameleoonSimulationFFData:return"";case iV.ForcedExperimentVariation:case iV.ForcedFeatureVariation:return{};default:F(this.key)}}checkTrackingDataIntegrity(e){return this.hasFields(e,["scheduledVisitors"])}checkDataInfoIntegrity(e){return this.hasFields(e,["unsentData","nextVisitTime"])}checkVariationDataIntegrity(e){let t=Object.values(e);if(!t.length)return!0;let i=e=>!this.hasFields(e,["status"])||this.hasFields(e,["isSent"]);for(let e of t)for(let t of Object.values(e))if(i(t))return!1;return!0}checkClientDataIntegrity(e){return this.hasFields(e,Object.keys(tr))}checkTargetingDataIntegrity(e){let t=Object.values(e);if(!t.length)return!0;for(let e of t){if("string"==typeof e)continue;let t=e=>!this.hasFields(e,["status"])||this.hasFields(e,["sent"])||this.hasFields(e,["timestampList"]);for(let[i,r]of Object.entries(e)){if(Array.isArray(r))return!1;switch(i){case ic.PageView:case ic.Conversion:case ic.Personalization:case ic.TargetedSegment:case ic.CustomData:if(Object.values(r).some(e=>t(e)))return!1;continue;default:if(t(r))return!1}}}return!0}getDefaultClientData(){return Object.assign(Object.assign({},tr),{lastUpdate:(new Date).toString()})}hasFields(e,t){let i=Object.keys(e);return!(!i.length||!t.length)&&t.every(e=>i.includes(e))}}let to=class{constructor(e,t){this.externalStorage=e,this.storageKey=t;let i=new tn(t),r=this.read();if(!r.ok){if(r.error.type===k.StorageEmpty){let e=i.getDefaultData();this.write(e)}return}let a=r.data;if(!i.isDataValid(a)){let e=i.getDefaultData();this.write(e)}}read(){try{let e=this.externalStorage.read(this.storageKey);return null===e?x.Err(new $(k.StorageEmpty)):x.Ok(e)}catch(e){return ee.error`Failed to read data from storage: ${this.storageKey}`,x.Err(new $(k.StorageRead,this.storageKey))}}write(e){try{return this.externalStorage.write(this.storageKey,e),x.Ok()}catch(e){return ee.error`Failed to write data to storage: ${this.storageKey}`,x.Err(new $(k.StorageWrite,this.storageKey))}}update(e){let t;let i=this.read();if(!i.ok)return i.error.type===k.StorageEmpty?this.write(e):i;let r=i.data;return t="string"==typeof r?e:Object.assign(Object.assign({},r),e),this.write(t)}};class ts{constructor(e,t){this.externalStorage=e,this.cleanupInterval=t,t>0&&this.initCleanupInterval()}initCleanupInterval(){for(let e of Object.values(iV)){let t=null;try{switch(e){case iV.ForcedFeatureVariation:case iV.ForcedExperimentVariation:case iV.VariationData:case iV.ConsentData:ee.info`Starting cleanup for ${e} with interval ${this.cleanupInterval}`,t=setInterval(()=>this.cleanupData(e),this.cleanupInterval);break;case iV.ClientData:case iV.TargetingData:case iV.TrackingData:case iV.VisitorCode:case iV.DataInfo:case iV.KameleoonSimulationFFData:break;default:ee.error`Unknown storage key: ${e} for initCleanupInterval.`}}catch(i){t&&clearInterval(t),ee.error`Error while starting cleanup for ${e} with interval ${this.cleanupInterval}`}}}cleanupData(e){let t=this.externalStorage.read(e);if(!t)return;let i=Date.now();switch(e){case iV.VariationData:this.cleanupVariationData(t,i);break;case iV.ForcedFeatureVariation:this.cleanupForcedFeatureVariationData(t,i);break;case iV.ForcedExperimentVariation:this.cleanupForcedExperimentVariationData(t,i);break;case iV.ConsentData:this.cleanupConsentData(t,i);break;case iV.ClientData:case iV.TargetingData:case iV.TrackingData:case iV.VisitorCode:case iV.DataInfo:case iV.KameleoonSimulationFFData:break;default:ee.error`Unknown storage key: ${e} for cleanupData.`}this.externalStorage.write(e,t)}cleanupConsentData(e,t){for(let[i,r]of Object.entries(e)){if("boolean"==typeof r){e[i]={consent:r,expirationTime:t+this.cleanupInterval};continue}"number"==typeof r.expirationTime?r.expirationTime<t&&delete e[i]:r.expirationTime=t+this.cleanupInterval}}cleanupVariationData(e,t){for(let[i,r]of Object.entries(e))this.cleanupObjectValues(r,t),0===Object.keys(e[i]).length&&delete e[i]}cleanupForcedFeatureVariationData(e,t){for(let[i,r]of Object.entries(e))for(let[a,n]of Object.entries(r))this.cleanupObjectValues(n,t),0===Object.keys(e[Number(i)][a]).length&&delete e[Number(i)][a]}cleanupForcedExperimentVariationData(e,t){for(let[i,r]of Object.entries(e))this.cleanupObjectValues(r,t),0===Object.keys(e[i]).length&&delete e[i]}cleanupObjectValues(e,t){for(let[i,r]of Object.entries(e))"number"==typeof r.expirationTime?r.expirationTime<t&&delete e[i]:r.expirationTime=t+this.cleanupInterval}}class tu{constructor(e){this.id=e,this.status=it.Unsent}get url(){return"eventType=targetingSegment"+z+this.id}get data(){return{id:this.id,type:ic.TargetedSegment,status:this.status}}static _fromRaw(e){let{id:t,status:i}=e,r=new tu(t);return r.status=i,r}}class tl{constructor({dataStorage:e,infoStorage:t,cleanupInterval:i,packageInfo:r}){if(this.targetingTrees=new Map,this.mappingIdentifierCustomDataIndex=null,this.persistentCustomDataIndexes=new Set,this.localCustomDataIndexes=new Set,this.customDataIndexByName=new Map,this.cleanupIntervalId=null,ee.debug`CALL: new DataManager(dataStorage, infoStorage, cleanupInterval: ${i})`,this.dataStorage=e,this.infoStorage=t,this.dataProcessor=new eN(i,r),this.packageInfo=r,i)try{this.cleanupIntervalId=setInterval(()=>{this.cleanupData()},i)}catch(e){throw this.cleanupIntervalId&&clearInterval(this.cleanupIntervalId),ee.error`Failed to set cleanup interval: ${i}`,e}ee.debug`RETURN: new DataManager(dataStorage, infoStorage, cleanupInterval: ${i})`}getUnsentData(e){let t=this.infoStorage.read();if(!t.ok)return[];let i=t.data,r=this.getVisitorData(e);if(!i.unsentData[e]||!r)return[];let a=i.unsentData[e],n=i.nextVisitTime<=Date.now();return n&&(i.nextVisitTime=Date.now()+ta,this.infoStorage.write(i)),this.getDataFromRaw(r,({status:e,key:t,cdIndex:i})=>!("number"!=typeof i||!this.persistentCustomDataIndexes.has(i)||!n)||a.includes(t)&&e===it.Unsent)}getPendingData(e){let t=this.getVisitorData(e);return t?this.getDataFromRaw(t,({status:e})=>e===it.Pending):[]}getDataFromRaw(e,t){let i=[];for(let[r,a]of Object.entries(e))if(a)switch(r){case ic.CustomData:for(let e of Object.values(a)){if(!e)continue;let{status:a,index:n}=e;if(t({status:a,key:r,cdIndex:n})){let t=ew._fromRaw(e);i.push(t)}}break;case ic.Conversion:for(let e of Object.values(a))if(e&&t({status:e.status,key:r})){let t=eE._fromRaw(e);i.push(t)}break;case ic.PageView:for(let e of Object.values(a))if(t({status:e.status,key:r})){let t=eb._fromRaw(e);i.push(t)}break;case ic.TargetedSegment:for(let e of Object.values(a))if(t({status:e.status,key:r})){let t=tu._fromRaw(e);i.push(t)}break;case ic.GeolocationData:if(!a)continue;if(t({status:a.status,key:r})){let e=eI._fromRaw(a);i.push(e)}break;case ic.Browser:if(t({status:a.status,key:r})){let e=ek._fromRaw(a);i.push(e)}break;case ic.Device:if(t({status:a.status,key:r})){let e=eD._fromRaw(a);i.push(e)}break;case ic.OperatingSystem:if(t({status:a.status,key:r})){let e=eS._fromRaw(a);i.push(e)}}return i}storeTrackedData(e){this.storeData(e);let t=this.infoStorage.read();if(!t.ok)return;let i=t.data.unsentData;for(let[t,r]of Object.entries(e)){if(!i[t])return;let e=new Set(i[t]);r.forEach(({data:t})=>{e.has(t.type)&&e.delete(t.type)}),r.some(({data:e})=>{if(e.type!==ic.CustomData)return!1;let{index:t}=e;return this.persistentCustomDataIndexes.has(t)||this.mappingIdentifierCustomDataIndex===t})&&e.add(ic.CustomData),i[t]=Array.from(e),i[t].length||delete i[t]}this.infoStorage.write(t.data)}storeData(e,...t){ee.debug`CALL: DataManager.storeData(visitorCode: ${e}, data: ${t})`;let i=this.dataStorage.read(),r=this.infoStorage.read();if(!i.ok)return i;if(!r.ok)return r;let a=i.data,n=r.data;if("string"==typeof e)this.mutUpdateTargetingData({infoData:n,targetingData:a,visitorCode:e,kameleoonData:t});else for(let[t,i]of Object.entries(e))this.mutUpdateTargetingData({infoData:n,targetingData:a,visitorCode:t,kameleoonData:i});this.cleanupData(),this.infoStorage.write(r.data);let o=this.dataStorage.write(a);return ee.debug`RETURN: DataManager.storeData(visitorCode: ${e}, data: ${t}) -> (writeResult: ${o})`,o}getTree(e){if(this.targetingTrees.has(e.id))return this.targetingTrees.get(e.id);let t=new eL(e);return this.targetingTrees.set(e.id,t),t}clearTrees(){this.targetingTrees.clear()}isPersistentCustomData(e){return!!this.persistentCustomDataIndexes.size&&!!ey.isCustomData(e)&&this.persistentCustomDataIndexes.has(e.data.index)}isUniqueIdentifier(e){var t;let i=this.getVisitorData(e),r=null==i?void 0:i[ic.UniqueIdentifier];return null!==(t=null==r?void 0:r.value)&&void 0!==t&&t}getVisitorIdentifier(e){var t,i,r;let a=this.infoStorage.read();if(!a.ok)return e;let n=a.data;return null!==(t=n.mappingIdentifiers)&&void 0!==t||(n.mappingIdentifiers={}),null!==(r=null===(i=n.mappingIdentifiers[e])||void 0===i?void 0:i.mappingIdentifier)&&void 0!==r?r:e}getMappingIdentifier(e){let t=this.infoStorage.read();if(!t.ok)return;let i=t.data;return i.mappingIdentifiers?i.mappingIdentifiers[e]:void 0}setMappingIdentifier(e,t){var i;let r=this.infoStorage.read();if(!r.ok)return;let a=r.data;null!==(i=a.mappingIdentifiers)&&void 0!==i||(a.mappingIdentifiers={});let n=a.mappingIdentifiers[e];(!n||n.timestamp<t.timestamp)&&(a.mappingIdentifiers[e]=t,this.infoStorage.write(a))}getVisitorData(e){this.cleanupData();let t=this.dataStorage.read();if(!t.ok)return;let{visitorReference:i,data:r,isReference:a}=this.dataProcessor.dereferenceData(t.data,e);if(this.packageInfo.isServer&&a&&!r[i]){let t=this.infoStorage.read();t.ok&&t.data.mappingIdentifiers&&delete t.data.mappingIdentifiers[e],delete r[e],i=e}return r[i]}getVisitorStoredDataTypes(e){let t=this.getVisitorData(e);return t?new Set(Object.keys(t)):new Set}getLinkedVisitor(e){let t=this.dataStorage.read();if(!t.ok)return null;if("string"==typeof t.data[e])return t.data[e];if(null===this.mappingIdentifierCustomDataIndex)return null;let i=t.data[e];if(!i)return null;let r=i[ic.CustomData];return r&&r[this.mappingIdentifierCustomDataIndex]?r[this.mappingIdentifierCustomDataIndex].value[0]:null}mutUpdateTargetingData({infoData:e,visitorCode:t,kameleoonData:i,targetingData:r}){for(let a of i){if(a.data.type===ic.CustomData&&!this.processCustomData({infoData:e,customData:a,mutData:r,visitorCode:t}))continue;let i=this.dataProcessor.mutUpdateData({infoData:e,visitorCode:t,mutData:r,dataItem:a}),n=e.nextDataCleanup;(!n||n&&i<n)&&(e.nextDataCleanup=i),a.data.status===it.Unsent&&this.dataProcessor.mutAddUnsentData({mutData:e,visitorCode:t,dataType:a.data.type})}}cleanupData(){let e=this.dataStorage.read(),t=this.infoStorage.read();if(!e.ok||!t.ok)return;let i=e.data,r=t.data,a=r.nextDataCleanup;if(a&&a<Date.now()){let e=this.dataProcessor.mutCleanupData(i,r);r.nextDataCleanup=e||void 0,this.infoStorage.write(r),this.dataStorage.write(i)}}processCustomData({infoData:e,mutData:t,customData:i,visitorCode:r}){var a;let{data:n}=i,o=!!(n.value.length&&n.value[0].length);if(n.name){let e=this.customDataIndexByName.get(n.name);if(void 0===e)return!1;n.index=e,i._index=e}if(this.mappingIdentifierCustomDataIndex===n.index&&o){i._isMappingIdentifier=!0;let o=n.value[0];r!==o&&(ee.info`Linked anonymous visitor ${r} with user ${o}`,this.dataProcessor.createReference({infoData:e,mutData:t,visitorCode:r,linkedVisitor:n.value[0]}),null!==(a=e.mappingIdentifiers)&&void 0!==a||(e.mappingIdentifiers={}),e.mappingIdentifiers[o]={mappingIdentifier:r,timestamp:Date.now()})}return this.localCustomDataIndexes.has(n.index)&&(i.status=it.Sent),!0}get unsentDataVisitors(){let e=this.infoStorage.read();return e.ok?Object.keys(e.data.unsentData):[]}get identifierCustomDataIndex(){return this.mappingIdentifierCustomDataIndex}get trees(){return this.targetingTrees}get storedCustomDataIndexes(){let e=this.dataStorage.read();if(!e.ok)return new Set;let t=e.data;if(!(ic.CustomData in t))return new Set;let i=new Set;for(let e in Object.keys(t[ic.CustomData]))i.add(Number(e));return i}set customDataIndexes(e){var t;let[i,r]=[[],[]],a=new Map;e.forEach(e=>{e.localOnly&&i.push(e.index),e.scope===iu.Visitor&&r.push(e.index),e.name&&a.set(e.name,e.index)}),this.mappingIdentifierCustomDataIndex=(null===(t=e.find(e=>e.isMappingIdentifier))||void 0===t?void 0:t.index)||null,this.localCustomDataIndexes=new Set(i),this.persistentCustomDataIndexes=new Set(r),this.customDataIndexByName=a}getCustomDataIndexByName(e){return this.customDataIndexByName.get(e)}}var td,tc,th,tf,tg,tp,tv,tm,ty,tC,tb,tw,tE,tk,tD,tS,tI,tT,tR,tV,tO,tA,t_,tx,tM,tN,tF,t$,tP,tL,tU,tj,tK,tG,tz,tB,tq,tH,tW,tY,tJ,tX,tQ,tZ,t0,t1,t2,t3,t4,t6,t5,t9,t8,t7,ie,it,ii,ir,ia,io,is,iu,il,id,ic,ih,ig,ip,iv,im,iy,iC,ib,iw,iE,ik,iD,iS,iI,iT,iR,iV,iO,iA,i_,ix={exports:{}},iM={exports:{}},iN=function(e){if(Object.prototype.hasOwnProperty.call(e,"__esModule"))return e;var t=e.default;if("function"==typeof t){var i=function e(){var i=!1;try{i=this instanceof e}catch{}return i?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};i.prototype=t.prototype}else i={};return Object.defineProperty(i,"__esModule",{value:!0}),Object.keys(e).forEach(function(t){var r=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(i,t,r.get?r:{enumerable:!0,get:function(){return e[t]}})}),i}(Object.freeze({__proto__:null,default:{}})),iF=(iA||(iA=1,ix.exports=(iO||(iO=1,iM.exports=tq=tq||function(e){if("undefined"!=typeof window&&window.crypto&&(t=window.crypto),"undefined"!=typeof self&&self.crypto&&(t=self.crypto),"undefined"!=typeof globalThis&&globalThis.crypto&&(t=globalThis.crypto),!t&&"undefined"!=typeof window&&window.msCrypto&&(t=window.msCrypto),!t&&void 0!==O&&O.crypto&&(t=O.crypto),!t)try{t=iN}catch(e){}var t,i=function(){if(t){if("function"==typeof t.getRandomValues)try{return t.getRandomValues(new Uint32Array(1))[0]}catch(e){}if("function"==typeof t.randomBytes)try{return t.randomBytes(4).readInt32LE()}catch(e){}}throw Error("Native crypto module could not be used to get secure random number.")},r=Object.create||function(){function e(){}return function(t){var i;return e.prototype=t,i=new e,e.prototype=null,i}}(),a={},n=a.lib={},o=n.Base={extend:function(e){var t=r(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},s=n.WordArray=o.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||l).stringify(this)},concat:function(e){var t=this.words,i=e.words,r=this.sigBytes,a=e.sigBytes;if(this.clamp(),r%4)for(var n=0;n<a;n++){var o=i[n>>>2]>>>24-n%4*8&255;t[r+n>>>2]|=o<<24-(r+n)%4*8}else for(var s=0;s<a;s+=4)t[r+s>>>2]=i[s>>>2];return this.sigBytes+=a,this},clamp:function(){var t=this.words,i=this.sigBytes;t[i>>>2]&=4294967295<<32-i%4*8,t.length=e.ceil(i/4)},clone:function(){var e=o.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var t=[],r=0;r<e;r+=4)t.push(i());return new s.init(t,e)}}),u=a.enc={},l=u.Hex={stringify:function(e){for(var t=e.words,i=e.sigBytes,r=[],a=0;a<i;a++){var n=t[a>>>2]>>>24-a%4*8&255;r.push((n>>>4).toString(16)),r.push((15&n).toString(16))}return r.join("")},parse:function(e){for(var t=e.length,i=[],r=0;r<t;r+=2)i[r>>>3]|=parseInt(e.substr(r,2),16)<<24-r%8*4;return new s.init(i,t/2)}},d=u.Latin1={stringify:function(e){for(var t=e.words,i=e.sigBytes,r=[],a=0;a<i;a++){var n=t[a>>>2]>>>24-a%4*8&255;r.push(String.fromCharCode(n))}return r.join("")},parse:function(e){for(var t=e.length,i=[],r=0;r<t;r++)i[r>>>2]|=(255&e.charCodeAt(r))<<24-r%4*8;return new s.init(i,t)}},c=u.Utf8={stringify:function(e){try{return decodeURIComponent(escape(d.stringify(e)))}catch(e){throw Error("Malformed UTF-8 data")}},parse:function(e){return d.parse(unescape(encodeURIComponent(e)))}},h=n.BufferedBlockAlgorithm=o.extend({reset:function(){this._data=new s.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=c.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var i,r=this._data,a=r.words,n=r.sigBytes,o=this.blockSize,u=n/(4*o),l=(u=t?e.ceil(u):e.max((0|u)-this._minBufferSize,0))*o,d=e.min(4*l,n);if(l){for(var c=0;c<l;c+=o)this._doProcessBlock(a,c);i=a.splice(0,l),r.sigBytes-=d}return new s.init(i,d)},clone:function(){var e=o.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});n.Hasher=h.extend({cfg:o.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){h.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,i){return new e.init(i).finalize(t)}},_createHmacHelper:function(e){return function(t,i){return new f.HMAC.init(e,i).finalize(t)}}});var f=a.algo={};return a}(Math)),i_=iM.exports,tH=Math,tY=(tW=i_.lib).WordArray,tJ=tW.Hasher,tX=i_.algo,tQ=[],tZ=[],function(){function e(e){return 4294967296*(e-(0|e))|0}for(var t=2,i=0;i<64;)(function(e){for(var t=tH.sqrt(e),i=2;i<=t;i++)if(!(e%i))return!1;return!0})(t)&&(i<8&&(tQ[i]=e(tH.pow(t,.5))),tZ[i]=e(tH.pow(t,1/3)),i++),t++}(),t0=[],t1=tX.SHA256=tJ.extend({_doReset:function(){this._hash=new tY.init(tQ.slice(0))},_doProcessBlock:function(e,t){for(var i=this._hash.words,r=i[0],a=i[1],n=i[2],o=i[3],s=i[4],u=i[5],l=i[6],d=i[7],c=0;c<64;c++){if(c<16)t0[c]=0|e[t+c];else{var h=t0[c-15],f=(h<<25|h>>>7)^(h<<14|h>>>18)^h>>>3,g=t0[c-2],p=(g<<15|g>>>17)^(g<<13|g>>>19)^g>>>10;t0[c]=f+t0[c-7]+p+t0[c-16]}var v=r&a^r&n^a&n,m=(r<<30|r>>>2)^(r<<19|r>>>13)^(r<<10|r>>>22),y=d+((s<<26|s>>>6)^(s<<21|s>>>11)^(s<<7|s>>>25))+(s&u^~s&l)+tZ[c]+t0[c];d=l,l=u,u=s,s=o+y|0,o=n,n=a,a=r,r=y+(m+v)|0}i[0]=i[0]+r|0,i[1]=i[1]+a|0,i[2]=i[2]+n|0,i[3]=i[3]+o|0,i[4]=i[4]+s|0,i[5]=i[5]+u|0,i[6]=i[6]+l|0,i[7]=i[7]+d|0},_doFinalize:function(){var e=this._data,t=e.words,i=8*this._nDataBytes,r=8*e.sigBytes;return t[r>>>5]|=128<<24-r%32,t[14+(r+64>>>9<<4)]=tH.floor(i/4294967296),t[15+(r+64>>>9<<4)]=i,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=tJ.clone.call(this);return e._hash=this._hash.clone(),e}}),i_.SHA256=tJ._createHelper(t1),i_.HmacSHA256=tJ._createHmacHelper(t1),i_.SHA256)),(t2=ix.exports)&&t2.__esModule&&Object.prototype.hasOwnProperty.call(t2,"default"))?t2.default:t2;class i${static getHashDoubleForMEGroup(e,t){return this.calculateHash(e+t)}static getHashDouble({visitorIdentifier:e,id:t,respoolTime:i}){let r="";return i&&(r+=String(i)),this.calculateHash(e+t+r)}static calculateHash(e){return parseInt(iF(e).toString(),16)/1157920892373162e62}}class iP{constructor(e,t,i,r,a){this.storage=e,this.storageForcedExperimentVariations=t,this.storageForcedFeatureVariations=i,this.visitorCodeManager=r,this.clientConfiguration=a,r.setVariationConfiguration(this)}updateDataStatus({visitorCode:e,experimentIdList:t,status:i}){let r=this.storage.read();if(!r.ok)return r;let a=r.data;for(let r of(a[e]||(a[e]={}),t))a[e][r]=Object.assign(Object.assign({},a[e][r]),{status:i});return this.storage.write(a)}getUnsentData(e){return this.getVariationData(e,e=>e===it.Unsent)}getVisitorsWithUnsentData(){ee.debug`CALL: VariationConfiguration.unsentDataVisitors()`;let e=this.storage.read();if(!e.ok)return ee.debug`RETURN: VariationConfiguration.unsentDataVisitors() -> (result: ${e})`,[];let t=[];for(let[i,r]of Object.entries(e.data))Object.values(r).some(e=>e.status===it.Unsent)&&t.push(i);return ee.debug`RETURN: VariationConfiguration.unsentDataVisitors() -> (visitors: ${t})`,t}getPendingData(e){return this.getVariationData(e,e=>e===it.Pending)}getStoredVariations(e){let t=this.storage.read();if(!t.ok)return t;let i=t.data[e];return i?x.Ok(i):x.Err(new $(k.StorageRead,e))}getVariation({visitorCode:e,visitorIdentifier:t,featureFlag:i,targetingData:r,packageInfo:a,clientConfiguration:n,dataManager:o,track:s=!0,withAssignment:u=!1}){ee.debug`CALL: VariationConfiguration.getVariation(visitorCode: ${e}, visitorIdentifier: ${t}, featureFlag: ${i}, targetingData: ${r}, packageInfo: ${a}, clientConfiguration, dataManager, withAssignment: ${u})`;let{rules:l,featureKey:d,id:c,defaultVariationKey:h}=i;for(let f of l){let{segment:l,experimentId:g,id:p,exposition:v,respoolTime:m,variationByExposition:y}=f,C=this.getForcedExperimentVariation(e,f.experimentId),b=null;if(C.ok&&(b=C.data)&&b.forceTargeting){ee.info`Visitor ${e} has been forced targeted for ${f}`;let n=this.createAndSaveForcedTargetedVariation(e,i,f,b,s,u);return ee.debug`RETURN: VariationConfiguration.getVariation(visitorCode: ${e}, visitorIdentifier: ${t}, featureFlag: ${i}, targetingData: ${r}, packageInfo: ${a}, clientConfiguration, dataManager, withAssignment: ${u}) -> (targetedVariation: ${n})`,x.Ok(n)}let w=ey.checkTargeting({segment:l,visitorCode:e,experimentId:g,targetingData:r,packageInfo:a,clientConfiguration:n,dataManager:o,variationConfiguration:this});if(!w.ok)return ee.debug`RETURN: VariationConfiguration.getVariation(visitorCode: ${e}, visitorIdentifier: ${t}, featureFlag: ${i}, targetingData: ${r}, packageInfo: ${a}, clientConfiguration, dataManager, withAssignment: ${u}) -> (targetedVariation: ${w})`,w;if(!w.data)continue;if(ee.info`Visitor ${e} has been targeted for ${f}`,b){let n=this.createAndSaveForcedTargetedVariation(e,i,f,b,s,u);return ee.debug`RETURN: VariationConfiguration.getVariation(visitorCode: ${e}, visitorIdentifier: ${t}, featureFlag: ${i}, targetingData: ${r}, packageInfo: ${a}, clientConfiguration, dataManager, withAssignment: ${u}) -> (targetedVariation: ${n})`,x.Ok(n)}let E=i$.getHashDouble({visitorIdentifier:t,respoolTime:m,id:String(p)});if(ee.debug`Calculated ruleHash: ${E} for code: ${t}`,E<=v){let n=this.evaluateCBScores(f,t,r);if(!n){let e=i$.getHashDouble({visitorIdentifier:t,respoolTime:m,id:String(g)});ee.debug`Calculated variationHash: ${e} for code: ${t}`,n=ey.getVariationByHash(y,e)}if(n){u&&this.updateStoredVariations(e,{[g]:{variationId:n.variationId,isTargetedRule:f.type===ia.TARGETED_DELIVERY,status:s?it.Unsent:it.Sent}});let o={variationId:n.variationId,variationKey:n.variationKey,rule:f,featureFlagId:c,featureKey:d,experimentId:g,isTargetedRule:f.type===ia.TARGETED_DELIVERY};return ee.debug`RETURN: VariationConfiguration.getVariation(visitorCode: ${e}, visitorIdentifier: ${t}, featureFlag: ${i}, targetingData: ${r}, packageInfo: ${a}, clientConfiguration, dataManager, withAssignment: ${u}) -> (targetedVariation: ${o})`,x.Ok(o)}}if(f.type===ia.TARGETED_DELIVERY){let n={featureKey:d,featureFlagId:c,experimentId:null,variationKey:h,variationId:null,rule:null,isTargetedRule:!0};return ee.debug`RETURN: VariationConfiguration.getVariation(visitorCode: ${e}, visitorIdentifier: ${t}, featureFlag: ${i}, targetingData: ${r}, packageInfo: ${a}, clientConfiguration, dataManager, withAssignment: ${u}) -> (targetedVariation: ${n})`,x.Ok(n)}}let f={featureKey:d,featureFlagId:c,experimentId:null,variationKey:h,variationId:null,rule:null,isTargetedRule:!1};return ee.debug`RETURN: VariationConfiguration.getVariation(visitorCode: ${e}, visitorIdentifier: ${t}, featureFlag: ${i}, targetingData: ${r}, packageInfo: ${a}, clientConfiguration, dataManager, withAssignment: ${u}) -> (targetedVariation: ${f})`,x.Ok(f)}createAndSaveForcedTargetedVariation(e,t,i,r,a,n){let o={variationKey:r.varByExp.variationKey,variationId:r.varByExp.variationId,rule:i,featureFlagId:t.id,featureKey:t.featureKey,experimentId:i.experimentId,isTargetedRule:i.type===ia.TARGETED_DELIVERY};return n&&this.updateStoredVariations(e,{[i.experimentId]:{variationId:o.variationId,isTargetedRule:i.type===ia.TARGETED_DELIVERY,status:a?it.Unsent:it.Sent}}),o}updateStoredVariations(e,t){ee.debug`CALL: VariationConfiguration.updateStoredVariations(visitorCode: ${e}, variationData: ${t})`;let i=this.storage.read();if(!i.ok)return ee.debug`RETURN: VariationConfiguration.updateStoredVariations(visitorCode: ${e}, variationData: ${t}) -> (result: ${i})`,i;let r=i.data;for(let i in r[e]||(r[e]={}),t)r[e][i]=t[i];let a=this.storage.write(r);return ee.debug`RETURN: VariationConfiguration.updateStoredVariations(visitorCode: ${e}, variationData: ${t}) -> (resultWrite: ${a})`,a}getVariationData(e,t){let i=this.getStoredVariations(e);if(!i.ok)return[];let r=[];for(let[e,a]of Object.entries(i.data))t(a.status)&&r.push({experimentId:Number(e),variationId:a.variationId,isTargetedRule:a.isTargetedRule});return r}updateForcedExperimentVariation(e,t,i){ee.debug`CALL: VariationConfiguration.updateForcedExperimentVariation(visitorCode: ${e}, experimentId: ${t}, forcedExperimentVariation: ${i})`;let r=this.storageForcedExperimentVariations.read();if(!r.ok)return ee.debug`RETURN: VariationConfiguration.updateForcedExperimentVariation(visitorCode: ${e}, experimentId: ${t}, forcedExperimentVariation: ${i}) -> (result: ${r})`,r;let a=r.data;a[e]||(a[e]={}),i?a[e][t]=i:delete a[e][t];let n=this.storageForcedExperimentVariations.write(a);return ee.debug`RETURN: VariationConfiguration.updateForcedExperimentVariation(visitorCode: ${e}, experimentId: ${t}, forcedExperimentVariation: ${i}) -> (resultWrite: ${n})`,n}updateForcedFeatureVariations(e,t){ee.debug`CALL: VariationConfiguration.updateForcedFeatureVariations(visitorCode: ${e}, forcedFeatureVariations: ${t})`;let i=this.storageForcedFeatureVariations.read();if(!i.ok)return ee.debug`RETURN: VariationConfiguration.updateForcedFeatureVariations(visitorCode: ${e}, forcedFeatureVariations: ${t}) -> (result: ${i})`,i;let r=i.data;r[0]||(r[0]={}),r[1]||(r[1]={});let a=r[0],n=r[1];a[e]||(a[e]={}),n[e]||(n[e]={}),t.forEach(t=>{(t.simulated?n[e]:a[e])[t.featureKey]=t});let o=this.storageForcedFeatureVariations.write(r);return ee.debug`RETURN: VariationConfiguration.updateForcedFeatureVariations(visitorCode: ${e}, forcedFeatureVariations: ${t}) -> (resultWrite: ${o})`,o}clearSimulatedVariations(e){var t;let i;ee.debug`CALL: VariationConfiguration.clearSimulatedVariations(visitorCode: ${e})`;let r=this.storageForcedFeatureVariations.read();if(!r.ok)return ee.debug`RETURN: VariationConfiguration.clearSimulatedVariations(visitorCode: ${e}) -> (result: ${r})`,r;let a=r.data;return(null===(t=null==a?void 0:a[1])||void 0===t?void 0:t[e])?(delete a[1][e],i=this.storageForcedFeatureVariations.write(a)):i=x.Ok(),ee.debug`RETURN: VariationConfiguration.clearSimulatedVariations(visitorCode: ${e}) -> (resultWrite: ${i})`,i}getForcedFeatureVariation(e,t){var i,r,a,n;ee.debug`CALL: VariationConfiguration.getForcedFeatureVariation(visitorCode: ${e}, featureKey: ${t})`;let o=this.storageForcedFeatureVariations.read();if(!o.ok)return ee.debug`RETURN: VariationConfiguration.getForcedFeatureVariation(visitorCode: ${e}, featureKey: ${t}) -> (simulatedResult: ${o})`,o;let s=null===(r=null===(i=o.data[1])||void 0===i?void 0:i[e])||void 0===r?void 0:r[t];if(s)return ee.debug`RETURN: VariationConfiguration.getForcedFeatureVariation(visitorCode: ${e}, featureKey: ${t}) -> (simulatedData: ${s})`,x.Ok(s);let u=null===(n=null===(a=o.data[0])||void 0===a?void 0:a[e])||void 0===n?void 0:n[t];return ee.debug`RETURN: VariationConfiguration.getForcedFeatureVariation(visitorCode: ${e}, featureKey: ${t}) -> (forcedData: ${u})`,x.Ok(u)}getForcedExperimentVariation(e,t){var i;ee.debug`CALL: VariationConfiguration.getForcedExperimentVariation(visitorCode: ${e}, experimentId: ${t})`;let r=this.storageForcedExperimentVariations.read();if(!r.ok)return ee.debug`RETURN: VariationConfiguration.getForcedExperimentVariation(visitorCode: ${e}, experimentId: ${t}) -> (forcedResult: ${r})`,r;let a=null===(i=r.data[e])||void 0===i?void 0:i[t];return ee.debug`RETURN: VariationConfiguration.getForcedExperimentVariation(visitorCode: ${e}, experimentId: ${t}) -> (forcedExperiment: ${a})`,x.Ok(a)}parseForcedVariationData(e,t=!1){let i=this.clientConfiguration.featureFlags.get(e.featureKey);if(!i)return ee.error`Simulated feature flag '${e.featureKey}' not found`,null;if(0===e.experimentId)return{featureKey:e.featureKey,rule:null,varByExp:null,simulated:t};for(let r of i.rules){if(e.experimentId!==r.experimentId)continue;let i=r.variationByExposition.find(t=>t.variationId===e.variationId);if(i)return{featureKey:e.featureKey,rule:{type:r.type,experimentId:r.experimentId},varByExp:{variationKey:i.variationKey,variationId:i.variationId},simulated:t}}return ee.error`Simulated variation ${e.variationId} not found`,null}simulatedVariationFromJson(e,t){if(ee.debug`CALL: VariationConfiguration.simulatedVariationFromJson(featureKey: ${e}, data: ${t})`,!this.isSimulatedVariationJson(t))return null;let i=this.parseForcedVariationData({featureKey:e,variationId:t.varId,experimentId:t.expId},!0);return ee.debug`RETURN: VariationConfiguration.simulatedVariationFromJson(featureKey: ${e}, data: ${t}) -> (forcedVariation: ${i})`,i}isSimulatedVariationJson(e){return e&&("number"==typeof e.expId||null===e.expId)}evaluateCBScores(e,t,i){if(!i||!i.cbScores)return null;ee.debug`CALL: KameleoonClientImpl.evaluateCBScores(rule: ${e}, targetingData: ${i}, visitorIdentifier: ${t})`;let r=e.experimentId,a=new eO(i.cbScores.cbs).getValues().get(r),n=null;if(void 0!==a){let i=e.variationByExposition,o=a.map(e=>i.filter(t=>e.ids.includes(t.variationId))).find(e=>e.length>0);if(o){let i=0;if(o.length>1){let a=i$.getHashDouble({visitorIdentifier:t,respoolTime:e.respoolTime,id:String(r)});ee.debug`Calculated cbs hash ${a} for code ${t}`,i=Math.min(Math.floor(a*o.length),o.length-1)}n=o[i]}}return ee.debug`RETURN: KameleoonClientImpl.evaluateCBScores(rule: ${e}, targetingData: ${i}, visitorIdentifier: ${t}) -> (variation: ${n})`,n}}let iL=class{constructor({siteCode:e,externalEventSource:t,urlProvider:i}){this.url=i.getEventSourceUrl(),this.siteCode=e,this.eventSource=t,this.isConnectionOpen=!1}get isOpen(){return this.isConnectionOpen}open(e){this.eventSource.open({onEvent:this.handleMessage(e),url:this.url,eventType:"configuration-update-event"}),this.isConnectionOpen=!0,ee.info`Established a new SSE connection with: ${this.url}`}close(){this.eventSource.close(),this.isConnectionOpen=!1,ee.info`SSE connection: '${this.url}' was successfully closed`}onError(e){this.eventSource.onError?this.eventSource.onError(e):ee.warning("EventSource does not have `onError` method provided. Real-time errors won't be handled.")}handleMessage(e){return t=>{ee.debug`Received new message from: ${this.url}`;let{siteCode:i,ts:r}=JSON.parse(t.data);this.siteCode===i&&e(r)}}},iU=class{constructor(){this.isConsentRequired=!1}set consentRequired(e){this.isConsentRequired=e}get consentRequired(){return this.isConsentRequired}set getData(e){this.getDataCallback=e}set setData(e){this.setDataCallback=e}get setData(){if(this.setDataCallback)return this.setDataCallback;throw Error("Missing setDataCallback!")}validateVisitorCode(e){return 0===e.length?x.Err(new $(k.VisitorCodeEmpty)):e.length>255?x.Err(new $(k.VisitorCodeMaxLength)):x.Ok()}getVisitorCode(e){let t;if(ee.debug`CALL: VisitorCodeManager.getVisitorCode(defaultVisitorCode: ${e})`,!this.getDataCallback||!this.setDataCallback)throw Error("Missing getDataCallback or setDataCallback methods in getVisitorCode!");let i=this.getDataCallback(iV.VisitorCode);return i&&(t=i),t||(e?(this.validateVisitorCode(e).throw(),t=e,ee.debug`Used default visitor code: ${t}`):(t=this.generateVisitorCode(),ee.debug`Generated new visitor code: ${t}`)),this.processSimulatedVariations(t),this.isConsentRequired||this.setDataCallback({visitorCode:t,key:iV.VisitorCode,maxAge:31536e3,path:"/"}),ee.debug`RETURN: VisitorCodeManager.getVisitorCode(defaultVisitorCode: ${e}) -> (visitorCode: ${t})`,t}processSimulatedVariations(e){if(this.variationConfiguration){let t=this.getSimulatedVariations(e);try{this.variationConfiguration.clearSimulatedVariations(e).throw(),null!==t&&t.length>0&&this.variationConfiguration.updateForcedFeatureVariations(e,t).throw()}catch(e){e instanceof Error&&ee.error`Failed to process simulated variations: ${e.message}`}}}getSimulatedVariations(e){ee.debug`CALL: VisitorCodeManager.getSimulatedVariations(visitorCode: ${e})`;let t=this.getDataCallback(iV.KameleoonSimulationFFData),i=null;if("string"==typeof t&&t.length>0)try{let e=JSON.parse(decodeURIComponent(t));e&&"object"==typeof e&&(i=Object.entries(e).map(([e,t])=>this.variationConfiguration.simulatedVariationFromJson(e,t)).filter(e=>null!==e))}catch(e){e instanceof Error&&ee.error`Failed to parse simulated variations: ${e.message}`}return ee.debug`RETURN: VisitorCodeManager.getSimulatedVariations(visitorCode: ${e}) -> (variations: ${i})`,i}generateVisitorCode(){let e=[];for(let t=0;t<16;t++)e.push("abcdefghijklmnopqrstuvwxyz0123456789"[Math.floor(36*Math.random())]);return e.join("")}setVariationConfiguration(e){this.variationConfiguration||(this.variationConfiguration=e)}};(r=a||(a={}))[r.Kb=1e3]="Kb",r[r.Mb=1e6]="Mb",r[r.Gb=1e9]="Gb";let ij=10*a.Mb;class iK{constructor(e){this.currentSize=0,this.resultBody=[],this.hasUserAgent=!1,this.trackingVisitors={},this.prng=e}getTrackingBody(){let e={body:this.resultBody.join("\n"),hasUserAgent:this.hasUserAgent};return this.cleanup(),e}addData({visitorCode:e,variationData:t,visitorData:i,userAgent:r,isConsentProvided:a,isMappingIdentifier:n}){let o=[],s=this.getVariationDataLines(t),u=this.getVisitorDataLines(i);return o.push(...s,...u),this.addVisitorTrackingLines({visitorCode:e,lines:o,userAgent:r,isConsentProvided:a,isMappingIdentifier:n})}getVisitorDataLines(e){let t=[];for(let i of e){let e;if(!(i instanceof eF||i.data.type!==ic.Conversion&&i.data.type!==ic.PageView)){let t=i.data.nonce;t?e=t:(e=ey.getNonce(this.prng),i.data.nonce=e)}e||(e=ey.getNonce(this.prng)),t.push(i.url+G+e)}return t}getVariationDataLines(e){let t=[];return e.forEach(e=>{t.push("eventType=experiment"+z+e.experimentId+"&variationId="+e.variationId+G+ey.getNonce(this.prng))}),t}prepareVisitorBody(e){let t=this.trackingVisitors[e];if(!t)return x.Err();let{lines:i,userAgent:r,isMappingIdentifier:a,isConsentProvided:n}=t,o=this.getIdentifier(e,a);if(i.length)i.forEach((e,t)=>{i[t]=e+o}),ee.debug`Sending tracking request for unsent data ${i} of visitor ${e} with given (or not required) consent ${n}`;else if(n){let t=this.getActivityLine();i.push(t+o),ee.debug`Sending tracking request for activity of visitor ${e} with given consent`}else ee.debug`No data to send for visitor ${e} with no consent`;r&&i.length&&(i[0]+="&userAgent="+r,this.hasUserAgent=!0);let s=this.checkSize(i);return s.ok&&this.resultBody.push(...i),s}cleanup(){this.currentSize=0,this.resultBody=[],this.hasUserAgent=!1,this.trackingVisitors={}}checkSize(e){let t;return(t=0+e.reduce((e,t)=>e+4*t.length,0))+this.currentSize>ij?x.Err():(this.currentSize+=t,x.Ok())}addVisitorTrackingLines({visitorCode:e,lines:t,userAgent:i,isConsentProvided:r,isMappingIdentifier:a}){return this.trackingVisitors[e]?(i&&(this.trackingVisitors[e].userAgent=i),this.trackingVisitors[e].lines.push(...t)):this.trackingVisitors[e]={isMappingIdentifier:a,isConsentProvided:r,userAgent:i,lines:t},this.prepareVisitorBody(e)}getActivityLine(){return"eventType=activity"+G+ey.getNonce(this.prng)}getIdentifier(e,t){return(t?Y:K)+e}}class iG{constructor({dataManager:e,trackingStorage:t,variationConfiguration:i,trackingInterval:r,requester:a,prng:n,clientConfiguration:o}){this.intervalId=null,ee.debug`CALL: new Tracker(dataManager, trackingStorage, variationConfiguration, trackingInterval: ${r}, requester, prng, clientConfiguration)`,this.dataManager=e,this.trackingStorage=t,this.variationConfiguration=i,this.requester=a,this.bodyProvider=new iK(n),this.clientConfiguration=o;try{this.intervalId=setInterval(()=>{this.sendDataAll()},r)}catch(e){throw this.intervalId&&clearInterval(this.intervalId),e}ee.debug`RETURN: new Tracker(dataManager, trackingStorage, variationConfiguration, trackingInterval: ${r}, requester, prng, clientConfiguration)`}scheduleVisitor(e,t){ee.debug`CALL: Tracker.scheduleVisitor(visitorCode: ${e}, isConsentProvided: ${t})`,this.trackingStorage.read().and(i=>{i.scheduledVisitors[`_${e}`]={isConsentProvided:t},this.trackingStorage.write(i)}),ee.debug`RETURN: Tracker.scheduleVisitor(visitorCode: ${e}, isConsentProvided: ${t})`}checkIsIdentifier(e){var t,i;let r=this.dataManager.isUniqueIdentifier(e),a=null!==(i=null===(t=this.dataManager.getMappingIdentifier(e))||void 0===t?void 0:t.mappingIdentifier)&&void 0!==i?i:e,n=!1;if(r){let t=this.dataManager.getLinkedVisitor(e),i=this.dataManager.identifierCustomDataIndex;t||"number"!=typeof i?n=!0:this.dataManager.storeData(e,new ew(i,e))}return n&&e!=a}getUserAgent(e){let t=this.dataManager.getVisitorData(e);if(t){let e=t[ic.UserAgent];if(e)return e.value}}sendDataAll(){return M(this,0,void 0,function*(){let e=this.trackingStorage.read();if(!e.ok)return;let{scheduledVisitors:t}=e.data;yield this.sendData(t)})}sendDataForVisitor(e,t){return M(this,0,void 0,function*(){this.trackingStorage.read().ok&&(yield this.sendData({[`_${e}`]:{isConsentProvided:t}}))})}sendData(e){return M(this,0,void 0,function*(){let t={},i=[],r=[];for(let[a,{isConsentProvided:n}]of Object.entries(e)){let e=a.startsWith("_")?a.substring(1):a,o=this.checkIsIdentifier(e),s=this.getUserAgent(e),u=this.getUnsentVisitorData(e,n),l=this.getUnsentVariationData(e,n);if(!this.bodyProvider.addData({visitorCode:e,variationData:l,visitorData:u,userAgent:s,isConsentProvided:n,isMappingIdentifier:o}).ok){ee.warning("Visitor data to be tracked exceeded the request size limit. Some visitor data is kept to be sent later. If it is not caused by the peak load, decreasing the tracking interval is recommended.");break}t[e]={visitorData:u,variationData:l},r.push({visitorCode:e,isConsentProvided:n}),i.push(a)}let{body:a,hasUserAgent:n}=this.bodyProvider.getTrackingBody();if(0!==i.length&&this.trackingStorage.read().and(e=>{i.forEach(t=>{delete e.scheduledVisitors[t]}),this.trackingStorage.write(e)}),a){if((yield this.requester.track(a,n)).ok)ee.info`Successful request for tracking visitors: ${r}, data: ${t}`,this.updateDataStatus(t,it.Sent);else{ee.error("Tracking request failed"),ee.info`Failed request for tracking visitors: ${r}, data: ${t}`,this.updateDataStatus(t,it.Unsent);let e={};for(let{visitorCode:t,isConsentProvided:i}of r)e[t=`_${t}`]={isConsentProvided:i};this.addNotTrackedVisitors(e)}}})}addNotTrackedVisitors(e){let t=this.trackingStorage.read();if(!t.ok)return;let{scheduledVisitors:i}=t.data;Object.entries(e).forEach(([e,{isConsentProvided:t}])=>{i[e]||(i[e]={isConsentProvided:t})}),this.trackingStorage.write({scheduledVisitors:i})}updateDataStatus(e,t){let i={};for(let[r,{visitorData:a,variationData:n}]of Object.entries(e)){let e=a.filter(e=>!(e instanceof eF)).map(e=>(e.status=t,e));e.length&&(i[r]=e);let o=n.map(e=>String(e.experimentId));this.variationConfiguration.updateDataStatus({visitorCode:r,experimentIdList:o,status:t})}0!==Object.keys(i).length&&(t===it.Sent?this.dataManager.storeTrackedData(i):this.dataManager.storeData(i))}getUnsentVisitorData(e,t){let i=this.dataManager.getUnsentData(e),r=[];if(!i.length)return[];for(let e of i)e.url&&(t||this.clientConfiguration.hasAnyTargetedDeliveryRule&&!(e instanceof eF)&&e.data.type===ic.Conversion)&&r.push(e);if(r.length){let t=r.filter(e=>!(e instanceof eF)).map(e=>(e.status=it.Pending,e));this.dataManager.storeTrackedData({[e]:t})}return r}getUnsentVariationData(e,t){let i=this.variationConfiguration.getUnsentData(e),r=new Set;if(!i.length)return[];let a=i.filter(e=>{let i=e.isTargetedRule||t;return i&&r.add(String(e.experimentId)),i});return this.variationConfiguration.updateDataStatus({visitorCode:e,experimentIdList:Array.from(r),status:it.Pending}),a}}let iz=class e{constructor({siteCode:e,dependencies:t,configuration:i,internalConfiguration:r,stubMode:a}){var n;if(this.initialized=!1,this.stubMode=a,a)return this.variationConfiguration={},this.clientConfiguration={},this.dataManager={},this.consentDataStorage={},this.trackingCache={},this.requester={},this.externalPackageInfo={},this.visitorCodeManager={},this.eventManager={},this.tracker={},void(this.environment="");let o=null==r?void 0:r.externals.externalLogger;o&&ee.setLogger(o),e$.setConditionFactoryInstance(new ti),ee.debug`CALL: new KameleoonClient(siteCode: ${e}, dependencies: ${t}, configuration: ${i})`;let{settings:s}=new ex(e,i);this.environment=s.environment;let{externalStorage:u,externalEventSource:l,externalPackageInfo:d,externalVisitorCodeManager:c,externalRequester:h,externalPRNG:f,customDataManager:g}=r.externals,{useAbortController:p}=r.settings,v=new er(10),m=new to(u,iV.ClientData),y=new to(u,iV.VariationData),C=new to(u,iV.ForcedExperimentVariation),b=new to(u,iV.ForcedFeatureVariation),w=new to(u,iV.ConsentData),E=new to(u,iV.TrackingData),k=g;k||(k=new tl({dataStorage:new to(u,iV.TargetingData),infoStorage:new to(u,iV.DataInfo),cleanupInterval:s.cleanupInterval,packageInfo:d}));let D=null!==(n=null==t?void 0:t.urlProvider)&&void 0!==n?n:new ei;D.initialize({domain:s.networkDomain,siteCode:s.siteCode,packageInfo:d,environment:s.environment});let S=new et({urlProvider:D,useAbortController:p,packageInfo:d,externalRequester:h,requestTimeout:s.requestTimeout,trackRetryDelay:s.trackRetryDelay}),I=new iL({siteCode:s.siteCode,externalEventSource:l,urlProvider:D}),T=new ea,R=new es({urlProvider:D,storage:m,updateInterval:s.updateInterval,dataManager:k,eventManager:T,requester:S,eventSource:I,externalVisitorCodeManager:c,externalPackageInfo:d,defaultDataFile:null==i?void 0:i.defaultDataFile}),V=new iP(y,C,b,c,R),O=new iG({dataManager:k,trackingStorage:E,variationConfiguration:V,requester:S,trackingInterval:s.trackingInterval,prng:f,clientConfiguration:R});this.tracker=O,this.variationConfiguration=V,this.requester=S,this.trackingCache=v,this.dataManager=k,this.clientConfiguration=R,this.externalPackageInfo=d,this.consentDataStorage=w,this.visitorCodeManager=c,this.eventManager=T,null!==s.cleanupInterval&&new ts(u,s.cleanupInterval),ee.debug`RETURN: new KameleoonClient(siteCode: ${e}, dependencies: ${t}, configuration: ${i})`}initialize(){return M(this,0,void 0,function*(){if(this.stubMode)return!1;ee.info("CALL: KameleoonClient.initialize()");let e=yield this.clientConfiguration.initialize();return e.throw(),this.initialized=!0,ee.info`RETURN: KameleoonClient.initialize() -> (result: ${e.ok})`,e.ok})}addData(e,...t){if(this.stubMode||(ee.info`CALL: KameleoonClient.addData(visitorCode: ${e}, data: ${t})`,this.visitorCodeManager.validateVisitorCode(e).throw(),!this.initialized))throw new $(k.Initialization);this.dataManager.storeData(e,...t).throw(),ee.info`RETURN: KameleoonClient.addData(visitorCode: ${e}, data: ${t})`}getRemoteVisitorData({visitorCode:e,shouldAddData:t=!0,filters:i=eg}){return M(this,0,void 0,function*(){if(this.stubMode||(ee.info`CALL: KameleoonClient.getRemoteVisitorData(visitorCode: ${e}, shouldAddData: ${t}, filters: ${i})`,!this.initialized))throw new $(k.Initialization);this.visitorCodeManager.validateVisitorCode(e).throw();let{previousVisitAmount:r}=i;if("number"==typeof r&&(r<1||r>25))throw new $(k.VisitAmount);let a=this.dataManager.isUniqueIdentifier(e),n=(yield this.requester.getVisitorData({visitorCode:e,filters:i,isMappingIdentifier:a})).throw(),{visitorData:o,storageVisitorData:s,visitsData:u,mappingIdentifier:l}=e_.parseVisitorData({data:n,filters:i,visitorCode:e,dataManager:this.dataManager,variationConfiguration:this.variationConfiguration});for(let i of s)(t||this.dataManager.isPersistentCustomData(i))&&this.addData(e,i);return u&&t&&this.addData(e,u),(null==i?void 0:i.visitorCode)&&l&&this.dataManager.setMappingIdentifier(e,l),ee.info`RETURN: KameleoonClient.getRemoteVisitorData(visitorCode: ${e}, shouldAddData: ${t}, filters: ${i}) -> (visitorData: ${o})`,o})}trackConversion({visitorCode:e,goalId:t,negative:i,revenue:r,metadata:a}){this.stubMode||(ee.info`CALL: KameleoonClient.trackConversion(visitorCode: ${e}, goalId: ${t}, negative: ${i}, revenue: ${r}, metadata: ${a})`,this.addData(e,new eE({goalId:t,revenue:r,negative:i,metadata:a})),this.flush(e),ee.info`RETURN: KameleoonClient.trackConversion(visitorCode: ${e}, goalId: ${t}, negative: ${i}, revenue: ${r}, metadata: ${a})`)}flush(e){var t;if(this.stubMode)throw new $(k.Initialization);let i,r=!1;if("string"==typeof e?i=e:e&&(i=e.visitorCode,r=null!==(t=e.instant)&&void 0!==t&&t),ee.info`CALL: KameleoonClient.flush(visitorCode: ${i}, instant: ${r})`,!this.initialized)throw new $(k.Initialization);if("string"==typeof i)this.visitorCodeManager.validateVisitorCode(i).throw(),r?this.tracker.sendDataForVisitor(i,this._isConsentProvided(i)):this.tracker.scheduleVisitor(i,this._isConsentProvided(i));else{for(let e of this.dataManager.unsentDataVisitors)this.tracker.scheduleVisitor(e,this._isConsentProvided(e));for(let e of this.variationConfiguration.getVisitorsWithUnsentData())this.tracker.scheduleVisitor(e,this._isConsentProvided(e));r&&this.tracker.sendDataAll()}ee.info`RETURN: KameleoonClient.flush(visitorCode: ${i}, instant: ${r})`}getFeatureFlags(){if(this.stubMode||(ee.info("CALL: KameleoonClient.getFeatureFlags()"),!this.initialized))throw new $(k.Initialization);let e=this.clientConfiguration.featureFlags,t=[];return e.forEach(({id:e,featureKey:i})=>{t.push({id:e,key:i})}),ee.info`RETURN: KameleoonClient.getFeatureFlags() -> (FeatureFlags: ${t})`,t}getVisitorFeatureFlags(e){if(this.stubMode||(ee.info`CALL: KameleoonClient.getVisitorFeatureFlags(visitorCode: ${e})`,!this.initialized))throw new $(k.Initialization);this.visitorCodeManager.validateVisitorCode(e).throw();let t=this._getActiveFeatureVariations(e),i=[];return t.forEach(({featureFlagId:e,featureKey:t})=>{i.push({id:e,key:t})}),ee.info`RETURN: KameleoonClient.getVisitorFeatureFlags(visitorCode: ${e}) -> (FeatureFlags: ${i})`,i}getVariation({visitorCode:e,featureKey:t,track:i=!0}){if(this.stubMode)throw new $(k.Initialization);ee.info`CALL: KameleoonClient.getVariation(visitorCode: ${e}, featureKey: ${t}, track: ${i})`,this.visitorCodeManager.validateVisitorCode(e).throw();let r=this._getFeatureVariation({visitorCode:e,featureKey:t,track:i}).throw();return ee.info`RETURN: KameleoonClient.getVariation(visitorCode: ${e}, featureKey: ${t}, track: ${i}) -> (variation: ${r})`,r}getVariations({visitorCode:e,onlyActive:t=!1,track:i=!0}){if(this.stubMode)throw new $(k.Initialization);ee.info`CALL: KameleoonClient.getVariations(visitorCode: ${e}, onlyActive: ${t}, track: ${i})`,this.visitorCodeManager.validateVisitorCode(e).throw();let r=new Map;for(let a of this.clientConfiguration.featureFlags.values()){let n=this._getFeatureVariation({visitorCode:e,featureKey:a.featureKey,track:i});n.ok&&(t&&"off"===n.data.key||r.set(a.featureKey,n.data))}return ee.info`RETURN: KameleoonClient.getVariations(visitorCode: ${e}, onlyActive: ${t}, track: ${i}) -> (variations: ${r})`,r}getActiveFeatureFlags(e){if(this.stubMode||(ee.info`CALL: KameleoonClient.getActiveFeatureFlags(visitorCode: ${e})`,!this.initialized))throw new $(k.Initialization);this.visitorCodeManager.validateVisitorCode(e).throw();let t=this._getActiveFeatureVariations(e),i=new Map;return t.forEach(t=>{let{variationKey:r,featureKey:a,variationId:n,experimentId:o}=t,s=[];null!==n&&null!==o&&(s=this._getFeatureVariables({visitorCode:e,featureKey:a,variationKey:r}));let u=s.map(e=>e_.parseFeatureVariable(e).throw());i.set(t.featureKey,{key:r,id:n,experimentId:o,variables:u})}),ee.info`RETURN: KameleoonClient.getActiveFeatureFlags(visitorCode: ${e}) -> (FeatureFlags: ${i})`,i}getFeatureFlagVariationKey(e,t){if(this.stubMode)throw new $(k.Initialization);ee.info`CALL: KameleoonClient.getFeatureFlagVariationKey(visitorCode: ${e}, featureKey: ${t})`,this.visitorCodeManager.validateVisitorCode(e).throw();let{key:i}=this._getFeatureVariation({visitorCode:e,featureKey:t,track:!0}).throw();return ee.info`RETURN: KameleoonClient.getFeatureFlagVariationKey(visitorCode: ${e}, featureKey: ${t}) -> (variationKey: ${i})`,i}getFeatureFlagVariable({visitorCode:e,featureKey:t,variableKey:i}){if(this.stubMode)throw new $(k.Initialization);ee.info`CALL: KameleoonClient.getFeatureFlagVariable(visitorCode: ${e}, featureKey: ${t}, variableKey: ${i})`,this.visitorCodeManager.validateVisitorCode(e).throw();let{key:r}=this._getFeatureVariation({visitorCode:e,featureKey:t,track:!0}).throw(),a=this._getFeatureVariables({visitorCode:e,featureKey:t,variationKey:r}).find(e=>e.key===i);if(!a)throw new $(k.FeatureFlagVariableNotFound,i,e);let{type:n,value:o}=e_.parseFeatureVariable(a).throw(),s={type:n,value:o};return ee.info`RETURN: KameleoonClient.getFeatureFlagVariable(visitorCode: ${e}, featureKey: ${t}, variableKey: ${i}) -> (FeatureFlagVariable: ${s})`,s}getFeatureFlagVariables(e,t){if(this.stubMode)throw new $(k.Initialization);ee.info`CALL: KameleoonClient.getFeatureFlagVariables(visitorCode: ${e}, featureKey: ${t})`,this.visitorCodeManager.validateVisitorCode(e).throw();let{key:i}=this._getFeatureVariation({visitorCode:e,featureKey:t,track:!0}).throw(),r=this._getFeatureVariables({visitorCode:e,featureKey:t,variationKey:i}),a=[];for(let e of r){let t=e_.parseFeatureVariable(e).throw();a.push(t)}return ee.info`RETURN: KameleoonClient.getFeatureFlagVariables(visitorCode: ${e}, featureKey: ${t}) -> (FeatureFlagVariables: ${a})`,a}isFeatureFlagActive(e,t){if(this.stubMode)throw new $(k.Initialization);let[i,r,a]=["","",!0];"string"==typeof e?(i=e,r=t):([i,r]=[e.visitorCode,e.featureKey],void 0!==e.track&&(a=e.track)),ee.info`CALL: KameleoonClient.isFeatureFlagActive(visitorCode: ${i}, featureKey: ${r}, track ${a})`,this.visitorCodeManager.validateVisitorCode(i).throw();try{let{key:e}=this._getFeatureVariation({visitorCode:i,featureKey:r,track:a}).throw(),t="off"!==e;return ee.info`RETURN: KameleoonClient.isFeatureFlagActive(visitorCode: ${i}, featureKey: ${r}, track: ${a}) -> (isActive: ${t})`,t}catch(e){if(e instanceof $&&e.type===k.FeatureFlagEnvironmentDisabled)return ee.info`RETURN: KameleoonClient.isFeatureFlagActive(visitorCode: ${i}, featureKey: ${r}, track: ${a}) -> (isActive: false)`,!1;throw e}}getRemoteData(e){return M(this,0,void 0,function*(){if(this.stubMode)return null;ee.info`CALL: KameleoonClient.getRemoteData(key: ${e})`;let t=yield this.requester.getRemoteData(e);return ee.info`RETURN: KameleoonClient.getRemoteData(key: ${e}) -> (remoteData: ${t})`,t.throw()})}getVisitorWarehouseAudience({visitorCode:e,customDataIndex:t,warehouseKey:i}){return M(this,0,void 0,function*(){if(this.stubMode)return null;ee.info`CALL: KameleoonClient.getVisitorWarehouseAudience(visitorCode: ${e}, customDataIndex: ${t}, warehouseKey: ${i})`,this.visitorCodeManager.validateVisitorCode(e).throw();let r=yield this.getRemoteData(i||e);if(!r)throw new $(k.RemoteData,`No data found for ${i||e} key`);if(!r[ef]||0===Object.keys(r[ef]).length)return ee.info`RETURN: KameleoonClient.getVisitorWarehouseAudience(visitorCode: ${e}, customDataIndex: ${t}, warehouseKey: ${i}) -> (customData: null)`,null;let a=new ew(t,...Object.keys(r[ef]));return this.dataManager.storeData(e,a),ee.info`RETURN: KameleoonClient.getVisitorWarehouseAudience(visitorCode: ${e}, customDataIndex: ${t}, warehouseKey: ${i}) -> (customData: ${a})`,a})}onEvent(e,t){if(this.stubMode||(ee.info`CALL: KameleoonClient.onEvent(event: ${e}, callback)`,!this.initialized))throw new $(k.Initialization);this.eventManager.addEventHandler(e,t),ee.info`RETURN: KameleoonClient.onEvent(event: ${e}, callback)`}getEngineTrackingCode(e){if(this.stubMode)return"";ee.info`CALL: KameleoonClient.getEngineTrackingCode(visitorCode: ${e})`,this.visitorCodeManager.validateVisitorCode(e).throw();let t=ey.getTrackingCode(this.trackingCache,e);return ee.info`RETURN: KameleoonClient.getEngineTrackingCode(visitorCode: ${e}) -> (trackingCode: ${t})`,t}isInitialized(){return ee.debug`CALL/RETURN: KameleoonClient.isInitialized() -> (initialized: ${this.initialized})`,this.initialized}setLogLevel(e){ee.setLogLevel(e)}setForcedVariation({visitorCode:e,experimentId:t,variationKey:i,forceTargeting:r=!0}){this.stubMode||(ee.info`CALL: KameleoonClient.setForcedVariation(visitorCode: '${e}', experimentId: ${t}, variationKey: '${i}', forceTargeting: ${r})`,this.visitorCodeManager.validateVisitorCode(e).throw(),this._setForcedVariation({visitorCode:e,experimentId:t,variationKey:i,forceTargeting:r}).throw(),ee.info`RETURN: KameleoonClient.setForcedVariation(visitorCode: '${e}', experimentId: ${t}, variationKey: '${i}', forceTargeting: ${r})`)}evaluateAudiences(e){if(this.stubMode)return;ee.info`CALL: KameleoonClient.evaluateAudiences(visitorCode: ${e})`,this.visitorCodeManager.validateVisitorCode(e).throw();let t=[],i=this.dataManager.getVisitorData(e);for(let r of this.clientConfiguration.segments.values()){if(!r.audienceTracking)continue;let a=ey.checkTargeting({segment:r,visitorCode:e,targetingData:i,experimentId:null,clientConfiguration:this.clientConfiguration,packageInfo:this.externalPackageInfo,dataManager:this.dataManager,variationConfiguration:this.variationConfiguration});a.ok&&a.data&&(ee.info`Visitor ${e} has been targeted for ${r}`,t.push(new tu(Number(r.id))))}0!==t.length&&this.dataManager.storeData(e,...t),this.flush(e),ee.info`RETURN: KameleoonClient.evaluateAudiences(visitorCode: ${e})`}setUserConsent({visitorCode:e,consent:t,setData:i}){this.stubMode||(ee.info`CALL: KameleoonClient.setUserConsent(visitorCode: ${e}, consent: ${t}, setData: ${i})`,this.visitorCodeManager.validateVisitorCode(e).throw(),this.updateConsentData(e,t),t?i({visitorCode:e,key:iV.VisitorCode,maxAge:31536e3,path:"/"}):this.visitorCodeManager.consentRequired&&i({visitorCode:"",key:iV.VisitorCode,maxAge:0,path:"/"}),ee.info`RETURN: KameleoonClient.setUserConsent(visitorCode: ${e}, consent: ${t}, setData: ${i})`)}updateConsentData(e,t){let i=this.consentDataStorage.read();if(!i.ok)return void(i.error.type===k.StorageEmpty&&this.consentDataStorage.write({[e]:{consent:t}}));let r=i.data;r[e]={consent:t},this.consentDataStorage.write(r)}_isConsentProvided(e){ee.debug`CALL: KameleoonClient._isConsentProvided(visitorCode: ${e})`;let{isConsentRequired:t}=this.clientConfiguration,i=this.consentDataStorage.read(),r=!1;if(t){if(i.ok){let t=i.data[e];r="boolean"==typeof t?t:t&&t.consent}}else r=!0;return ee.debug`RETURN: KameleoonClient._isConsentProvided(visitorCode: ${e}) -> (isConsentProvided: ${r})`,r}_getFeatureVariables({visitorCode:e,featureKey:t,variationKey:i}){ee.debug`CALL: KameleoonClient._getFeatureVariables(visitorCode: ${e}, featureKey: ${t}, variationKey: ${i})`;let r=this.clientConfiguration.featureFlags.get(t);if(!r)throw new $(k.FeatureFlagConfigurationNotFound,t);let a=r.variations.find(e=>e.key===i);if(!a)throw new $(k.FeatureFlagVariationNotFound,i,e);return ee.debug`RETURN: KameleoonClient._getFeatureVariables(visitorCode: ${e}, featureKey: ${t}, variationKey: ${i}) -> (variables: ${a.variables})`,a.variables}_getActiveFeatureVariations(e){ee.debug`CALL: KameleoonClient._getActiveFeatureVariations(visitorCode: ${e})`;let t=this.clientConfiguration.featureFlags,i=[];for(let r of t.values()){if(!r.environmentEnabled)continue;let t=this._evaluate({visitorCode:e,featureFlag:r,track:!1,save:!1});"off"!==t.variationKey&&i.push({variationKey:t.variationKey,variationId:t.variationId,experimentId:t.experimentId,featureFlagId:r.id,featureKey:r.featureKey,rule:null,isTargetedRule:t.ruleType===ia.TARGETED_DELIVERY})}return ee.debug`RETURN: KameleoonClient._getActiveFeatureVariations(visitorCode: ${e}) -> (activeVariations: ${i})`,i}_evaluate({visitorCode:t,featureFlag:i,track:r,save:a}){let n;ee.debug`CALL: KameleoonClient._evaluate(visitorCode: ${t}, featureFlag: ${i}, track: ${r}, save: ${a})`;let o=null,s=this.dataManager.getVisitorData(t),u=this.variationConfiguration.getForcedFeatureVariation(t,i.featureKey);if(u.ok&&(o=u.data),o)n=e.EvaluatedExperiment.fromForcedFeatureVariation(i.defaultVariationKey,o);else if(this._isVisitorNotInHoldout(t,r,a,i,s)&&this._isFFUnrestrictedByMEGroup(t,i,s)){let o=this._getCodeForHash(t,i.bucketingCustomDataIndex,s),u=this.variationConfiguration.getVariation({visitorCode:t,visitorIdentifier:o,featureFlag:i,track:r,withAssignment:a,targetingData:s,clientConfiguration:this.clientConfiguration,dataManager:this.dataManager,packageInfo:this.externalPackageInfo}).throw();n=e.EvaluatedExperiment.fromVariationData(u)}else n=e.EvaluatedExperiment.fromDefaultVariationKey(i.defaultVariationKey);return a&&!n.isSimulated&&null!==n.experimentId&&null!==n.variationId&&this.variationConfiguration.updateStoredVariations(t,{[n.experimentId]:{variationId:n.variationId,isTargetedRule:n.ruleType===ia.TARGETED_DELIVERY,status:r?it.Unsent:it.Sent}}),this.eventManager.fireEvent(id.Evaluation,{featureKey:i.featureKey,variation:{key:n.variationKey,experimentId:n.experimentId,id:n.variationId}}),ee.debug`RETURN: KameleoonClient._evaluate(visitorCode: ${t}, featureFlag: ${i}, track: ${r}, save: ${a}) -> (evalExp: ${n})`,n}_isFFUnrestrictedByMEGroup(e,t,i){let r=t.mutuallyExclusiveGroup;if(!r)return!0;ee.debug`CALL: KameleoonClient._isFFUnrestrictedByMEGroup(visitorCode: ${e}, featureFlag: ${t}, visitorData: ${i})`;let a=!0,n=this.clientConfiguration.meGroups.get(r);if(n){let o=this._getCodeForHash(e,t.bucketingCustomDataIndex,i),s=i$.getHashDoubleForMEGroup(o,r);ee.debug`Calculated meGroup hash ${s} for code: ${o}, meGroup: ${r}`,a=n.getFeatureFlagByHash(s)===t}return ee.debug`RETURN: KameleoonClient._isFFUnrestrictedByMEGroup(visitorCode: ${e}, featureFlag: ${t}, visitorData: ${i}) -> (selected: ${a})`,a}_getFeatureVariation({visitorCode:e,featureKey:t,track:i}){if(ee.debug`CALL: KameleoonClient._getFeatureVariation(visitorCode: ${e}, featureKey: ${t}, track: ${i})`,!this.initialized)return x.Err(new $(k.Initialization));let r=this.clientConfiguration.featureFlags.get(t);if(!r)return x.Err(new $(k.FeatureFlagConfigurationNotFound,t));if(!r.environmentEnabled)return x.Err(new $(k.FeatureFlagEnvironmentDisabled,r.featureKey,this.environment));let{experimentId:a,variationId:n,variationKey:o,isSimulated:s}=this._evaluate({visitorCode:e,featureFlag:r,track:i,save:!0}),u=new Map,l=!1;try{this._getFeatureVariables({visitorCode:e,featureKey:t,variationKey:o}).forEach(e=>{l||e.type!==ie.JS&&e.type!==ie.CSS||(l=!0);let t=e_.parseFeatureVariable(e).throw();u.set(e.key,t)})}catch(e){}a&&"number"==typeof n&&!s&&ey.updateCache({cacheManager:this.trackingCache,hasJsCssVariables:l,visitorCode:e,experimentId:a,variationId:n}),i&&!s&&this.tracker.scheduleVisitor(e,this._isConsentProvided(e));let d={key:o,id:n,experimentId:a,variables:u};return ee.debug`RETURN: KameleoonClient._getFeatureVariation(visitorCode: ${e}, featureKey: ${t}, track: ${i}) -> (variation: ${d})`,x.Ok(d)}_isVisitorNotInHoldout(e,t,i,r,a){let n=this.clientConfiguration.holdout;if(!n)return!0;ee.debug`CALL: KameleoonClient._isVisitorNotInHoldout(visitorCode: ${e}, track: ${t}, save: ${i}, featureFlag: ${r}, visitorData: ${a})`;let o=!0,s=this._getCodeForHash(e,null==r?void 0:r.bucketingCustomDataIndex,a),u=i$.getHashDouble({visitorIdentifier:s,respoolTime:null,id:String(n.experimentId)});ee.debug`Calculated holdoutHash: ${u} for visitorCode: ${s}`;let l=ey.getVariationByHash(n.variationByExposition,u);return null!==l&&(o="in-holdout"!==l.variationKey,i&&this.variationConfiguration.updateStoredVariations(e,{[n.experimentId]:{variationId:l.variationId,isTargetedRule:!1,status:t?it.Unsent:it.Sent}})),ee.debug`RETURN: KameleoonClient._isVisitorNotInHoldout(visitorCode: ${e}, track: ${t}, save: ${i}, featureFlag: ${r}, visitorData: ${a}) -> (isNotInHoldout: ${o})`,o}_setForcedVariation({visitorCode:e,experimentId:t,variationKey:i,forceTargeting:r=!0}){if(ee.debug`CALL: KameleoonClient._setForcedVariation(visitorCode: '${e}', experimentId: ${t}, variationKey: '${i}', forceTargeting: ${r})`,null===i){let a=this.variationConfiguration.updateForcedExperimentVariation(e,t,null);return ee.debug`RETURN: KameleoonClient._setForcedVariation(visitorCode: '${e}', experimentId: ${t}, variationKey: '${i}', forceTargeting: ${r}) -> (writeResult: ${a})`,a}let a=null,n=null;if(!(a=this.clientConfiguration.experimentMap.get(t)))return ee.error`Experiment with id ${t} not found for visitor ${e}`,x.Err(new $(k.FeatureFlagExperimentNotFound,t,e));if(void 0===(n=a.variations.get(i)))return ee.error`Variation with key ${i} not found in experiment ${a} for visitor ${e}`,x.Err(new $(k.FeatureFlagVariationNotFound,i,e));a={type:a.type,experimentId:t},n={variationKey:i,variationId:n};let o=this.variationConfiguration.updateForcedExperimentVariation(e,t,{rule:a,varByExp:n,forceTargeting:r});return ee.debug`RETURN: KameleoonClient._setForcedVariation(visitorCode: '${e}', experimentId: ${t}, variationKey: '${i}', forceTargeting: ${r}) -> (writeResult: ${o})`,o}_getCodeForHash(e,t,i){var r;let a;if(ee.debug`CALL: KameleoonClient._getCodeForHash(visitorCode: ${e}, bucketingCustomDataIndex: ${t}, visitorData: ${i})`,null!=t){let e=null==i?void 0:i.customData;if(e){let i=null===(r=e[t])||void 0===r?void 0:r.value[0];i&&(a=i)}}return a||(a=this.dataManager.getVisitorIdentifier(e)),ee.debug`RETURN: KameleoonClient._getCodeForHash(visitorCode: ${e}, bucketingCustomDataIndex: ${t}, visitorData: ${i}) -> (codeForHash: ${a})`,a}};iz.EvaluatedExperiment=class{static fromForcedFeatureVariation(e,t){var i,r,a;let n=e;return t.varByExp?n=t.varByExp.variationKey:t.rule&&t.rule.type===ia.EXPERIMENTATION&&(n="off"),{variationKey:n,variationId:(null===(i=t.varByExp)||void 0===i?void 0:i.variationId)||null,experimentId:(null===(r=t.rule)||void 0===r?void 0:r.experimentId)||null,ruleType:(null===(a=t.rule)||void 0===a?void 0:a.type)||null,isSimulated:t.simulated}}static fromVariationData(e){var t,i;return{variationKey:e.variationKey,variationId:e.variationId,experimentId:e.experimentId,ruleType:null!==(i=null===(t=e.rule)||void 0===t?void 0:t.type)&&void 0!==i?i:null,isSimulated:!1}}static fromDefaultVariationKey(e){return{variationKey:e,variationId:null,experimentId:null,ruleType:null,isSimulated:!1}}};class iB{static simulateSuccessRequest(e,t){switch(e){case t5.Tracking:return new Promise(e=>{e({status:204,json:()=>new Promise(e=>e(null)),text:()=>new Promise(e=>e("")),ok:!0})});case t5.Configuration:case t5.RemoteData:return new Promise(e=>{e({status:200,json:()=>new Promise(e=>e(t)),text:()=>new Promise(e=>e("")),ok:!0})});default:F(e)}}static getCookieValue(e,t){let i=e.split("; ").find(e=>{let[i,r]=e.split("=");return i===t&&""!==r});return i?i.split("=")[1]:null}}x.Err,x.Ok,"function"==typeof SuppressedError&&SuppressedError;class iq{sendRequest({url:e,parameters:t}){var i,r,a;return i=this,a=function*(){return yield fetch(e,t)},new(r=void 0,r=Promise)(function(e,t){function n(e){try{s(a.next(e))}catch(e){t(e)}}function o(e){try{s(a.throw(e))}catch(e){t(e)}}function s(t){var i;t.done?e(t.value):((i=t.value)instanceof r?i:new r(function(e){e(i)})).then(n,o)}s((a=a.apply(i,[])).next())})}}(o=n||(n={})).PairsDelimiter="; ",o.KeyValueDelimiter="=",o.MaxAge="Max-Age",o.Path="Path",o.Domain="Domain";let iH=15*ii.Second,iW=30*ii.Minute;class iY{getData(e){ee.debug`CALL: VisitorCodeManager.getData(key: ${e})`;let t=document.cookie,i=null;return t&&(i=iB.getCookieValue(t,e)),ee.debug`RETURN: VisitorCodeManager.getData(key: ${e}) -> (visitorCode: ${i})`,i}setData({visitorCode:e,domain:t,maxAge:i,key:r,path:a}){let n=this.getResultCookie({domain:t,visitorCode:e,key:r,maxAge:i,path:a});document.cookie=n,ee.debug`Cookie ${n} was added for visitor ${e}`}getResultCookie({domain:e,visitorCode:t,maxAge:i,key:r,path:a}){let o=[r+n.KeyValueDelimiter+t,n.MaxAge+n.KeyValueDelimiter+i,n.Path+n.KeyValueDelimiter+a];return e&&o.push(n.Domain+n.KeyValueDelimiter+e),o.join(n.PairsDelimiter)}}class iJ{read(e){let t=localStorage.getItem(e);return e!==iV.ConsentData||t&&"{}"!==t?t?JSON.parse(t):null:this.getEngineConsentData()}write(e,t){localStorage.setItem(e,JSON.stringify(t))}getEngineConsentData(){var e;this.visitorCodeManager||(this.visitorCodeManager=new iY);let t=this.visitorCodeManager.getData(iV.VisitorCode);if(!t)return null;try{let i=localStorage.getItem("kameleoonLegalConsent");if(!i)return null;let r=JSON.parse(i);return"boolean"==typeof(null===(e=null==r?void 0:r.value)||void 0===e?void 0:e.AB_TESTING)?{[t]:r.value.AB_TESTING}:null}catch(e){return null}}}class iX{open({eventType:e,onEvent:t,url:i}){let r=new EventSource(i);this.eventSource=r,this.eventSource.addEventListener(e,t)}close(){this.eventSource&&this.eventSource.close()}onError(e){this.eventSource&&(this.eventSource.onerror=e)}}class iQ{getRandomNumber(){if("undefined"!=typeof window&&(null==window?void 0:window.crypto)){let e=new Uint32Array(1);return window.crypto.getRandomValues(e),e[0]/4294967296}return Math.random()}}class iZ{log(e,t){switch(t=`${(new Date).toLocaleString("en-US",{timeZoneName:"short"})} ${t}`,e){case t8.DEBUG:console.debug(t);break;case t8.INFO:console.info(t);break;case t8.WARNING:console.warn(t);break;case t8.ERROR:console.error(t)}}}class i0{constructor(e,t,i,r){ee.debug`CALL: new VisitorActivityManager(dataManager, tracker, isConsentProvided, interval: ${r})`,this.dataManager=e,this.tracker=t,this.isConsentProvided=i,this.setup(r),ee.debug`RETURN: new VisitorActivityManager(dataManager, tracker, isConsentProvided, interval: ${r})`}setup(e){setInterval(()=>{this.updateLastActivity()},e),this.updateLastActivity()}updateLastActivity(){let e=this.dataManager.updateLastActivity();e&&this.tracker.scheduleVisitor(e,this.isConsentProvided(e))}}class i1 extends tl{constructor({dataStorage:e,infoStorage:t,cleanupInterval:i,packageInfo:r,platformAnalyzer:a}){ee.debug`CALL: new ClientDataManager(dataStorage, infoStorage, cleanupInterval: ${i}, packageInfo: ${r}, platformAnalyzer)`,super({dataStorage:e,infoStorage:t,cleanupInterval:i,packageInfo:r}),this.visitor=null,this.platformAnalyzer=a,this.updateVisitor(),ee.debug`RETURN: new ClientDataManager(dataStorage, infoStorage, cleanupInterval: ${i} packageInfo: ${r}, platformAnalyzer)`}getUnsentData(e){var t,i;let r=super.getUnsentData(e),a=super.getVisitorData(e);if(!a)return r;let n=a[ic.Browser],o=a[ic.Device],s=a[ic.OperatingSystem],u=new eF({browserType:null==n?void 0:n.browser,browserVersion:null==n?void 0:n.version,visitNumber:null===(t=this.visitor)||void 0===t?void 0:t.visitNumber,timeSincePreviousVisit:null===(i=this.visitor)||void 0===i?void 0:i.timeSincePreviousVisit,os:null==s?void 0:s.operatingSystem,deviceType:null==o?void 0:o.device});return r.push(u),r}storeData(e,...t){return"string"==typeof e?(t.length&&this.checkVisitor(e),super.storeData(e,...t)):super.storeData(e)}getVisitorData(e){return this.checkVisitor(e),super.getVisitorData(e)}updateLastActivity(){var e,t,i,r;if(!this.visitor)return null;let a=this.dataStorage.read();if(!a.ok)return null;let n=a.data,o=null!==(e=n[this.visitor.visitorCode])&&void 0!==e?e:{};"string"==typeof o&&(o=n[o]);let s=o[ic.VisitsData];s||(s={visits:[],visitNumber:0,type:ic.VisitsData,status:it.Sent,expirationTime:0},o[ic.VisitsData]=s);let u=this.fetchVisit(s.visits,s.visits.length-1),l=null!==(t=null==u?void 0:u.timeLastActivity)&&void 0!==t?t:0,d=Date.now(),c=null!==(i=s.visitNumber)&&void 0!==i?i:s.visits.length?s.visits.length-1:0;if(d-l>iW)c+=l>0?1:0,eC.insertVisitInOrderedListMutably({list:s.visits,visit:{timeStarted:d,timeLastActivity:d}}),this.visitor.timeSincePreviousVisit=u?d-l:0;else if(s.visits.length&&(s.visits[s.visits.length-1]={timeStarted:null!==(r=null==u?void 0:u.timeStarted)&&void 0!==r?r:d,timeLastActivity:d},-1===this.visitor.timeSincePreviousVisit)){let e=this.fetchVisit(s.visits,s.visits.length-2);this.visitor.timeSincePreviousVisit=e?d-e.timeLastActivity:0}return s.visitNumber=c,this.visitor.visitNumber=c,this.dataStorage.write(n),this.visitor.visitorCode}checkVisitor(e){this.visitor&&this.visitor.visitorCode===e||this.createVisitor(e)}createVisitor(e){var t,i,r;ee.debug`CALL: ClientDataManager.createVisitor(visitorCode: ${e})`,this.visitor=new i2(e);try{let a=this.platformAnalyzer.getResult(),n=[];(null===(t=a.os)||void 0===t?void 0:t.name)&&n.push(new eS(a.os.name)),(null===(i=a.platform)||void 0===i?void 0:i.type)&&n.push(new eD(a.platform.type)),(null===(r=a.browser)||void 0===r?void 0:r.name)&&n.push(new ek(a.browser.name,a.browser.version)),a.pageView&&n.push(a.pageView),n.length&&this.storeData(e,...n)}finally{this.updateLastActivity()}ee.debug`RETURN: ClientDataManager.createVisitor(visitorCode: ${e})`}updateVisitor(){var e;ee.debug`CALL: ClientDataManager.updateVisitor()`;let t=this.dataStorage.read();if(!t.ok)return;let i=t.data,r,a=-1;for(let[t,n]of Object.entries(i)){if("string"==typeof n)continue;let i=n[ic.VisitsData];if(!i){r||(r=t);continue}let o=i.visits.length?i.visits[i.visits.length-1]:null;if(o){let i=null!==(e="number"==typeof o?o:null==o?void 0:o.timeLastActivity)&&void 0!==e?e:0;i>a&&(a=i,r=t)}else r||(r=t)}r?this.createVisitor(r):(this.visitor=null,ee.debug`ClientDataManager no visitor found`),ee.debug`RETURN: ClientDataManager.updateVisitor()`}fetchVisit(e,t){if(t<0||t>=e.length)return null;let i=e[t];return"number"==typeof i?{timeStarted:i,timeLastActivity:i}:i}}class i2{constructor(e){this.visitNumber=0,this.timeSincePreviousVisit=-1,this.visitorCode=e}}class i3{static getFirstMatch(e,t){let i=t.match(e);return i&&i.length>0&&i[1]||""}static getSecondMatch(e,t){let i=t.match(e);return i&&i.length>1&&i[2]||""}static assign(e,...t){return Object.assign(e,...t)}}class i4{constructor(){this.userAgent=navigator.userAgent||"",ee.debug`PlatformParser: userAgent = ${this.userAgent}`,this.parsedResult={},""!==this.userAgent&&this.parse()}parseBrowser(){let e=[{test:[/chrome|crios|crmo/i],describe:e=>({name:ip.Chrome,version:this.getBrowserVersion(i3.getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.?_?\d+)+)/i,e))})},{test:[/firefox|iceweasel|fxios/i],describe:e=>({name:ip.Firefox,version:this.getBrowserVersion(i3.getFirstMatch(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,e))})},{test:[/safari|applewebkit/i],describe:e=>({name:ip.Safari,version:this.getBrowserVersion(i3.getFirstMatch(/version\/(\d+(\.?_?\d+)+)/i,e))})},{test:[/opr\/|opios/i],describe:e=>({name:ip.Opera,version:this.getBrowserVersion(i3.getFirstMatch(/(?:opr|opios)[\s/](\S+)/i,e))})},{test:[/edg([ea]|ios)/i],describe:e=>({name:ip.InternetExplorer,version:this.getBrowserVersion(i3.getSecondMatch(/edg([ea]|ios)\/(\d+(\.?_?\d+)+)/i,e))})},{test:[/googlebot/i],describe:e=>({name:ip.Other,version:this.getBrowserVersion(i3.getFirstMatch(/googlebot\/(\d+(\.\d+))/i,e)||i3.getFirstMatch(/version\/(\d+(\.?_?\d+)+)/i,e))})},{test:[/SamsungBrowser/i],describe:e=>({name:ip.Other,version:this.getBrowserVersion(i3.getFirstMatch(/(?:SamsungBrowser)[\s/](\d+(\.?_?\d+)+)/i,e))})},{test:[/yabrowser/i],describe:e=>({name:ip.Other,version:this.getBrowserVersion(i3.getFirstMatch(/(?:yabrowser)[\s/](\d+(\.?_?\d+)+)/i,e))})},{test:[/ucbrowser/i],describe:e=>({name:ip.Other,version:this.getBrowserVersion(i3.getFirstMatch(/(?:ucbrowser)[\s/](\d+(\.?_?\d+)+)/i,e))})},{test:[/vivaldi/i],describe:e=>({name:ip.Other,version:this.getBrowserVersion(i3.getFirstMatch(/vivaldi\/(\d+(\.?_?\d+)+)/i,e))})},{test:[/phantom/i],describe:e=>({name:ip.Other,version:this.getBrowserVersion(i3.getFirstMatch(/phantomjs\/(\d+(\.?_?\d+)+)/i,e))})},{test:[/electron/i],describe:e=>({name:ip.Other,version:this.getBrowserVersion(i3.getFirstMatch(/(?:electron)\/(\d+(\.?_?\d+)+)/i,e))})},{test:[/chromium/i],describe:e=>({name:ip.Other,version:this.getBrowserVersion(i3.getFirstMatch(/(?:chromium)[\s/](\d+(\.?_?\d+)+)/i,e))})},{test:[/opera/i],describe:e=>({name:ip.Opera,version:this.getBrowserVersion(i3.getFirstMatch(/(?:opera)[\s/](\d+(\.?_?\d+)+)/i,e))})},{test:[/msie|trident/i],describe:e=>({name:ip.InternetExplorer,version:this.getBrowserVersion(i3.getFirstMatch(/(?:msie |rv:)(\d+(\.?_?\d+)+)/i,e))})},{test:[/.*/i],describe:e=>{let t=e.includes("(")?/^(.*)\/(.*)[ \t]\((.*)/:/^(.*)\/(.*) /;return{name:ip.Other,version:this.getBrowserVersion(i3.getSecondMatch(t,e))}}}].find(e=>e.test.some(e=>e.test(this.userAgent)));return e&&(this.parsedResult.browser=e.describe(this.userAgent)),this.parsedResult.browser||{}}parseOS(){let e=[{test:[/windows phone/i],describe:()=>({name:ig.WindowsPhone})},{test:[/windows /i],describe:()=>({name:ig.Windows})},{test:[/Macintosh(.*?) FxiOS(.*?) Version\//],describe:e=>({name:ig.IOS,version:i3.getSecondMatch(/(Version\/)(\d[\d.]+)/,e)})},{test:[/macintosh/i],describe:e=>({name:ig.Mac,version:i3.getFirstMatch(/mac os x (\d+(\.?_?\d+)+)/i,e).replace(/[_\s]/g,".")})},{test:[/(ipod|iphone|ipad)/i],describe:e=>({name:ig.IOS,version:i3.getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i,e).replace(/[_\s]/g,".")})},{test:[/android/i],describe:()=>({name:ig.Android})},{test:[/linux/i],describe:()=>({name:ig.Linux})}].find(e=>e.test.some(e=>e.test(this.userAgent)));return e&&(this.parsedResult.os=e.describe(this.userAgent)),this.parsedResult.os||{}}parsePlatform(){let e=[{test:()=>{var e,t;return(null===(e=this.parsedResult.os)||void 0===e?void 0:e.name)===ig.Android&&Number(String(null===(t=this.parsedResult.os)||void 0===t?void 0:t.version).split(".")[0])>=3},describe:e=>({type:ih.Tablet})},{test:()=>{var e;return(null===(e=this.parsedResult.os)||void 0===e?void 0:e.name)===ig.Android},describe:()=>({type:ih.Phone})},{test:()=>{var e;return(null===(e=this.parsedResult.os)||void 0===e?void 0:e.name)===ig.Mac},describe:()=>({type:ih.Desktop})},{test:()=>{var e;return(null===(e=this.parsedResult.os)||void 0===e?void 0:e.name)===ig.Windows},describe:()=>({type:ih.Desktop})},{test:()=>{var e;return(null===(e=this.parsedResult.os)||void 0===e?void 0:e.name)===ig.Linux},describe:()=>({type:ih.Desktop})}],t=[{test:[/huserAgentwei/i],describe:e=>({type:ih.Phone})},{test:[/nexus\s*(?:7|8|9|10).*/i],describe:()=>({type:ih.Tablet})},{test:[/ipad/i],describe:()=>({type:ih.Tablet})},{test:[/Macintosh(.*?) FxiOS(.*?) Version\//],describe:()=>({type:ih.Tablet})},{test:[/kftt build/i],describe:()=>({type:ih.Tablet})},{test:[/silk/i],describe:()=>({type:ih.Tablet})},{test:[/tablet(?! pc)/i],describe:()=>({type:ih.Tablet})},{test:[/ipod|iphone/i],describe:()=>({type:ih.Phone})},{test:[/nexus\s*[0-6].*/i,/galaxy nexus/i],describe:()=>({type:ih.Phone})},{test:[/[^-]mobi/i],describe:()=>({type:ih.Phone})},{test:[/blackberry/i],describe:()=>({type:ih.Phone})},{test:[/bada/i],describe:()=>({type:ih.Phone})},{test:[/windows phone/i],describe:()=>({type:ih.Phone})},{test:[/android/i],describe:()=>({type:ih.Phone})},{test:[/ios/i],describe:()=>({type:ih.Desktop})},{test:[/windows/i],describe:()=>({type:ih.Desktop})},{test:[/linux/i],describe:()=>({type:ih.Desktop})}].find(e=>e.test.some(e=>e.test(this.userAgent)))||e.find(e=>e.test());return t&&(this.parsedResult.platform=t.describe(this.userAgent)),this.parsedResult.platform||{}}parse(){this.userAgent&&(this.parseBrowser(),this.parseOS(),this.parsePlatform())}getBrowserVersion(e){if(!e)return;let t=e.split(".");if(0===t.length)return;let i=parseFloat(t.length>1?`${t[0]}.${t[1]}`:t[0]);return isNaN(i)?void 0:i}parseWebView(){var e;let t=null===(e=window.location)||void 0===e?void 0:e.href;if(t){let e=document?document.title:"";this.parsedResult.pageView=new eb({urlAddress:t,title:e})}}getResult(){return this.parseWebView(),i3.assign({},this.parsedResult)}}class i6 extends iz{constructor({siteCode:e,configuration:t,externals:i,_internals:r,stubMode:a}){var n;if(a)return super({siteCode:e,internalConfiguration:{},stubMode:a}),this.internalVisitorCodeManager={},void(this.externalVisitorCodeManager={});let o=(null==r?void 0:r.prng)||new iQ,s=(null==i?void 0:i.storage)||new iJ,u=(null==i?void 0:i.requester)||new iq,l=(null==i?void 0:i.eventSource)||new iX,d=new iU,c=(null==i?void 0:i.visitorCodeManager)||new iY,h=(null==r?void 0:r.packageInfo)||{type:iv.JAVASCRIPT,version:"4.15.1",isServer:!1},f=new i1({dataStorage:new to(s,iV.TargetingData),infoStorage:new to(s,iV.DataInfo),cleanupInterval:0,packageInfo:h,platformAnalyzer:null!==(n=null==r?void 0:r.platformAnalyzer)&&void 0!==n?n:new i4});super({siteCode:e,configuration:t,internalConfiguration:{externals:{externalPRNG:o,externalStorage:s,externalRequester:u,externalEventSource:l,externalVisitorCodeManager:d,externalPackageInfo:h,externalLogger:(null==i?void 0:i.logger)||new iZ,customDataManager:f},settings:{useAbortController:!0}}});let g=em.validateDomain(null==t?void 0:t.cookieDomain);this.domain=g.ok?g.data:void 0,this.internalVisitorCodeManager=d,this.externalVisitorCodeManager=c,new i0(f,this.tracker,e=>this._isConsentProvided(e),iH),this.customDataManager=f}getVisitorCode(e){var t;if(this.stubMode)return"";ee.info`CALL KamaleoonClient.getVisitorCode(defaultVisitorCode: ${e})`,this.internalVisitorCodeManager.getData=e=>this.externalVisitorCodeManager.getData(e),this.internalVisitorCodeManager.setData=e=>{this.externalVisitorCodeManager.setData(Object.assign(Object.assign({},e),{domain:this.domain}))};let i=this.internalVisitorCodeManager.getVisitorCode(e);return this.initialized&&(null===(t=this.customDataManager)||void 0===t||t.checkVisitor(i)),ee.info`RETURN KamaleoonClient.getVisitorCode(defaultVisitorCode: ${e}) -> (visitorCode: ${i})`,i}setLegalConsent(e,t){this.stubMode||(super.setUserConsent({visitorCode:e,consent:t,setData:e=>{this.externalVisitorCodeManager.setData(Object.assign(Object.assign({},e),{domain:this.domain}))}}),super.flush(e))}}let i5=u.createContext(null);var i9=u.memo(function({client:e,children:t}){return(0,s.jsx)(i5.Provider,Object.assign({value:{kameleoonClient:e,sdkParameters:null}},{children:t}))});u.memo(function({sdkParameters:e,children:t}){return(0,s.jsx)(i5.Provider,Object.assign({value:{kameleoonClient:null,sdkParameters:e}},{children:t}))}),"function"==typeof SuppressedError&&SuppressedError,i(23505);var i8=i(11163),i7=i(2592),re=i(24874),rt=i(24239),ri=i(60023),rr=i(34155);function ra(e){var t;let{Component:i,pageProps:r}=e;(0,f.C5)()&&u.useEffect(()=>{function e(){document.documentElement.style.setProperty("--app-height","".concat(window.innerHeight,"px"))}return e(),window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}},[]);let a=(0,i8.useRouter)(),n=u.useRef(),o="https://backend-dvg.rotterdam.nl"===(0,re.getCmsUrl)()||"https://backend-dvg.ggdrotterdamrijnmond.nl"===(0,re.getCmsUrl)(),l=(0,re.getKameleoonSiteCode)(),d=function({siteCode:e,configuration:t,externals:i,stubMode:r}){return new i6({siteCode:e,configuration:t,externals:i,_internals:{packageInfo:{type:iv.REACT,version:"10.17.1",isServer:!1},prng:null==i?void 0:i.prng,platformAnalyzer:null==i?void 0:i.platformAnalyzer},stubMode:r})}({siteCode:l,configuration:{updateInterval:60,environment:o?t7.Production:t7.Development},stubMode:!(0,f.C5)()});"true"===rr.env.NEXT_PUBLIC_KAMELEOON_DEBUG&&d.setLogLevel(t8.DEBUG),(0,u.useEffect)(()=>{n.current=window.location.pathname},[]),(0,u.useEffect)(()=>{let e=()=>{var e;n.current!==window.location.pathname&&(null===(e=document.getElementById("skip-to-content"))||void 0===e||e.focus(),n.current=window.location.pathname)};return a.events.on("routeChangeComplete",e),()=>{a.events.off("routeChangeComplete",e)}},[a.events,a.query]);let g=null!==(t=i.getLayout)&&void 0!==t?t:e=>e;return(0,s.jsx)(V.mD,{settings:{site:"www.rotterdam.nl",domain:"rotterdam.nl",siteName:"Gemeente Rotterdam",theme:"rotterdam"},children:(0,s.jsx)(rt.Z,{condition:(0,ri.Uh)(l),wrapper:e=>(0,s.jsx)(i9,{client:d,children:e}),children:(0,s.jsx)(i7.As,{children:(0,s.jsx)(R.hT,{children:(0,s.jsxs)(T,{children:[(0,s.jsx)(y,{}),g((0,s.jsx)(i,{...r})),(0,s.jsx)(c,{}),(0,s.jsx)(h,{})]})})})})})}},23505:function(){},56024:function(){},67598:function(){},92142:function(e){e.exports={buttonWrapper:"styles_buttonWrapper__ImW40",button:"styles_button__a182Y"}},9008:function(e,t,i){e.exports=i(23867)},39332:function(e,t,i){e.exports=i(8199)},11163:function(e,t,i){e.exports=i(43079)},34155:function(e){var t,i,r,a=e.exports={};function n(){throw Error("setTimeout has not been defined")}function o(){throw Error("clearTimeout has not been defined")}function s(e){if(t===setTimeout)return setTimeout(e,0);if((t===n||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(i){try{return t.call(null,e,0)}catch(i){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:n}catch(e){t=n}try{i="function"==typeof clearTimeout?clearTimeout:o}catch(e){i=o}}();var u=[],l=!1,d=-1;function c(){l&&r&&(l=!1,r.length?u=r.concat(u):d=-1,u.length&&h())}function h(){if(!l){var e=s(c);l=!0;for(var t=u.length;t;){for(r=u,u=[];++d<t;)r&&r[d].run();d=-1,t=u.length}r=null,l=!1,function(e){if(i===clearTimeout)return clearTimeout(e);if((i===o||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(e);try{i(e)}catch(t){try{return i.call(null,e)}catch(t){return i.call(this,e)}}}(e)}}function f(e,t){this.fun=e,this.array=t}function g(){}a.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)t[i-1]=arguments[i];u.push(new f(e,t)),1!==u.length||l||s(h)},f.prototype.run=function(){this.fun.apply(null,this.array)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={},a.on=g,a.addListener=g,a.once=g,a.off=g,a.removeListener=g,a.removeAllListeners=g,a.emit=g,a.prependListener=g,a.prependOnceListener=g,a.listeners=function(e){return[]},a.binding=function(e){throw Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(e){throw Error("process.chdir is not supported")},a.umask=function(){return 0}},29347:function(e,t,i){"use strict";i.d(t,{zt:function(){return o},ZP:function(){return s}});var r=i(67294),a=i(65885).Z,n=r.createContext(new a),o=n.Provider;n.Consumer;var s=n},65885:function(e,t,i){"use strict";i.d(t,{Z:function(){return o}});var r=i(38087);function a(e,t){void 0===t&&(t={});var i,r=e&&"j"===e[0]&&":"===e[1]?e.substr(2):e;if(void 0===(i=t.doNotParse)&&(i=!r||"{"!==r[0]&&"["!==r[0]&&'"'!==r[0]),!i)try{return JSON.parse(r)}catch(e){}return e}var n=function(){return(n=Object.assign||function(e){for(var t,i=1,r=arguments.length;i<r;i++)for(var a in t=arguments[i])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},o=function(){function e(e,t){var i=this;this.changeListeners=[],this.HAS_DOCUMENT_COOKIE=!1,this.cookies="string"==typeof e?r.Q(e,t):"object"==typeof e&&null!==e?e:{},new Promise(function(){i.HAS_DOCUMENT_COOKIE="object"==typeof document&&"string"==typeof document.cookie}).catch(function(){})}return e.prototype._updateBrowserValues=function(e){this.HAS_DOCUMENT_COOKIE&&(this.cookies=r.Q(document.cookie,e))},e.prototype._emitChange=function(e){for(var t=0;t<this.changeListeners.length;++t)this.changeListeners[t](e)},e.prototype.get=function(e,t,i){return void 0===t&&(t={}),this._updateBrowserValues(i),a(this.cookies[e],t)},e.prototype.getAll=function(e,t){void 0===e&&(e={}),this._updateBrowserValues(t);var i={};for(var r in this.cookies)i[r]=a(this.cookies[r],e);return i},e.prototype.set=function(e,t,i){var a;"object"==typeof t&&(t=JSON.stringify(t)),this.cookies=n(n({},this.cookies),((a={})[e]=t,a)),this.HAS_DOCUMENT_COOKIE&&(document.cookie=r.q(e,t,i)),this._emitChange({name:e,value:t,options:i})},e.prototype.remove=function(e,t){var i=t=n(n({},t),{expires:new Date(1970,1,1,0,0,1),maxAge:0});this.cookies=n({},this.cookies),delete this.cookies[e],this.HAS_DOCUMENT_COOKIE&&(document.cookie=r.q(e,"",i)),this._emitChange({name:e,value:void 0,options:t})},e.prototype.addChangeListener=function(e){this.changeListeners.push(e)},e.prototype.removeChangeListener=function(e){var t=this.changeListeners.indexOf(e);t>=0&&this.changeListeners.splice(t,1)},e}()},38087:function(e,t){"use strict";t.Q=function(e,t){if("string"!=typeof e)throw TypeError("argument str must be a string");for(var r={},a=e.split(";"),n=(t||{}).decode||i,o=0;o<a.length;o++){var s=a[o],u=s.indexOf("=");if(!(u<0)){var l=s.substring(0,u).trim();if(void 0==r[l]){var d=s.substring(u+1,s.length).trim();'"'===d[0]&&(d=d.slice(1,-1)),r[l]=function(e,t){try{return t(e)}catch(t){return e}}(d,n)}}}return r},t.q=function(e,t,i){var n=i||{},o=n.encode||r;if("function"!=typeof o)throw TypeError("option encode is invalid");if(!a.test(e))throw TypeError("argument name is invalid");var s=o(t);if(s&&!a.test(s))throw TypeError("argument val is invalid");var u=e+"="+s;if(null!=n.maxAge){var l=n.maxAge-0;if(isNaN(l)||!isFinite(l))throw TypeError("option maxAge is invalid");u+="; Max-Age="+Math.floor(l)}if(n.domain){if(!a.test(n.domain))throw TypeError("option domain is invalid");u+="; Domain="+n.domain}if(n.path){if(!a.test(n.path))throw TypeError("option path is invalid");u+="; Path="+n.path}if(n.expires){if("function"!=typeof n.expires.toUTCString)throw TypeError("option expires is invalid");u+="; Expires="+n.expires.toUTCString()}if(n.httpOnly&&(u+="; HttpOnly"),n.secure&&(u+="; Secure"),n.sameSite)switch("string"==typeof n.sameSite?n.sameSite.toLowerCase():n.sameSite){case!0:case"strict":u+="; SameSite=Strict";break;case"lax":u+="; SameSite=Lax";break;case"none":u+="; SameSite=None";break;default:throw TypeError("option sameSite is invalid")}return u};var i=decodeURIComponent,r=encodeURIComponent,a=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/},8100:function(e,t,i){"use strict";i.d(t,{ZP:function(){return q}});var r,a=i(67294);function n(e,t,i,r){return new(i||(i=Promise))(function(a,n){function o(e){try{u(r.next(e))}catch(e){n(e)}}function s(e){try{u(r.throw(e))}catch(e){n(e)}}function u(e){var t;e.done?a(e.value):((t=e.value)instanceof i?t:new i(function(e){e(t)})).then(o,s)}u((r=r.apply(e,t||[])).next())})}function o(e,t){var i,r,a,n,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return n={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function s(n){return function(s){return function(n){if(i)throw TypeError("Generator is already executing.");for(;o;)try{if(i=1,r&&(a=2&n[0]?r.return:n[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,n[1])).done)return a;switch(r=0,a&&(n=[2&n[0],a.value]),n[0]){case 0:case 1:a=n;break;case 4:return o.label++,{value:n[1],done:!1};case 5:o.label++,r=n[1],n=[0];continue;case 7:n=o.ops.pop(),o.trys.pop();continue;default:if(!(a=(a=o.trys).length>0&&a[a.length-1])&&(6===n[0]||2===n[0])){o=0;continue}if(3===n[0]&&(!a||n[1]>a[0]&&n[1]<a[3])){o.label=n[1];break}if(6===n[0]&&o.label<a[1]){o.label=a[1],a=n;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(n);break}a[2]&&o.ops.pop(),o.trys.pop();continue}n=t.call(e,o)}catch(e){n=[6,e],r=0}finally{i=a=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,s])}}}var s=function(){},u=s(),l=Object,d=function(e){return e===u},c=function(e){return"function"==typeof e},h=function(e,t){return l.assign({},e,t)},f="undefined",g=function(){return typeof window!=f},p=new WeakMap,v=0,m=function(e){var t,i,r=typeof e,a=e&&e.constructor,n=a==Date;if(l(e)!==e||n||a==RegExp)t=n?e.toJSON():"symbol"==r?e.toString():"string"==r?JSON.stringify(e):""+e;else{if(t=p.get(e))return t;if(t=++v+"~",p.set(e,t),a==Array){for(i=0,t="@";i<e.length;i++)t+=m(e[i])+",";p.set(e,t)}if(a==l){t="#";for(var o=l.keys(e).sort();!d(i=o.pop());)d(e[i])||(t+=i+":"+m(e[i])+",");p.set(e,t)}}return t},y=!0,C=g(),b=typeof document!=f,w=C&&window.addEventListener?window.addEventListener.bind(window):s,E=b?document.addEventListener.bind(document):s,k=C&&window.removeEventListener?window.removeEventListener.bind(window):s,D=b?document.removeEventListener.bind(document):s,S={initFocus:function(e){return E("visibilitychange",e),w("focus",e),function(){D("visibilitychange",e),k("focus",e)}},initReconnect:function(e){var t=function(){y=!0,e()},i=function(){y=!1};return w("online",t),w("offline",i),function(){k("online",t),k("offline",i)}}},I=!g()||"Deno"in window,T=I?a.useEffect:a.useLayoutEffect,R="undefined"!=typeof navigator&&navigator.connection,V=!I&&R&&(["slow-2g","2g"].includes(R.effectiveType)||R.saveData),O=function(e){if(c(e))try{e=e()}catch(t){e=""}var t=[].concat(e),i=(e="string"==typeof e?e:(Array.isArray(e)?e.length:e)?m(e):"")?"$swr$"+e:"";return[e,t,i]},A=new WeakMap,_=function(e,t,i,r,a,n,o){void 0===o&&(o=!0);var s=A.get(e),u=s[0],l=s[1],d=s[3],c=u[t],h=l[t];if(o&&h)for(var f=0;f<h.length;++f)h[f](i,r,a);return n&&(delete d[t],c&&c[0])?c[0](2).then(function(){return e.get(t)}):e.get(t)},x=0,M=function(){return++x},N=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return n(void 0,void 0,void 0,function(){var t,i,r,a,n,s,l,f,g,p,v,m,y,C,b,w,E,k,D,S;return o(this,function(o){switch(o.label){case 0:if(t=e[0],i=e[1],r=e[2],s=!!d((n="boolean"==typeof(a=e[3])?{revalidate:a}:a||{}).populateCache)||n.populateCache,l=!1!==n.revalidate,f=!1!==n.rollbackOnError,g=n.optimisticData,v=(p=O(i))[0],m=p[2],!v)return[2];if(y=A.get(t)[2],e.length<3)return[2,_(t,v,t.get(v),u,u,l,!0)];if(C=r,w=M(),y[v]=[w,0],E=!d(g),k=t.get(v),E&&(D=c(g)?g(k):g,t.set(v,D),_(t,v,D)),c(C))try{C=C(t.get(v))}catch(e){b=e}if(!(C&&c(C.then)))return[3,2];return[4,C.catch(function(e){b=e})];case 1:if(C=o.sent(),w!==y[v][0]){if(b)throw b;return[2,C]}b&&E&&f&&(s=!0,C=k,t.set(v,k)),o.label=2;case 2:return s&&(b||(c(s)&&(C=s(C,k)),t.set(v,C)),t.set(m,h(t.get(m),{error:b}))),y[v][1]=M(),[4,_(t,v,C,b,u,l,!!s)];case 3:if(S=o.sent(),b)throw b;return[2,s?S:C]}})})},F=function(e,t){for(var i in e)e[i][0]&&e[i][0](t)},$=function(e,t){if(!A.has(e)){var i=h(S,t),r={},a=N.bind(u,e),n=s;if(A.set(e,[r,{},{},{},a]),!I){var o=i.initFocus(setTimeout.bind(u,F.bind(u,r,0))),l=i.initReconnect(setTimeout.bind(u,F.bind(u,r,1)));n=function(){o&&o(),l&&l(),A.delete(e)}}return[e,a,n]}return[e,A.get(e)[4]]},P=$(new Map),L=P[0],U=h({onLoadingSlow:s,onSuccess:s,onError:s,onErrorRetry:function(e,t,i,r,a){var n=i.errorRetryCount,o=a.retryCount,s=~~((Math.random()+.5)*(1<<(o<8?o:8)))*i.errorRetryInterval;(d(n)||!(o>n))&&setTimeout(r,s,a)},onDiscarded:s,revalidateOnFocus:!0,revalidateOnReconnect:!0,revalidateIfStale:!0,shouldRetryOnError:!0,errorRetryInterval:V?1e4:5e3,focusThrottleInterval:5e3,dedupingInterval:2e3,loadingTimeout:V?5e3:3e3,compare:function(e,t){return m(e)==m(t)},isPaused:function(){return!1},cache:L,mutate:P[1],fallback:{}},{isOnline:function(){return y},isVisible:function(){var e=b&&document.visibilityState;return d(e)||"hidden"!==e}}),j=function(e,t){var i=h(e,t);if(t){var r=e.use,a=e.fallback,n=t.use,o=t.fallback;r&&n&&(i.use=r.concat(n)),a&&o&&(i.fallback=h(a,o))}return i},K=(0,a.createContext)({}),G=function(e,t){var i=(0,a.useState)({})[1],r=(0,a.useRef)(e),n=(0,a.useRef)({data:!1,error:!1,isValidating:!1}),o=(0,a.useCallback)(function(e){var a=!1,o=r.current;for(var s in e)o[s]!==e[s]&&(o[s]=e[s],n.current[s]&&(a=!0));a&&!t.current&&i({})},[]);return T(function(){r.current=e}),[r,n.current,o]},z=function(e,t,i){var r=t[e]||(t[e]=[]);return r.push(i),function(){var e=r.indexOf(i);e>=0&&(r[e]=r[r.length-1],r.pop())}},B={dedupe:!0};l.defineProperty(function(e){var t=e.value,i=j((0,a.useContext)(K),t),r=t&&t.provider,n=(0,a.useState)(function(){return r?$(r(i.cache||L),t):u})[0];return n&&(i.cache=n[0],i.mutate=n[1]),T(function(){return n?n[2]:u},[]),(0,a.createElement)(K.Provider,h(e,{value:i}))},"default",{value:U});var q=(r=function(e,t,i){var r=i.cache,s=i.compare,l=i.fallbackData,p=i.suspense,v=i.revalidateOnMount,m=i.refreshInterval,y=i.refreshWhenHidden,C=i.refreshWhenOffline,b=A.get(r),w=b[0],E=b[1],k=b[2],D=b[3],S=O(e),R=S[0],V=S[1],x=S[2],F=(0,a.useRef)(!1),$=(0,a.useRef)(!1),P=(0,a.useRef)(R),L=(0,a.useRef)(t),U=(0,a.useRef)(i),j=function(){return U.current},K=function(){return j().isVisible()&&j().isOnline()},q=function(e){return r.set(x,h(r.get(x),e))},H=r.get(R),W=d(l)?i.fallback[R]:l,Y=d(H)?W:H,J=r.get(x)||{},X=J.error,Q=!F.current,Z=function(){return Q&&!d(v)?v:!j().isPaused()&&(p?!d(Y)&&i.revalidateIfStale:d(Y)||i.revalidateIfStale)},ee=!!R&&!!t&&(!!J.isValidating||Q&&Z()),et=G({data:Y,error:X,isValidating:ee},$),ei=et[0],er=et[1],ea=et[2],en=(0,a.useCallback)(function(e){return n(void 0,void 0,void 0,function(){var t,a,n,l,h,f,g,p,v,m,y,C,b;return o(this,function(o){switch(o.label){case 0:if(t=L.current,!R||!t||$.current||j().isPaused())return[2,!1];l=!0,h=e||{},f=!D[R]||!h.dedupe,g=function(){return!$.current&&R===P.current&&F.current},p=function(){var e=D[R];e&&e[1]===n&&delete D[R]},v={isValidating:!1},m=function(){q({isValidating:!1}),g()&&ea(v)},q({isValidating:!0}),ea({isValidating:!0}),o.label=1;case 1:return o.trys.push([1,3,,4]),f&&(_(r,R,ei.current.data,ei.current.error,!0),i.loadingTimeout&&!r.get(R)&&setTimeout(function(){l&&g()&&j().onLoadingSlow(R,i)},i.loadingTimeout),D[R]=[t.apply(void 0,V),M()]),a=(b=D[R])[0],n=b[1],[4,a];case 2:if(a=o.sent(),f&&setTimeout(p,i.dedupingInterval),!D[R]||D[R][1]!==n)return f&&g()&&j().onDiscarded(R),[2,!1];if(q({error:u}),v.error=u,!d(y=k[R])&&(n<=y[0]||n<=y[1]||0===y[1]))return m(),f&&g()&&j().onDiscarded(R),[2,!1];return s(ei.current.data,a)?v.data=ei.current.data:v.data=a,s(r.get(R),a)||r.set(R,a),f&&g()&&j().onSuccess(a,R,i),[3,4];case 3:return C=o.sent(),p(),!j().isPaused()&&(q({error:C}),v.error=C,f&&g()&&(j().onError(C,R,i),("boolean"==typeof i.shouldRetryOnError&&i.shouldRetryOnError||c(i.shouldRetryOnError)&&i.shouldRetryOnError(C))&&K()&&j().onErrorRetry(C,R,i,en,{retryCount:(h.retryCount||0)+1,dedupe:!0}))),[3,4];case 4:return l=!1,m(),g()&&f&&_(r,R,v.data,v.error,!1),[2,!0]}})})},[R]),eo=(0,a.useCallback)(N.bind(u,r,function(){return P.current}),[]);if(T(function(){L.current=t,U.current=i}),T(function(){if(R){var e=R!==P.current,t=en.bind(u,B),i=0,r=z(R,E,function(e,t,i){ea(h({error:t,isValidating:i},s(ei.current.data,e)?u:{data:e}))}),a=z(R,w,function(e){if(0==e){var r=Date.now();j().revalidateOnFocus&&r>i&&K()&&(i=r+j().focusThrottleInterval,t())}else if(1==e)j().revalidateOnReconnect&&K()&&t();else if(2==e)return en()});return $.current=!1,P.current=R,F.current=!0,e&&ea({data:Y,error:X,isValidating:ee}),Z()&&(d(Y)||I?t():g()&&typeof window.requestAnimationFrame!=f?window.requestAnimationFrame(t):setTimeout(t,1)),function(){$.current=!0,r(),a()}}},[R,en]),T(function(){var e;function t(){var t=c(m)?m(Y):m;t&&-1!==e&&(e=setTimeout(i,t))}function i(){!ei.current.error&&(y||j().isVisible())&&(C||j().isOnline())?en(B).then(t):t()}return t(),function(){e&&(clearTimeout(e),e=-1)}},[m,y,C,en]),(0,a.useDebugValue)(Y),p&&d(Y)&&R)throw L.current=t,U.current=i,$.current=!1,d(X)?en(B):X;return{mutate:eo,get data(){return er.data=!0,Y},get error(){return er.error=!0,X},get isValidating(){return er.isValidating=!0,ee}}},function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var i=h(U,(0,a.useContext)(K)),n=c(e[1])?[e[0],e[1],e[2]||{}]:[e[0],null,(null===e[1]?e[2]:e[1])||{}],o=n[0],s=n[1],u=j(i,n[2]),l=r,d=u.use;if(d)for(var f=d.length;f-- >0;)l=d[f](l);return l(o,s||u.fetcher,u)})},97582:function(e,t,i){"use strict";i.r(t),i.d(t,{__addDisposableResource:function(){return M},__assign:function(){return n},__asyncDelegator:function(){return S},__asyncGenerator:function(){return D},__asyncValues:function(){return I},__await:function(){return k},__awaiter:function(){return g},__classPrivateFieldGet:function(){return A},__classPrivateFieldIn:function(){return x},__classPrivateFieldSet:function(){return _},__createBinding:function(){return v},__decorate:function(){return s},__disposeResources:function(){return F},__esDecorate:function(){return l},__exportStar:function(){return m},__extends:function(){return a},__generator:function(){return p},__importDefault:function(){return O},__importStar:function(){return V},__makeTemplateObject:function(){return T},__metadata:function(){return f},__param:function(){return u},__propKey:function(){return c},__read:function(){return C},__rest:function(){return o},__runInitializers:function(){return d},__setFunctionName:function(){return h},__spread:function(){return b},__spreadArray:function(){return E},__spreadArrays:function(){return w},__values:function(){return y}});var r=function(e,t){return(r=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])})(e,t)};function a(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Class extends value "+String(t)+" is not a constructor or null");function i(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}var n=function(){return(n=Object.assign||function(e){for(var t,i=1,r=arguments.length;i<r;i++)for(var a in t=arguments[i])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)};function o(e,t){var i={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&0>t.indexOf(r)&&(i[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var a=0,r=Object.getOwnPropertySymbols(e);a<r.length;a++)0>t.indexOf(r[a])&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(i[r[a]]=e[r[a]]);return i}function s(e,t,i,r){var a,n=arguments.length,o=n<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,r);else for(var s=e.length-1;s>=0;s--)(a=e[s])&&(o=(n<3?a(o):n>3?a(t,i,o):a(t,i))||o);return n>3&&o&&Object.defineProperty(t,i,o),o}function u(e,t){return function(i,r){t(i,r,e)}}function l(e,t,i,r,a,n){function o(e){if(void 0!==e&&"function"!=typeof e)throw TypeError("Function expected");return e}for(var s,u=r.kind,l="getter"===u?"get":"setter"===u?"set":"value",d=!t&&e?r.static?e:e.prototype:null,c=t||(d?Object.getOwnPropertyDescriptor(d,r.name):{}),h=!1,f=i.length-1;f>=0;f--){var g={};for(var p in r)g[p]="access"===p?{}:r[p];for(var p in r.access)g.access[p]=r.access[p];g.addInitializer=function(e){if(h)throw TypeError("Cannot add initializers after decoration has completed");n.push(o(e||null))};var v=(0,i[f])("accessor"===u?{get:c.get,set:c.set}:c[l],g);if("accessor"===u){if(void 0===v)continue;if(null===v||"object"!=typeof v)throw TypeError("Object expected");(s=o(v.get))&&(c.get=s),(s=o(v.set))&&(c.set=s),(s=o(v.init))&&a.unshift(s)}else(s=o(v))&&("field"===u?a.unshift(s):c[l]=s)}d&&Object.defineProperty(d,r.name,c),h=!0}function d(e,t,i){for(var r=arguments.length>2,a=0;a<t.length;a++)i=r?t[a].call(e,i):t[a].call(e);return r?i:void 0}function c(e){return"symbol"==typeof e?e:"".concat(e)}function h(e,t,i){return"symbol"==typeof t&&(t=t.description?"[".concat(t.description,"]"):""),Object.defineProperty(e,"name",{configurable:!0,value:i?"".concat(i," ",t):t})}function f(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function g(e,t,i,r){return new(i||(i=Promise))(function(a,n){function o(e){try{u(r.next(e))}catch(e){n(e)}}function s(e){try{u(r.throw(e))}catch(e){n(e)}}function u(e){var t;e.done?a(e.value):((t=e.value)instanceof i?t:new i(function(e){e(t)})).then(o,s)}u((r=r.apply(e,t||[])).next())})}function p(e,t){var i,r,a,n,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return n={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function s(s){return function(u){return function(s){if(i)throw TypeError("Generator is already executing.");for(;n&&(n=0,s[0]&&(o=0)),o;)try{if(i=1,r&&(a=2&s[0]?r.return:s[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,s[1])).done)return a;switch(r=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(a=(a=o.trys).length>0&&a[a.length-1])&&(6===s[0]||2===s[0])){o=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){o.label=s[1];break}if(6===s[0]&&o.label<a[1]){o.label=a[1],a=s;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(s);break}a[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],r=0}finally{i=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}}var v=Object.create?function(e,t,i,r){void 0===r&&(r=i);var a=Object.getOwnPropertyDescriptor(t,i);(!a||("get"in a?!t.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,r,a)}:function(e,t,i,r){void 0===r&&(r=i),e[r]=t[i]};function m(e,t){for(var i in e)"default"===i||Object.prototype.hasOwnProperty.call(t,i)||v(t,e,i)}function y(e){var t="function"==typeof Symbol&&Symbol.iterator,i=t&&e[t],r=0;if(i)return i.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function C(e,t){var i="function"==typeof Symbol&&e[Symbol.iterator];if(!i)return e;var r,a,n=i.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(r=n.next()).done;)o.push(r.value)}catch(e){a={error:e}}finally{try{r&&!r.done&&(i=n.return)&&i.call(n)}finally{if(a)throw a.error}}return o}function b(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(C(arguments[t]));return e}function w(){for(var e=0,t=0,i=arguments.length;t<i;t++)e+=arguments[t].length;for(var r=Array(e),a=0,t=0;t<i;t++)for(var n=arguments[t],o=0,s=n.length;o<s;o++,a++)r[a]=n[o];return r}function E(e,t,i){if(i||2==arguments.length)for(var r,a=0,n=t.length;a<n;a++)!r&&a in t||(r||(r=Array.prototype.slice.call(t,0,a)),r[a]=t[a]);return e.concat(r||Array.prototype.slice.call(t))}function k(e){return this instanceof k?(this.v=e,this):new k(e)}function D(e,t,i){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var r,a=i.apply(e,t||[]),n=[];return r={},o("next"),o("throw"),o("return",function(e){return function(t){return Promise.resolve(t).then(e,l)}}),r[Symbol.asyncIterator]=function(){return this},r;function o(e,t){a[e]&&(r[e]=function(t){return new Promise(function(i,r){n.push([e,t,i,r])>1||s(e,t)})},t&&(r[e]=t(r[e])))}function s(e,t){try{var i;(i=a[e](t)).value instanceof k?Promise.resolve(i.value.v).then(u,l):d(n[0][2],i)}catch(e){d(n[0][3],e)}}function u(e){s("next",e)}function l(e){s("throw",e)}function d(e,t){e(t),n.shift(),n.length&&s(n[0][0],n[0][1])}}function S(e){var t,i;return t={},r("next"),r("throw",function(e){throw e}),r("return"),t[Symbol.iterator]=function(){return this},t;function r(r,a){t[r]=e[r]?function(t){return(i=!i)?{value:k(e[r](t)),done:!1}:a?a(t):t}:a}}function I(e){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var t,i=e[Symbol.asyncIterator];return i?i.call(e):(e=y(e),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(i){t[i]=e[i]&&function(t){return new Promise(function(r,a){!function(e,t,i,r){Promise.resolve(r).then(function(t){e({value:t,done:i})},t)}(r,a,(t=e[i](t)).done,t.value)})}}}function T(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}var R=Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t};function V(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&v(t,e,i);return R(t,e),t}function O(e){return e&&e.__esModule?e:{default:e}}function A(e,t,i,r){if("a"===i&&!r)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?r:"a"===i?r.call(e):r?r.value:t.get(e)}function _(e,t,i,r,a){if("m"===r)throw TypeError("Private method is not writable");if("a"===r&&!a)throw TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?a.call(e,i):a?a.value=i:t.set(e,i),i}function x(e,t){if(null===t||"object"!=typeof t&&"function"!=typeof t)throw TypeError("Cannot use 'in' operator on non-object");return"function"==typeof e?t===e:e.has(t)}function M(e,t,i){if(null!=t){var r,a;if("object"!=typeof t&&"function"!=typeof t)throw TypeError("Object expected.");if(i){if(!Symbol.asyncDispose)throw TypeError("Symbol.asyncDispose is not defined.");r=t[Symbol.asyncDispose]}if(void 0===r){if(!Symbol.dispose)throw TypeError("Symbol.dispose is not defined.");r=t[Symbol.dispose],i&&(a=r)}if("function"!=typeof r)throw TypeError("Object not disposable.");a&&(r=function(){try{a.call(this)}catch(e){return Promise.reject(e)}}),e.stack.push({value:t,dispose:r,async:i})}else i&&e.stack.push({async:!0});return t}var N="function"==typeof SuppressedError?SuppressedError:function(e,t,i){var r=Error(i);return r.name="SuppressedError",r.error=e,r.suppressed=t,r};function F(e){function t(t){e.error=e.hasError?new N(t,e.error,"An error was suppressed during disposal."):t,e.hasError=!0}return function i(){for(;e.stack.length;){var r=e.stack.pop();try{var a=r.dispose&&r.dispose.call(r.value);if(r.async)return Promise.resolve(a).then(i,function(e){return t(e),i()})}catch(e){t(e)}}if(e.hasError)throw e.error}()}t.default={__extends:a,__assign:n,__rest:o,__decorate:s,__param:u,__metadata:f,__awaiter:g,__generator:p,__createBinding:v,__exportStar:m,__values:y,__read:C,__spread:b,__spreadArrays:w,__spreadArray:E,__await:k,__asyncGenerator:D,__asyncDelegator:S,__asyncValues:I,__makeTemplateObject:T,__importStar:V,__importDefault:O,__classPrivateFieldGet:A,__classPrivateFieldSet:_,__classPrivateFieldIn:x,__addDisposableResource:M,__disposeResources:F}}},function(e){var t=function(t){return e(e.s=t)};e.O(0,[9774,179],function(){return t(6840),t(43079)}),_N_E=e.O()}]);